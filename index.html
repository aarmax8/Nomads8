<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOMADS</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Nomad's">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/1a110a/f59e0b?text=N">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&family=Black+Ops+One&family=Rye&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a110a; /* Dark wood */
            background-image: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.85)), url('https://www.transparenttextures.com/patterns/worn-dots.png');
            background-attachment: fixed;
            overflow: hidden; /* Prevent body scroll */
        }
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        main {
            flex-grow: 1;
            overflow: hidden; /* Prevent main from scrolling, grid will scroll */
            position: relative;
        }
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-rye { font-family: 'Rye', cursive; }
        
        /* Header */
        #header-logo-container {
            position: relative;
            background-image: url('https://scontent-iad3-1.xx.fbcdn.net/v/t39.30808-6/560249362_1334414134750721_6442249990351217830_n.jpg?stp=cp6_dst-jpg_tt6&_nc_cat=101&ccb=1-7&_nc_sid=833d8c&_nc_ohc=CM3uAcZwDy0Q7kNvwH9N7J1&_nc_oc=Adm6pra2I-wIN54zlYEGN-q1sFOLdiKIZ7soVqhrp2gPTB4Mju67Q2FgLk0jjRLpvlg&_nc_zt=23&_nc_ht=scontent-iad3-1.xx&_nc_gid=DjeS81jUBoCZUFrHpc9egw&oh=00_Afcu7dpsQ4ErpnKzS14njbcQ0neAcvcnI0k3pCVDbdJQg&oe=68EBA766');
            background-size: cover;
            background-position: center top; /* Reverted to show top of image */
            background-repeat: no-repeat;
            border-radius: 0.5rem;
            box-shadow: 0 8px 16px rgba(0,0,0,0.8);
            overflow: hidden;
        }
        #header-logo-container::before {
            content: ''; position: absolute; inset: 0;
            background-color: rgba(0, 0, 0, 0.5); /* Reverted overlay */
            box-shadow: inset 0 0 20px rgba(0,0,0,0.9);
            border: 2px solid #4b5563; border-radius: 0.5rem;
            /* Added linear gradient to darken the right side */
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.7) 70%, rgba(0, 0, 0, 0.9) 100%);
        }
        #header-logo-container h1 {
            position: relative; font-family: 'Black Ops One', cursive;
            font-size: 2.5rem; color: #f59e0b;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.9), 0 0 15px #f59e0b;
            letter-spacing: 0.1em; z-index: 10; line-height: 1;
        }
        @media (max-width: 480px) { #header-logo-container h1 { font-size: 2rem; } }
        
        /* Horizontal Scroll Menu */
        #menu-grid {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scroll-padding: 1rem;
            -webkit-overflow-scrolling: touch;
            padding: 1rem;
            height: 100%;
        }
        #menu-grid::-webkit-scrollbar { display: none; }
        #menu-grid { -ms-overflow-style: none; scrollbar-width: none; }

        /* Flip Card */
        .drink-card {
            flex: 0 0 85%;
            scroll-snap-align: center;
            perspective: 1500px;
            background-color: transparent;
            min-height: 450px;
            transition: opacity 0.3s;
        }
        @media (min-width: 640px) {
            .drink-card { flex-basis: 60%; }
        }
        @media (min-width: 1024px) {
            .drink-card { flex-basis: 40%; }
        }
        .drink-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.7s, box-shadow 0.4s ease-in-out;
            transform-style: preserve-3d;
            box-shadow: 0 8px 20px rgba(0,0,0,0.7);
        }
        .drink-card.is-flipped .drink-card-inner {
            transform: rotateY(180deg);
        }
        .drink-card.is-highlighted .drink-card-inner {
            box-shadow: 0 0 25px 8px rgba(245, 158, 11, 0.7);
            transform: scale(1.02);
        }
        .drink-card-front, .drink-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: 0.75rem;
            background-color: #1f2937;
            border: 1px solid #4b5563;
        }
        .drink-card-back {
            transform: rotateY(180deg);
        }
        .drink-card.is-unavailable {
            opacity: 0.4;
            pointer-events: none;
        }

        /* Image/Logo area */
        .image-area {
            height: 200px;
            background-color: #374151;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
        }
        .image-area img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Added transition for a nicer effect */
            transition: opacity 0.3s ease-in-out; 
            opacity: 0; 
        }
        .image-area img.loaded {
            opacity: 1;
        }

        .loader {
            border: 3px solid #9ca3af;
            border-top: 3px solid #f59e0b;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Modal, Navigation & Filter Status */
        .modal { transition: opacity 0.3s ease-in-out; }
        .ingredient-btn.out-of-stock { opacity: 0.5; background-color: #374151; text-decoration: line-through; }
        .ingredient-btn.out-of-stock:hover { background-color: #4b5563; }
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(17, 24, 39, 0.7);
            color: #d1d5db;
            border: 2px solid #4b5563;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease-in-out;
        }
        .nav-arrow:hover {
            background-color: rgba(245, 158, 11, 0.8);
            color: #111827;
        }
        #arrow-left { left: 10px; }
        #arrow-right { right: 10px; }
        #filter-status { text-shadow: 1px 1px 3px rgba(0,0,0,0.7); }

        /* === New Bottom Navigation Bar === */
        .bottom-nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4px 0;
            border-radius: 0.5rem;
            color: #d1d5db; /* gray-300 */
            transition: all 0.2s ease-in-out;
        }
        .bottom-nav-btn:hover, .bottom-nav-btn.is-active {
            background-color: #374151; /* gray-700 */
            color: #f59e0b; /* amber-500 */
        }

        /* Styles for category popup */
        #category-popup.is-open {
            transform: translateY(0);
        }
        #category-filter-list .category-btn {
            padding: 12px 8px;
            border-radius: 0.5rem;
            background-color: #374151; /* gray-700 */
            color: #d1d5db; /* gray-300 */
            text-align: center;
            transition: all 0.2s ease-in-out;
            border: 1px solid #4b5563; /* gray-600 */
        }
        #category-filter-list .category-btn:hover {
            background-color: #4b5563; /* gray-600 */
        }
        #category-filter-list .category-btn.is-active {
            background-color: #f59e0b; /* amber-500 */
            color: #111827; /* gray-900 */
            font-weight: 600;
            border-color: #f59e0b;
        }
    </style>
</head>
<body class="antialiased text-gray-300">

    <div class="app-container">

        <header class="text-center my-4 px-4 flex-shrink-0">
            <div id="header-logo-container" class="h-32 md:h-40 w-full max-w-lg mx-auto flex items-center justify-center">
               <h1 class="drop-shadow-lg">NOMADS</h1>
            </div>
        </header>
        
        <div id="filter-status-container" class="px-4 pb-2 text-center flex-shrink-0">
            <h2 id="filter-status" class="text-xl font-rye text-amber-500 transition-opacity duration-300"></h2>
        </div>

        <main>
            <div id="menu-grid">
                </div>
             <button id="arrow-left" class="nav-arrow"><i class="fas fa-chevron-left"></i></button>
            <button id="arrow-right" class="nav-arrow"><i class="fas fa-chevron-right"></i></button>
        </main>

        <footer id="bottom-nav" class="flex-shrink-0 bg-gray-900/80 backdrop-blur-sm border-t border-gray-700 grid grid-cols-4 gap-2 p-2 z-20">
            <button id="home-btn" class="bottom-nav-btn">
                <i class="fas fa-home text-2xl"></i>
                <span class="text-xs">Home</span>
            </button>
            <button id="category-toggle-btn" class="bottom-nav-btn">
                <i class="fas fa-list-alt text-2xl"></i>
                <span class="text-xs">Categories</span>
            </button>
            <button id="roll-dice-btn" class="bottom-nav-btn">
                <i class="fas fa-dice text-2xl"></i>
                <span class="text-xs">Roll Dice</span>
            </button>
            <button id="bar-stock-btn" class="bottom-nav-btn">
                <i class="fas fa-wine-bottle text-2xl"></i>
                <span class="text-xs">Stock</span>
            </button>
        </footer>

    </div>

    <div id="category-popup" class="fixed inset-x-0 bottom-0 bg-gray-900/90 backdrop-blur-md border-t-2 border-amber-600 p-4 transform translate-y-full transition-transform duration-300 ease-in-out z-40">
        <h3 class="text-center font-rye text-amber-500 text-lg mb-4">Select a Category</h3>
        <div id="category-filter-list" class="grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-64 overflow-y-auto">
            </div>
    </div>


    <div id="bar-stock-modal" class="modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[95vh] flex flex-col border border-gray-600">
            <div class="p-6 border-b border-gray-600">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-white font-black-ops">Bar Stock</h2>
                    <button id="close-modal-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                </div>
            </div>
            <div id="bar-stock-content" class="p-6 text-gray-300 overflow-y-auto">
                <div>
                    <h3 class="text-xl text-green-400 mb-4 font-black-ops">IN STOCK</h3>
                    <div id="in-stock-lists"></div>
                </div>
                <div class="border-t-2 border-dashed border-gray-600 my-6"></div>
                <div>
                    <h3 class="text-xl text-red-400 mb-4 font-black-ops">OUT OF STOCK</h3>
                    <div id="out-of-stock-lists"></div>
                </div>
            </div>
        </div>
    </div>


    <script>
        const cocktails = [
            { name: "Redheaded Trouble", category: ["signature", "schnapps"], recipe: ["1 oz Jägermeister", "1 oz Peach Schnapps", "Fill a tall glass with Orange Juice"], story: "A redhead named Roxy used to ride a custom Triumph chopper into town, leaving a trail of broken hearts and bar tabs in her wake. They say this drink is as fiery and unpredictable as she was. One sip and you'll understand why some trouble is worth getting into." },
            { name: "Caramel Apple Cruiser", category: ["signature", "schnapps"], recipe: ["1 oz Butterscotch Schnapps", "1 oz Apple Pucker", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "This one's for the old-timer on the candy-apple red cruiser who always had a story and a piece of caramel candy to share. He said the secret to a long life on the road was a little bit of sweetness to cut through the grit. He wasn't wrong." },
            { name: "Irish Russian", category: ["signature", "vodka", "schnapps"], recipe: ["2 oz Grey Goose Vodka", "1 oz Kahlúa", "1 oz Baileys Irish Cream", "0.25 oz Simple Syrup", "Fill a tall glass with Club Soda"], story: "We invented this for a tough-as-nails biker from South Boston who claimed Irish blood and a Russian soul. He wanted a drink that was smooth on the outside but had a serious kick, just like him. It’s a tribute to a man who was a legend on two continents." },
            { name: "Purple Hooter", category: ["signature", "vodka", "schnapps"], recipe: ["1 oz Ketel One Vodka", "1 oz Raspberry Schnapps", "2 dashes Peychaud's Bitters", "Splash Lime Juice", "Fill a tall glass with Club Soda"], story: "We only serve this after we've taken your keys, because it's the kind of decision you make at 2 AM that feels brilliant. It's named for the sound you'll make after the second one, a tribute to late nights and loud pipes." },
            { name: "The Ghost Rider", category: ["signature", "tequila", "schnapps"], recipe: ["1 oz Pernod", "2 oz Jose Cuervo Silver Tequila", "Fill a tall glass with Club Soda", "Splash of Lime Juice"], story: "Named for a mysterious rider some folks swear they've seen on moonless nights, tearing up the highway on a bike with spectral, flaming wheels. No one knows where he came from or where he's going, but this drink is what we imagine fuels his eternal ride." },
            { name: "The Phantom Shift", category: ["signature", "gin", "schnapps"], recipe: ["1 oz Pernod", "1 oz Tanqueray Gin", "0.5 oz Lime Juice", "Top with Tonic Water in a tall glass"], story: "They say if you're on a lonely road at midnight, you might hear a bike shift gears when no one's there. That's the Phantom. This drink, with its ghostly hint of anise, is a toast to the riders we've lost but can still hear on the wind." },
            { name: "The White Liner", category: ["signature", "gin", "schnapps"], recipe: ["1.5 oz Tanqueray Gin", "0.75 oz St-Germain", "0.75 oz Lemon Juice", "2 dashes Orange Bitters", "Top with Club Soda in a tall glass"], story: "For the rider who stays true to their path, never wavering, like the white line on a dark highway. It's a clean, crisp, and straightforward drink for those who know exactly where they're going, even if it's the long way 'round." },
            { name: "The Junk Drawer", category: ["signature", "schnapps"], recipe: ["0.75 oz Raspberry Schnapps", "0.75 oz Butterscotch Schnapps", "0.75 oz Root Beer Schnapps", "Fill a tall glass with Club Soda"], story: "You know that drawer in your garage with all the leftover parts that don't seem to go together, but somehow you make it work? This is that, but in a glass. Surprisingly good, just like that custom build you frankensteined together." },
            { name: "The Blue Lagoon's Ghost", category: ["signature", "rum", "schnapps"], recipe: ["1.5 oz Bacardi Rum", "0.5 oz Blue Curacao", "0.5 oz Maraschino Liqueur", "Splash Lime Juice"], story: "A rider swore he saw a ghost ship on a moonlit ride along the coast, its ethereal blue lights glowing on the water. We made this drink to match his description of the spectral sight. It's as mysterious and captivating as his tale." },
            { name: "Two Kings", category: ["signature", "whiskey"], recipe: ["1 oz Knob Creek", "1 oz Crown Royal", "Top with Club Soda in a tall glass"], story: "For when you can't decide which king to follow—the rugged American frontiersman or the refined Canadian royal. This drink proves you don't have to choose. It’s a summit meeting in a glass where everyone gets along." },
            { name: "The Double Cross", category: ["signature", "whiskey", "schnapps"], recipe: ["2 oz Bulleit Bourbon", "1 oz Campari", "Half Salt, Half Sugar Rim"], story: "For the rider who plays both sides and answers to no one. It's a little sweet, a little bitter, and unapologetically bold. This drink doesn't trust anyone, and after one sip, you'll understand why it's good to keep 'em guessing." },
            { name: "The Blacktop Sunset", category: ["signature", "whiskey"], recipe: ["1 oz Jameson Irish Whiskey", "1 oz Southern Comfort", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "For that perfect moment when the sun dips below the horizon and the hot blacktop starts to cool. It's the taste of a long day's ride ending, with the promise of a wild night ahead. Smooth, warm, and just a little bit dangerous." },
            { name: "The Elderflower Nomad", category: ["signature", "gin", "schnapps"], recipe: ["1.5 oz Tanqueray Gin", "0.75 oz St-Germain", "0.5 oz Lime Juice", "2 dashes Rosemary Lavender Bitters", "Top with Club Soda in a tall glass"], story: "For the rider who takes the scenic route, the one who knows the best roads are the ones less traveled. This drink is a nod to the wildflowers you see on a long country ride—a little unexpected, but a damn fine discovery." },
            { name: "Finn's Orchard Kick", category: ["signature", "whiskey", "schnapps"], recipe: ["2 oz Jameson Irish Whiskey", "1 oz Apple Pucker", "2 dashes Angostura Bitters", "Top with Ginger Soda in a tall glass"], story: "An Irish rider named 'Finn' brought this idea in after a wild night in an apple orchard. He claimed he fought off a territorial badger for the last apple. We believe him. The drink is as sharp and spirited as his story." },
            { name: "The Apparition", category: ["vodka", "schnapps"], recipe: ["2 oz Ketel One Vodka", "0.75 oz St-Germain", "0.5 oz Lime Juice", "Fill a tall glass with Ginger Soda"], story: "For the rider who seems to show up out of nowhere and disappear just as quickly. This drink is clean, crisp, and almost ethereal—it’s there one moment and gone the next, leaving you wondering if you saw it at all." },
            { name: "Black-Top Burner", category: ["vodka", "schnapps"], recipe: ["1.5 oz Grey Goose Vodka", "0.5 oz Jägermeister", "Fill a tall glass with Cola"], story: "Named for the burnout marks left by a local legend's panhead every time he left the bar. This drink is dark, aggressive, and leaves its mark, just like Big Rick's rear tire on a hot summer night." },
            { name: "The Mechanic", category: ["vodka", "schnapps"], recipe: ["2 oz Stolichnaya Citros Vodka", "1 oz Blue Curacao", "2 dashes Orange Bitters", "Fill a tall glass with Sour Mix"], story: "An old-timer named Gus, who could fix a Harley with a paperclip and some duct tape, always drank this. He called it his 'liquid coolant.' It's sharp, electric, and gets the engine running every time." },
            { name: "Redline Riot", category: ["vodka", "schnapps"], recipe: ["1.5 oz Ketel One Vodka", "1 oz Cherry Schnapps", "Fill a tall glass with Sour Mix", "Splash of Lime Juice"], story: "You know that feeling when you push the engine to its absolute limit, just before it screams in protest? That's this drink. It's a high-RPM thrill ride for your taste buds that lives on the edge." },
            { name: "The Kickstart", category: ["rum"], recipe: ["2 oz Captain Morgan Spiced Rum", "0.5 oz Lime Juice", "Fill a tall glass with Ginger Soda"], story: "For those cold mornings when the engine just won't turn over and you need something with a little extra kick to get you going. This is the reliable jolt you need to start your day, or your night, the right way." },
            { name: "The Castaway", category: ["rum"], recipe: ["2 oz Captain Morgan Spiced Rum", "1 oz Pineapple Juice", "0.5 oz Orange Juice", "2 dashes Angostura Bitters", "Splash of Grenadine", "Top with Club Soda in a tall glass"], story: "A guy who rode in from the coast, salty and sun-beaten, asked for a drink that tasted like a place he'd been stranded once. He said it was a hell of a story, but he'd rather just have the drink. We obliged." },
            { name: "Storm Rider", category: ["rum"], recipe: ["2 oz Kraken Black Spiced Rum", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "This one's for the riders who don't pull over when the sky turns black. They ride into the storm, chasing the lightning. This drink is as dark and turbulent as a squall line on the horizon, with a spicy kick that hits like thunder." },
            { name: "The Kraken's Grip", category: ["rum", "schnapps"], recipe: ["1.5 oz Kraken Black Spiced Rum", "1 oz Amaretto", "Fill a tall glass with Cola"], story: "A sailor-turned-biker with a kraken tattooed up his arm used to order this. He said it was the only thing that could tame the beast. It's dark, deep, and once it gets ahold of you, it doesn't let go." },
            { name: "The Siren's Call", category: ["rum", "schnapps"], recipe: ["1.5 oz Kraken Black Spiced Rum", "0.75 oz Campari", "1.5 oz Pineapple Juice", "0.5 oz Lime Juice"], story: "A salty old road dog who'd been a sailor in another life told us of the sirens' song. He said it was both beautiful and bitter, a tempting call to the rocks. This drink is our tribute to that dangerous allure." },
            { name: "The Island Hopper", category: ["rum", "signature"], recipe: ["1 oz Malibu Rum", "1 oz Bacardi Rum", "Fill with Pineapple Juice", "Splash of Lime Juice"], story: "A sun-bleached rider on a chopper with custom surfboard racks inspired this one. He was chasing an endless summer, and this was his fuel. It’s a taste of the tropics for the biker with sand in his boots." },
            { name: "The Switchback", category: ["gin"], recipe: ["2 oz Tanqueray Gin", "1 oz Lime Juice", "Fill a tall glass with Club Soda"], story: "Named for those tight, winding mountain roads that test your nerve and skill. This drink is just as sharp and clean as a perfectly executed hairpin turn, a refreshing reward after a challenging ride." },
            { name: "The Long Haul", category: ["gin"], recipe: ["2 oz Tanqueray Gin", "0.5 oz Lime Juice", "Top with Tonic Water in a tall glass", "2 dashes Rosemary Lavender Bitters"], story: "This is the go-to for the old-timers who've seen every mile of Route 66 and then some. It's a classic, reliable, and refreshing companion for a journey with no end in sight. It's not about the destination, it's about the ride." },
            { name: "The Barbed Wire", category: ["gin", "schnapps"], recipe: ["1.5 oz Tanqueray Gin", "0.5 oz Jägermeister", "Fill a tall glass with Tonic Water"], story: "Some trails are best left untraveled, and this drink is a warning sign. It's sharp, aggressive, and has a bite you won't forget. Named for a shortcut through a rancher's field that ended badly for one of our own." },
            { name: "The Rattlesnake", category: ["tequila", "schnapps"], recipe: ["2 oz El Mayor Tequila", "0.5 oz Cherry Schnapps", "0.5 oz Lime Juice", "Top with Club Soda in a tall glass"], story: "You never hear the one that gets you. This drink is deceptively smooth at first, with a sweet cherry note that lures you in before the tequila strikes with a venomous bite. Respect it, or you'll regret it." },
            { name: "Dust Devil", category: ["tequila", "schnapps"], recipe: ["2 oz Jose Cuervo Silver Tequila", "1 oz Pineapple Juice", "0.5 oz Maraschino Liqueur", "Dash of Orange Bitters", "Top with Club Soda in a tall glass"], story: "For those days when the road is long, the sun is high, and the dust is thick. This drink is a whirlwind of flavor that appears out of nowhere to cut through the heat and grit, and then it's gone just as fast." },
            { name: "Desert Sunrise", category: ["tequila"], recipe: ["2 oz El Mayor Tequila", "Fill a tall glass with Orange Juice", "2 dashes Orange Bitters", "0.5 oz Grenadine"], story: "For the rider who's seen the sun come up over the desert plains, painting the sky in fiery colors. It's a tribute to a new day and another hundred miles of open road, with a promise of warmth and adventure." },
            { name: "The Gilded Serpent", category: ["tequila", "schnapps"], recipe: ["1.5 oz El Mayor Tequila", "0.75 oz St-Germain", "1 oz Pineapple Juice", "0.5 oz Lime Juice"], story: "Named after a custom gold-plated chopper that was beautiful but rumored to be cursed. This drink is just as alluring and just as dangerous. It's a rich, exotic ride that might just have a sting in its tail." },
            { name: "Mad Dog", category: ["dogs", "vodka"], recipe: ["2 oz Grey Goose Vodka", "Fill a tall glass with Cranberry Juice", "Salt Rim"], story: "The Salty Dog got put down. This is what's left: meaner, leaner, and with a bite that's worse than its bark. It's a straightforward drink for a complicated world. No frills, all business." },
            { name: "The Switchblade", category: ["dogs", "vodka"], recipe: ["2 oz Stolichnaya Citros Vodka", "1 oz Lemon Juice", "0.75 oz Simple Syrup", "Sugar Rim"], story: "A rider they called 'Showtime' used to order these—quick, sharp, and flashy. He said it was like a switchblade: looked pretty, but it was all business. One sip and you'll see what he meant." },
            { name: "The Junkyard Dog", category: ["dogs", "schnapps"], recipe: ["1 oz Jägermeister", "1 oz Southern Comfort", "0.5 oz Lime Juice", "Serve on the rocks"], story: "This drink is like a bike built from spare parts: it ain't pretty, but it's got character and it'll get the job done. It's a tough, scrappy mix for those who appreciate function over form." },
            { name: "The Wrench's Sidecar", category: ["classics", "schnapps"], recipe: ["2 oz E&J Brandy", "1 oz Cointreau", "0.75 oz Lemon Juice", "Sugar Rim"], story: "This ain't for the faint of heart; it's the classic cocktail for the guy who's not afraid to get his hands dirty. It's strong, reliable, and has been around longer than most of the bikes in the parking lot." },
            { name: "The Blackout", category: ["schnapps"], recipe: ["1.5 oz Jägermeister", "Fill a tall glass with Cola"], story: "A quiet rider named 'Crow' only drank this. He said it matched his bike and his mood. It's a simple, dark, no-nonsense drink for when you just want to fade into the background and watch the world burn." },
            { name: "Peaches 'n' Scream", category: ["schnapps", "whiskey"], recipe: ["1.5 oz Peach Schnapps", "0.5 oz Southern Comfort", "Fill a tall glass with Orange Juice"], story: "Named after a biker's girlfriend who was sweet as a peach but had a temper that could make a drill sergeant cry. This drink is the same—starts sweet, but finishes with a scream. You've been warned." },
            { name: "The Outlaw's Peach", category: ["schnapps"], recipe: ["1 oz Peach Schnapps", "1 oz Baileys Irish Cream", "Top with Cola in a tall glass"], story: "Looks smooth and creamy, but it's got a sweet, rebellious streak that'll catch you by surprise. It's the drink for those who look respectable but have a history they don't talk about. A true outlaw's secret." },
            { name: "The Apricot Ambush", category: ["schnapps", "signature"], recipe: ["1.5 oz E&J Brandy", "0.75 oz Apricot Brandy", "0.5 oz Lemon Juice", "Top with Club Soda"], story: "Looks innocent, like a sweet summer ride through the country. But this drink has a kick that comes out of nowhere, just like a speed trap on a long, empty stretch of highway. It'll get you every time." },
            { name: "The Crimson Guard", category: ["schnapps", "gin"], recipe: ["1.5 oz Sloe Gin", "0.5 oz Tanqueray Gin", "Fill a tall glass with Club Soda", "Splash of Lime Juice"], story: "Named for the old guard who protect the club's colors with their lives. This drink is deep red, unwavering, and carries the weight of tradition. It's a toast to loyalty and the brothers who stand beside you." },
            { name: "The Road Rash", category: ["schnapps", "whiskey"], recipe: ["1 oz Sloe Gin", "1 oz Southern Comfort", "0.5 oz Lemon Juice", "Fill a tall glass with Club Soda"], story: "We named this after a prospect took a spill trying to show off in the parking lot. It stings a little, it's a bit messy, but it's a lesson you won't forget. A reminder that the road always wins." },
            { name: "The Ruby Rider", category: ["schnapps"], recipe: ["2 oz Sloe Gin", "Fill a tall glass with Ginger Soda"], story: "A woman who rides a deep ruby-red Indian Scout is the only one who orders this. She says it matches her bike and her spirit: a little sweet, a little spicy, and completely unforgettable. We don't argue with her." },
            { name: "Cowboy's Hard Root Beer", category: ["whiskey", "schnapps"], recipe: ["1.5 oz Jameson Irish Whiskey", "1 oz Root Beer Schnapps", "0.5 oz Simple Syrup", "Top with Club Soda in a tall glass"], story: "This is Cowboy's signature drink. He's a lone wolf from Texas who says this is the only thing that tastes like home. It's a grown-up version of a childhood classic, for the man who's still a kid at heart." },
            { name: "Knob Creek Kentucky Smash", category: ["whiskey"], recipe: ["2 oz Knob Creek", "1 oz Lemon Juice", "0.75 oz Simple Syrup", "2 dashes Orange Bitters", "Top with Club Soda in a tall glass"], story: "A rider we call 'Wrench' drinks this after a long day in the shop. He says it's the only thing that can smash through the grease and grime. It's a powerhouse of a drink, built for hard work and harder living." },
            { name: "The Gilded Cage", category: ["whiskey", "schnapps"], recipe: ["1.5 oz Crown Royal", "0.5 oz Amaretto", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "For the rider who's got it all—the perfect bike, the perfect life—but still yearns for the open road. This drink tastes like luxury, but it has the soul of a rebel. A reminder that freedom can't be bought." },
            { name: "Bulleit Frontier Punch", category: ["whiskey"], recipe: ["2 oz Bulleit Bourbon", "2 oz Orange Juice", "0.5 oz Lemon Juice", "Splash of Grenadine", "Top with Club Soda in a tall glass"], story: "A group riding cross-country stops in every year and orders a round of these. They call it 'road medicine.' It's a potent punch that captures the spirit of the frontier: wild, untamed, and full of possibility." },
            { name: "Seagram's Stone Sour", category: ["whiskey"], recipe: ["2 oz Seagram's 7", "1 oz Lemon Juice", "0.5 oz Simple Syrup", "Splash of Orange Juice", "2 dashes Peychaud's Bitters", "Top with Club Soda in a tall glass"], story: "Everyone knows the simple Seagram's mix, but this is our version, built for the long haul. It's a dependable classic, upgraded for a rougher road. Like putting new pipes on an old, reliable bike." },
            { name: "Jim Beam Black Cherry Bomb", category: ["whiskey", "schnapps"], recipe: ["2 oz Jim Beam Bourbon", "0.5 oz Cherry Schnapps", "Fill a tall glass with Cola"], story: "This is for the new bloods who think they know it all. It starts off sweet and familiar, then hits you with an explosion of flavor you didn't see coming. It's a lesson in a glass: never underestimate the classics." },
            { name: "Southern Crossroads", category: ["whiskey", "schnapps"], recipe: ["1.5 oz Southern Comfort", "0.5 oz Sloe Gin", "Fill a tall glass with Orange Juice"], story: "A musician on a beat-up bike once asked for a drink that tasted like 'selling your soul for a song.' This is what we came up with. It's sweet, a little sinful, and goes down easy, but it might just cost you in the morning." },
            { name: "The Red Label Rider", category: ["whiskey", "classics"], recipe: ["2 oz Johnnie Walker Red Label", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "This is for the old-school rider on the vintage Norton who appreciates the classics. It's a timeless, no-nonsense drink that's traveled more miles than most people have. A tribute to enduring quality and timeless style." },
            { name: "The Bitter End", category: ["whiskey", "schnapps"], recipe: ["1.5 oz Four Roses Whiskey", "0.75 oz Campari", "2 dashes Angostura Bitters", "Fill a tall glass with Club Soda"], story: "Some rides don't have a happy ending. This drink is for those times. It's a bracing, bitter reminder that the road can be a harsh mistress. A toast to the hard lessons and the scars that prove you learned them." },
            { name: "Old Fashioned", category: ["classics", "whiskey"], recipe: ["2 oz Maker's Mark", "0.5 oz Simple Syrup", "2 dashes Orange Bitters", "Cherry Garnish", "Top with Club Soda in a tall glass"], story: "Old Man Hemlock, who founded the local chapter, only drinks this. He says it's because there's no point in improving on perfection. It's a testament to tradition, strength, and doing things the right way." },
            { name: "Margarita", category: ["classics", "tequila", "schnapps"], recipe: ["2 oz Jose Cuervo Silver Tequila", "1 oz Cointreau", "1 oz Lime Juice", "2 dashes Orange Bitters", "Salt Rim", "Top with Club Soda in a tall glass"], story: "A few guys rode in from Arizona, covered in dust and looking for something to cut through the desert heat. This is the only thing that worked. It's the official cure for a thousand miles of bad road and a parched throat." },
            { name: "Moscow Mule", category: ["classics", "vodka"], recipe: ["2 oz Ketel One Vodka", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "A prospect once complained his bike was kicking back on him like a stubborn mule. The old-timers handed him this and told him to drink up. It's got a kick of its own, but this one you'll actually enjoy." },
            { name: "Gin and Tonic", category: ["classics", "gin"], recipe: ["2 oz Tanqueray Gin", "Fill a tall glass with Tonic Water"], story: "This is for the Road Captain. It's clean, clear, and makes no apologies. It’s the drink of choice for the one who has to keep a level head while everyone else is losing theirs. A tribute to leadership and clear directions." },
            { name: "Screwdriver", category: ["classics", "vodka"], recipe: ["2 oz Stolichnaya Citros Vodka", "2 dashes Orange Bitters", "Fill a tall glass with Orange Juice"], story: "Knew a guy who swore he could fix his bike's wiring with nothing more than a screwdriver and a drink. He was half right. This is the drink. The wiring, however, is another story for another time." },
            { name: "Whiskey Sour", category: ["classics", "whiskey"], recipe: ["2 oz Jim Beam Bourbon", "1 oz Lemon Juice", "0.5 oz Simple Syrup", "2 dashes Angostura Bitters", "Top with Club Soda in a tall glass"], story: "A prospect once complained his mouth was as dry as the desert highway and his attitude was just as sour. This was the cure. It's a classic remedy for a bad day and a long, dusty road." },
            { name: "Cuba Libre", category: ["classics", "rum"], recipe: ["2 oz Bacardi Rum", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Cola"], story: "Every biker talks about freedom. The freedom of the open road, the freedom from the 9-to-5. This drink, whose name literally means 'Free Cuba,' is a toast to that spirit. A simple, potent reminder of what we're all riding for." },
            { name: "The Oath", category: ["classics", "whiskey", "schnapps"], recipe: ["2 oz Bulleit Bourbon", "0.75 oz Amaretto", "Serve on the rocks"], story: "This isn't for a night on the town. This is for when an oath is sworn and a promise is made. It's a serious drink for a serious moment, shared between brothers who know the weight of their words. It’s the taste of loyalty." },
            { name: "White Russian", category: ["classics", "vodka", "schnapps"], recipe: ["2 oz Grey Goose Vodka", "1 oz Kahlúa", "1 oz Baileys Irish Cream", "Top with Cola in a tall glass"], story: "We call this 'The Ghost.' It's for the quiet rider who shows up in all-white leathers, has one drink, and disappears into the night. Smooth, mysterious, and leaves you with more questions than answers." },
            { name: "Long Island Iced Tea", category: ["classics", "vodka", "gin", "rum", "tequila", "schnapps"], recipe: ["0.5 oz Grey Goose Vodka", "0.5 oz Tanqueray Gin", "0.5 oz Bacardi Rum", "0.5 oz Jose Cuervo Silver Tequila", "0.5 oz Cointreau", "1 oz Lemon Juice", "Fill a tall glass with Cola"], story: "A guy once bet he could build an engine from scratch after drinking three of these. He lost the bet, but he woke up with a half-assembled carburetor on his chest and a legendary story to tell. This drink makes bad ideas seem brilliant." }
        ];

        const menuData = cocktails.map(c => {
            let simpleCategory = c.category[0];
            if (c.category.includes('signature')) simpleCategory = 'signature';
            else if (c.category.includes('classics')) simpleCategory = 'classics';
            else if (c.category.includes('dogs')) simpleCategory = 'dogs';
            return {
                name: c.name,
                description: c.story,
                category: simpleCategory,
                recipe: c.recipe
            }
        });
        
        // --- API KEY and IMAGE GENERATION CODE REMOVED ---
        // const apiKey = ""; 
        // const imageApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
        // const generatedImagesCache = {}; // Removed cache as it's not needed for static images.
        // --- END REMOVED CODE ---

        let barStock = {};
        const STOCK_STORAGE_KEY = 'nomads_bar_stock_v2';

        const menuGrid = document.getElementById('menu-grid');
        const barStockModal = document.getElementById('bar-stock-modal');
        const filterStatusEl = document.getElementById('filter-status');
        const categoryPopup = document.getElementById('category-popup');
        const categoryToggleBtn = document.getElementById('category-toggle-btn');
        
        // --- Custom Image Function Added ---
        function getDrinkImage(category) {
            const base = "https://placehold.co/600x400/";
            const defaultStyle = "/1a110a/f59e0b?font=rye&text=";
            
            // Map categories to relevant biker-themed placeholder images
            switch (category) {
                case 'signature':
                    return base + "332b26/f59e0b" + defaultStyle + "NOMADS+SIGNATURE";
                case 'classics':
                    return base + "606d7e/ffffff" + defaultStyle + "ROAD+CLASSIC";
                case 'dogs':
                    return base + "991b1b/fef2f2" + defaultStyle + "MAD+DOGS";
                case 'whiskey':
                    return base + "543714/fdf2e1" + defaultStyle + "BOURBON+SMASH";
                case 'vodka':
                    return base + "3b3b4a/cffafe" + defaultStyle + "ICE+COLD+VODKA";
                case 'rum':
                    return base + "7c2d12/fef2f2" + defaultStyle + "SPICED+RUM";
                case 'gin':
                    return base + "4a7359/f3f4f6" + defaultStyle + "SMOOTH+GIN";
                case 'tequila':
                    return base + "84cc16/fefce8" + defaultStyle + "TEQUILA+SUNSET";
                case 'schnapps':
                    return base + "292524/fde047" + defaultStyle + "SCHNAPPS+MIX";
                default:
                    return base + "1a110a/f59e0b" + defaultStyle + "NOMADS+BAR";
            }
        }
        // --- END Custom Image Function ---

        // --- Bar Stock Logic (Unchanged) ---
        function parseIngredientName(ing) {
            let name = ing.replace(/^[\d./\s-]+(oz|dashes|dash|garnish)\s*/i, '');
            const instructionalPhrases = [ 'Fill a tall glass with ', 'Fill with ', 'Top with ', 'Splash of ', 'Splash ', 'Serve on the rocks', 'Half Salt, Half Sugar Rim', 'Salt Rim', 'Sugar Rim', 'Cherry ' ];
            for (const phrase of instructionalPhrases) {
                if (name.toLowerCase().startsWith(phrase.toLowerCase())) {
                    name = name.substring(phrase.length);
                    const inIndex = name.toLowerCase().indexOf(' in a');
                    if (inIndex > -1) name = name.substring(0, inIndex);
                    break;
                }
            }
            return name.trim();
        }

        function initializeBarStock() {
            const allIngredients = [...new Set(cocktails.flatMap(c => c.recipe.map(ing => parseIngredientName(ing))))].filter(Boolean).sort();
            const savedStock = localStorage.getItem(STOCK_STORAGE_KEY);
            if (savedStock) {
                barStock = JSON.parse(savedStock);
                allIngredients.forEach(ing => { if (barStock[ing] === undefined) barStock[ing] = true; });
            } else {
                allIngredients.forEach(ing => barStock[ing] = true);
            }
            saveBarStock();
            renderBarStockModal();
        }

        function saveBarStock() {
            localStorage.setItem(STOCK_STORAGE_KEY, JSON.stringify(barStock));
        }

        function renderBarStockModal() {
            const inStockContainer = document.getElementById('in-stock-lists');
            const outOfStockContainer = document.getElementById('out-of-stock-lists');
            inStockContainer.innerHTML = '';
            outOfStockContainer.innerHTML = '';

            // Define ingredient categories with sub-categories
            const ingredientCategories = {
                'Spirits': {
                    'Whiskey & Bourbon': ['Bulleit Bourbon', 'Crown Royal', 'Four Roses Whiskey', 'Jameson Irish Whiskey', 'Jim Beam Bourbon', 'Johnnie Walker Red Label', 'Knob Creek', 'Maker\'s Mark', 'Seagram\'s 7', 'Southern Comfort'],
                    'Vodka': ['Grey Goose Vodka', 'Ketel One Vodka', 'Stolichnaya Citros Vodka'],
                    'Gin': ['Tanqueray Gin'],
                    'Rum': ['Bacardi Rum', 'Captain Morgan Spiced Rum', 'Kraken Black Spiced Rum', 'Malibu Rum'],
                    'Tequila': ['El Mayor Tequila', 'Jose Cuervo Silver Tequila'],
                    'Brandy': ['E&J Brandy'],
                },
                'Liqueurs & Schnapps': {
                    'Fruit': ['Apple Pucker', 'Apricot Brandy', 'Blue Curacao', 'Cherry Schnapps', 'Cointreau', 'Maraschino Liqueur', 'Peach Schnapps', 'Raspberry Schnapps', 'Sloe Gin'],
                    'Herbal & Spiced': ['Campari', 'Jägermeister', 'Pernod', 'St-Germain'],
                    'Cream, Nut & Coffee': ['Amaretto', 'Baileys Irish Cream', 'Kahlúa'],
                    'Other Schnapps': ['Butterscotch Schnapps', 'Root Beer Schnapps']
                },
                'Mixers & Bitters': {
                    'Sodas & Juices': ['Club Soda', 'Cola', 'Cranberry Juice', 'Ginger Soda', 'Lemon Juice', 'Lime Juice', 'Orange Juice', 'Pineapple Juice', 'Sour Mix', 'Tonic Water'],
                    'Bitters': ['Angostura Bitters', 'Orange Bitters', 'Peychaud\'s Bitters', 'Rosemary Lavender Bitters'],
                    'Syrups': ['Grenadine', 'Simple Syrup'],
                },
                'Other': {
                    'Garnish & Rims': ['Cherry Garnish', 'Half Salt, Half Sugar Rim', 'Salt Rim', 'Sugar Rim']
                }
            };

            const renderButtonsForStatus = (status) => {
                let html = '';
                Object.keys(ingredientCategories).forEach(mainCategoryName => {
                    let mainCategoryHtml = '';
                    let hasContentInMainCategory = false;

                    Object.keys(ingredientCategories[mainCategoryName]).forEach(subCategoryName => {
                        const subCategoryIngredients = ingredientCategories[mainCategoryName][subCategoryName]
                            .filter(ing => barStock[ing] === status)
                            .map(ing => `<button data-ingredient="${ing}" class="ingredient-btn ${!status ? 'out-of-stock' : ''} text-sm bg-gray-700 hover:bg-gray-600 text-white py-1 px-4 rounded-lg transition-colors">${ing}</button>`)
                            .join('');

                        if (subCategoryIngredients.length > 0) {
                            hasContentInMainCategory = true;
                            mainCategoryHtml += `
                                <div class="mb-3">
                                    <h5 class="text-md font-bold text-gray-400 mb-2">${subCategoryName}</h5>
                                    <div class="flex flex-wrap gap-2">
                                        ${subCategoryIngredients}
                                    </div>
                                </div>
                            `;
                        }
                    });

                    if (hasContentInMainCategory) {
                        html += `
                            <div class="mb-6">
                                <h4 class="text-xl font-rye text-amber-500 mb-3 border-b-2 border-gray-600 pb-2">${mainCategoryName}</h4>
                                ${mainCategoryHtml}
                            </div>
                        `;
                    }
                });
                return html;
            };

            inStockContainer.innerHTML = renderButtonsForStatus(true);
            outOfStockContainer.innerHTML = renderButtonsForStatus(false);
        }
        
        function isDrinkMakeable(drink) {
            if (!drink.recipe) return true;
            return drink.recipe.every(ingStr => {
                const ingName = parseIngredientName(ingStr);
                return barStock[ingName] !== false;
            });
        }

        function toggleStock(ingredient) {
            barStock[ingredient] = !barStock[ingredient];
            saveBarStock();
            renderBarStockModal();
            const activeBtn = document.querySelector('#category-filter-list .category-btn.is-active');
            if (activeBtn) {
                 filterMenu(activeBtn.dataset.category, activeBtn, true);
            }
        }

        // --- Menu Rendering Logic ---
        function renderMenu(itemsToRender) {
            menuGrid.innerHTML = '';
            itemsToRender.forEach((item) => {
                const isUnavailable = !isDrinkMakeable(item);
                const unavailableClass = isUnavailable ? 'is-unavailable' : '';
                
                // Use the new simplified image logic
                const imageUrl = getDrinkImage(item.category); 

                const cardHtml = `
                    <div class="drink-card ${unavailableClass}" data-name="${item.name}" data-category="${item.category}">
                        <div class="drink-card-inner">
                            <div class="drink-card-front">
                                 <div class="image-area drink-image-area">
                                     <img src="${imageUrl}" alt="${item.name} - ${item.category} drink" loading="lazy" class="loaded">
                                 </div>
                                <div class="p-4 flex flex-col flex-grow">
                                     <h3 class="text-2xl font-rye text-amber-400 mb-3 text-center">${item.name}</h3>
                                     <ul class="text-gray-300 text-sm flex-grow space-y-1 list-disc list-inside px-2">
                                        ${item.recipe.map(r => `<li>${r}</li>`).join('')}
                                     </ul>
                                </div>
                                <div class="text-center text-xs text-gray-500 pb-2 font-rye">Tap for the Legend</div>
                            </div>
                            <div class="drink-card-back">
                                <div class="image-area drink-image-area">
                                     <img src="${imageUrl}" alt="${item.name} - ${item.category} drink" loading="lazy" class="loaded">
                                </div>
                                <div class="p-4 flex flex-col flex-grow overflow-y-auto">
                                    <h3 class="text-2xl font-rye text-amber-400 mb-2 text-center">${item.name}</h3>
                                    <p class="text-gray-300 italic">"${item.description}"</p>
                                </div>
                                <div class="text-center text-xs text-gray-500 pb-2 font-rye">Tap for Recipe</div>
                            </div>
                        </div>
                    </div>`;
                menuGrid.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        function renderCategories() {
            const categoryContainer = document.getElementById('category-filter-list');
            const categories = ['all', 'signature', 'classics', 'dogs', 'whiskey', 'vodka', 'gin', 'rum', 'tequila', 'schnapps'];
            let buttonsHtml = categories.map((cat) => `
                <button 
                    data-category="${cat}"
                    class="category-btn" 
                    onclick="filterMenu('${cat}', this)">
                    ${cat.charAt(0).toUpperCase() + cat.slice(1)}
                </button>
            `).join('');
            categoryContainer.innerHTML = buttonsHtml;
        }

        function filterMenu(category, btnElement, forceRender = false) {
            if (category === 'all') {
                filterStatusEl.textContent = 'DILLIGAF';
            } else {
                filterStatusEl.textContent = `Showing: ${category.charAt(0).toUpperCase() + category.slice(1)}`;
            }

            if (!forceRender) {
                const currentActive = document.querySelector('#category-filter-list .category-btn.is-active');
                if (currentActive) currentActive.classList.remove('is-active');
                if (btnElement) btnElement.classList.add('is-active');
                
                categoryPopup.classList.remove('is-open');
                document.querySelectorAll('.bottom-nav-btn').forEach(btn => btn.classList.remove('is-active'));
                if (category === 'all') {
                    document.getElementById('home-btn').classList.add('is-active');
                } else {
                    categoryToggleBtn.classList.add('is-active');
                }
            }
           
            const filteredCocktails = category === 'all' 
                ? cocktails
                : cocktails.filter(item => item.category.includes(category));
            
            const itemsToRender = filteredCocktails.map(c => {
                let simpleCategory = c.category[0];
                if (c.category.includes('signature')) simpleCategory = 'signature';
                else if (c.category.includes('classics')) simpleCategory = 'classics';
                else if (c.category.includes('dogs')) simpleCategory = 'dogs';
                return { name: c.name, description: c.story, category: simpleCategory, recipe: c.recipe };
            });

            renderMenu(itemsToRender);
            // setupImageLoadingObserver(); // Intersection Observer no longer needed since images load instantly
        }

        // --- Image Generation Logic Removed/Simplified ---
        // The previous async `generateAndPlaceImage` and the `setupImageLoadingObserver` 
        // that used it are removed since we are now using simple placeholder images.
        // I've removed the `setupImageLoadingObserver()` call from `filterMenu`.
        
        // --- New "Roll Dice" Feature (Unchanged) ---
        function rollDice() {
            const makeableDrinks = menuData.filter(isDrinkMakeable);
            const drinksToChooseFrom = makeableDrinks.length > 0 ? makeableDrinks : menuData;
            if (drinksToChooseFrom.length === 0) return;

            const randomDrink = drinksToChooseFrom[Math.floor(Math.random() * drinksToChooseFrom.length)];
            
            const activeCategoryButton = document.querySelector('#category-filter-list .category-btn.is-active');
            const currentCategory = activeCategoryButton ? activeCategoryButton.dataset.category : 'all';

            const drinkData = cocktails.find(c => c.name === randomDrink.name);
            const drinkIsInCurrentCategory = drinkData && drinkData.category.includes(currentCategory);

            if (currentCategory !== 'all' && !drinkIsInCurrentCategory) {
                const allButton = document.querySelector('#category-filter-list .category-btn[data-category="all"]');
                filterMenu('all', allButton, false);
                setTimeout(() => {
                    const cardToScrollTo = document.querySelector(`.drink-card[data-name="${randomDrink.name}"]`);
                    if (cardToScrollTo) highlightAndScrollToCard(cardToScrollTo);
                }, 100);
            } else {
                const cardToScrollTo = document.querySelector(`.drink-card[data-name="${randomDrink.name}"]`);
                if (cardToScrollTo) highlightAndScrollToCard(cardToScrollTo);
            }
        }

        function highlightAndScrollToCard(card) {
            card.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            document.querySelectorAll('.is-highlighted').forEach(c => c.classList.remove('is-highlighted'));
            card.classList.add('is-highlighted');
            setTimeout(() => {
                card.classList.remove('is-highlighted');
            }, 2500);
        }


        // Initial Load & Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            initializeBarStock();
            filterMenu('all', document.querySelector('#category-filter-list .category-btn[data-category="all"]'));

            categoryToggleBtn.addEventListener('click', () => {
                const isOpen = categoryPopup.classList.toggle('is-open');
                categoryToggleBtn.classList.toggle('is-active', isOpen);
            });

            document.getElementById('close-modal-btn').addEventListener('click', () => {
                barStockModal.classList.add('opacity-0');
                setTimeout(() => barStockModal.classList.add('hidden'), 300);
            });
            
            document.getElementById('bar-stock-btn').addEventListener('click', () => {
                barStockModal.classList.remove('hidden');
                setTimeout(() => barStockModal.classList.remove('opacity-0'), 10);
                categoryPopup.classList.remove('is-open'); // Close category popup if open
                categoryToggleBtn.classList.remove('is-active');
            });

            document.getElementById('home-btn').addEventListener('click', () => {
                const allButton = document.querySelector('#category-filter-list .category-btn[data-category="all"]');
                if (allButton) {
                    filterMenu('all', allButton);
                }
            });
            
            document.getElementById('roll-dice-btn').addEventListener('click', () => {
                rollDice();
                categoryPopup.classList.remove('is-open'); // Close category popup if open
                categoryToggleBtn.classList.remove('is-active');
            });
            
            barStockModal.addEventListener('click', (e) => {
                if(e.target.closest('.ingredient-btn')) {
                    toggleStock(e.target.closest('.ingredient-btn').dataset.ingredient);
                }
            });

            menuGrid.addEventListener('click', e => {
                const card = e.target.closest('.drink-card');
                if (card) {
                    card.classList.toggle('is-flipped');
                }
            });

            document.getElementById('arrow-left').addEventListener('click', () => {
                const cardWidth = menuGrid.querySelector('.drink-card')?.offsetWidth || 300;
                menuGrid.scrollBy({ left: -(cardWidth + 24), behavior: 'smooth' }); // 24px is the gap
            });

             document.getElementById('arrow-right').addEventListener('click', () => {
                const cardWidth = menuGrid.querySelector('.drink-card')?.offsetWidth || 300;
                menuGrid.scrollBy({ left: cardWidth + 24, behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
