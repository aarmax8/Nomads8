<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <!-- UPDATED: Added viewport-fit=cover to allow the app to fill the entire screen -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>DILLIGAF</title>

    <!-- ADDED: Meta tags for iOS full-screen app experience -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Nomad's">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/aarmax8/Nomads/b15a4394afade6bb543c1ece00102771641d1c82/Nicon5.png">
    
    <!-- End of added tags -->

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Cinzel:wght@400;700&family=IM+Fell+DW+Pica&family=Roboto+Condensed:wght@700&family=Rye&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- CSS FIX FOR iOS PWA FULLSCREEN --- */
        html {
            overscroll-behavior-y: contain;
            overflow: hidden;
            
            /* MODIFIED: Change to height: 100% */
            height: 100%;
            /* ADDED: Match body property for iOS PWA reliability */
            height: -webkit-fill-available; 
            
            margin: 0;
            padding: 0;
        }

        /* --- ADDED BACK: CORE LAYOUT STYLES --- */
        body {
            background-color: #000;
            font-family: 'Roboto Condensed', sans-serif;
            overscroll-behavior-y: contain; /* Prevents pull-to-refresh on body */
            overflow: hidden; /* Prevents scrolling on body */
            height: 100%;
            height: -webkit-fill-available; /* For iOS PWA */
            margin: 0;
            padding: 0;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100%;
            min-height: -webkit-fill-available; /* Match body for iOS */
            width: 100%;
            max-width: 1024px; /* Center content on desktop */
            margin: 0 auto;
            background-color: #000;
            
            /* This is the gradient background for the app */
            /* UPDATED: New background image URL */
            /* UPDATED: Made gradient lighter as requested */
            background-image: linear-gradient(to bottom, rgba(17, 17, 17, 0.5), rgba(17, 17, 17, 0.7) 50%, #000 100%), url('https://raw.githubusercontent.com/aarmax8/Nomads/c81556a569470611da64fb23e311817602720d95/pittsburghbridge.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* Keep background stationary */
            
            padding-top: env(safe-area-inset-top); 
        }

        header {
            flex-shrink: 0; /* Header should not shrink */
            position: relative; /* For z-index and pseudo-elements */
            height: 150px;
            z-index: 10; /* Keep header above main content */
        }
        
        /* REMOVED: Fade-out effect at the top of the header */
        /* header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(to bottom, rgba(17, 17, 17, 0.5) 0%, transparent 100%);
            z-index: 2;
            pointer-events: none;
        }
        */
        
        main {
            flex-grow: 1; /* Allow main content to grow and fill space */
            z-index: 1; 
            min-height: 0; /* Ensure main content can shrink if needed */
            display: flex;
            flex-direction: column; 
        } 
        /* --- END OF ADDED STYLES --- */

        /* MODIFIED: This selector was a typo. It was #header-logo-container, which broke the layout. */
        /* It now correctly targets the <img> tag INSIDE the container. */
        #header-logo-image {
            width: 100%;
            height: 100%;
            object-fit: fill; /* Stretches to fill the container */
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* --- Headlight Effect --- */
        #header-logo-container::after {
            content: '';
            position: absolute;
            top: 80%; 
            left: -150%; 
            width: 200px; 
            height: 200px; 
            margin-top: -100px; 
            background: radial-gradient(ellipse at center, 
                rgba(255, 255, 255, 0.3) 0%, 
                rgba(255, 255, 255, 0.05) 50%, 
                rgba(255, 255, 255, 0) 70% 
            );
            border-radius: 50%; 
            filter: blur(20px); 
            transform: skewX(0); 
            animation: glint-effect 7s infinite linear; 
            animation-delay: 1s;
            z-index: 2; 
        }

        @keyframes glint-effect {
            100% {
                left: 150%;
            }
        }
        
        /* --- NEW: Action Bar (between header and cards) --- */
        #action-bar {
            flex-shrink: 0;
            /* background-color: rgba(0, 0, 0, 0.1); */
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Override footer-btn styles when inside action-bar */
        #action-bar .footer-btn {
            font-size: 0.75rem; /* 12px */
            color: #b0b0b5; 
            padding-top: 0.25rem; /* Add a bit of top padding */
        }
        #action-bar .footer-btn i {
            font-size: 1.25rem; /* 20px */
            margin-bottom: 0.2rem;
            color: #b0b0b5;
        }

        /* Override active states for action-bar */
        #action-bar .footer-btn.is-active-filter {
            color: #f59e0b; 
        }
        #action-bar .footer-btn.is-active-filter i {
            color: #f59e0b; 
        }
        
        /* MODIFIED: Changed color from red to amber */
        #action-bar #action-favorites-btn.is-active {
            color: #f59e0b; /* Was #ef4444 */
        }
        #action-bar #action-favorites-btn.is-active i {
            color: #f59e0b; /* Was #ef4444 */
        }
        /* --- End Action Bar Styles --- */
        
        #menu-grid {
            display: flex; gap: 1.5rem; overflow-x: auto; 
            scroll-snap-type: x mandatory; 
            scroll-behavior: smooth; 
            scroll-padding: 1rem; -webkit-overflow-scrolling: touch; 
            
            /* MODIFIED: Reduced padding-bottom from 40px to 0px. */
            /* This will make the cards scroll all the way to the bottom, */
            /* appearing behind the transparent footer. */
            padding: 0 0 env(safe-area-inset-bottom);
            
            /* MODIFIED: ADDED flex-grow back. This makes the grid fill main. */
            flex-grow: 1;
            min-height: 0; 

            box-sizing: border-box; 
        }
        
        /* --- Amber Scrollbar for Menu Grid --- */
        #menu-grid::-webkit-scrollbar { 
            width: 8px; 
            height: 8px; 
        }
        #menu-grid::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3); 
            border-radius: 4px;
        }
        #menu-grid::-webkit-scrollbar-thumb {
            background-color: #f59e0b; /* Amber color */
            border-radius: 4px;
            border: 2px solid rgba(0,0,0,0.3); 
        }
        #menu-grid::-webkit-scrollbar-thumb:hover {
            background-color: #fbbf24; 
        }
        #menu-grid { 
            -ms-overflow-style: auto; 
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #f59e0b rgba(0,0,0,0.3); /* Firefox */
        }
        /* --- End Amber Scrollbar --- */


        .drink-card {
            /* MODIFIED: Was 84%, narrowed to show peek of next card */
            flex: 0 0 80%; 
            scroll-snap-align: center; 
            perspective: 1500px;
            background-color: transparent; 
            transition: opacity 0.3s;
            margin-left: auto;
            margin-right: auto;
            position: relative; 
        }
        #menu-grid > .drink-card:first-child {
             /* MODIFIED: Was 84% */
             margin-left: calc((100% - 80%) / 2); 
        }
         #menu-grid > .drink-card:last-child {
             /* MODIFIED: Was 84% */
             margin-right: calc((100% - 80%) / 2); 
         }
 
        @media (min-width: 640px) { 
            .drink-card { flex-basis: 70%; }
            #menu-grid > .drink-card:first-child { margin-left: calc((100% - 70%) / 2); }
            #menu-grid > .drink-card:last-child { margin-right: calc((100% - 70%) / 2); }
        } 
        @media (min-width: 1024px) { 
            .drink-card { flex-basis: 50%; }
             #menu-grid > .drink-card:first-child { margin-left: calc((100% - 50%) / 2); }
             #menu-grid > .drink-card:last-child { margin-right: calc((100% - 50%) / 2); }
        } 
        .drink-card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.7s, box-shadow 0.4s ease-in-out, opacity 0.5s;
            transform-style: preserve-3d;
            box-shadow: 0 8px 20px rgba(0,0,0,0.7); border-radius: 0.5rem;
        }
        .drink-card.is-flipped .drink-card-inner { transform: rotateY(180deg); }
        
        /* Active card glows */
        .drink-card.is-active .drink-card-inner {
             box-shadow: 0 0 25px 8px rgba(45, 212, 191, 0.7); /* Turquoise glow */
        }
        .drink-card.is-active.is-flipped .drink-card-inner {
             box-shadow: 0 0 25px 8px rgba(245, 158, 11, 0.7); /* Amber glow */
        }
        .drink-card.is-highlighted .drink-card-inner {
             box-shadow: 0 0 25px 8px rgba(245, 158, 11, 0.7); /* Amber glow */
        }
        
        .drink-card-front, .drink-card-back {
            position: absolute; width: 100%; height: 100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;
            display: flex; flex-direction: column; overflow: hidden; border-radius: 0.5rem;
        }

        /* === CARD FRONT === */
        .drink-card-front {
            background-image: linear-gradient(145deg, rgba(42, 10, 10, 0.8) 0%, rgba(28, 7, 7, 0.8) 100%), url('https://github.com/aarmax8/Nomads/blob/639ee0ed0a332926ddf78c332e7c114a32af99ab/leather%20background.jpg?raw=true');
            background-size: cover;
            background-position: center;
            box-shadow: none;
            border: 2px solid #2dd4bf; /* Active border */
        }
        .card-header-front {
            position: relative; 
            /* MODIFIED: Reduced top/bottom padding from 1rem to 0.75rem */
            padding: 0.75rem 4rem 0.75rem 1.25rem; 
            background: transparent; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: none; 
            flex-shrink: 0;
        }
        .recipe-content { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 0 1.5rem; 
            min-height: 0; /* ADDED: Explicit min-height: 0 for flex child */
        }
        .recipe-content::-webkit-scrollbar { width: 4px; }
        .recipe-content::-webkit-scrollbar-track { background: transparent; }
        .recipe-content::-webkit-scrollbar-thumb { background-color: #2dd4bf; border-radius: 4px; }

        .recipe-list-front { list-style: none; padding: 0; }
        .recipe-list-front li {
            display: flex; align-items: center; font-family: 'Roboto Condensed', sans-serif;
            /* MODIFIED: Increased font size back to 1rem for readability */
            font-size: 1rem; 
            /* MODIFIED: Increased line height from 1.25 to 1.3 */
            line-height: 1.3; 
            letter-spacing: 0.02em; 
            /* MODIFIED: Increased margin from 0.25rem to 0.375rem */
            margin-bottom: 0.375rem; 
            color: #e5e7eb; 
        }
        .recipe-list-front li i { 
            width: 24px; text-align: center; 
            /* MODIFIED: Increased margin from 0.75rem to 1rem */
            margin-right: 1rem; 
            /* MODIFIED: Increased icon size from 1rem to 1.125rem */
            font-size: 1.125rem; 
        }
        .card-footer {
            padding: 0;
            flex-shrink: 0;
            border-top: none;
            background: transparent;
        }
        
        .card-hook-tagline {
            text-align: center; 
            /* MODIFIED: Reduced font size from 1.125rem to 1rem */
            font-size: 1rem; 
            line-height: 1.4;
            color: #2dd4bf; 
            text-shadow: 0 0 8px rgba(45, 212, 191, 0.7); 
            /* MODIFIED: Reduced padding from 0.5rem to 0.375rem */
            padding: 0.375rem 1.5rem; 
            font-family: 'Cinzel', serif; 
            letter-spacing: 0.03em; 
            flex-shrink: 0;
            background: transparent; 
            border-top: 1px solid rgba(255, 255, 255, 0.1); 
            font-style: normal; 
        }
        
        /* === END CARD FRONT === */


        /* --- Story Card Back --- */
        .drink-card-back {
            transform: rotateY(180deg); 
            background-color: #111; 
            border: 2px solid #854d0e; 
            color: #e5e7eb;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Push content to bottom */
            
            --bg-image: none;
            background-image: 
                linear-gradient(to bottom, rgba(17,17,17,0.8) 0%, transparent 15%), 
                linear-gradient(to top, rgba(17,17,17,1) 0%, rgba(17,17,17,0.9) 20%, transparent 55%),
                var(--bg-image);

            background-position: center, center, top;
            background-repeat: no-repeat;
            background-size: 100% 100%, 100% 100%, cover;
        }

        .card-back-content {
            padding: 0 1.25rem;
            flex-grow: 0; 
            display: flex; flex-direction: column;
            overflow-y: auto;
            max-height: 50%; 
            position: relative;
            z-index: 2;
        }

        .story-text {
            font-family: 'IM Fell DW Pica', serif;
            font-style: italic;
            text-align: justify;
            font-size: 1.15rem;
            line-height: 1.5;
            color: #e5e7eb; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8); 
        }

        .card-back-content::-webkit-scrollbar { width: 4px; }
        .card-back-content::-webkit-scrollbar-track { background: transparent; }
        .card-back-content::-webkit-scrollbar-thumb { background-color: #854d0e; border-radius: 4px; }
        
        .no-image .card-back-content {
            margin-top: 0;
            justify-content: center;
            max-height: 100%;
        }
         .no-image {
            background-image: none; 
         }
        .card-footer-back {
             padding: 0.5rem 0.75rem;
            background: rgba(0,0,0,0.3);
            border-top: 2px double rgba(133, 77, 14, 0.5);
            font-style: normal;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60px;
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: #f59e0b;
            text-shadow: 0 0 8px rgba(245, 158, 11, 0.7);
            z-index: 2; 
            flex-shrink: 0; 
        }


        /* --- FAVORITES --- */
        .favorite-btn {
            position: absolute;
            z-index: 10;
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            transform: translateZ(0); 
        }
        .is-flipped .drink-card-front .favorite-btn {
            display: none;
        }
        .drink-card-front .favorite-btn {
            top: 1rem; 
            right: 1rem;
            bottom: auto; 
        }
        .favorite-btn:hover {
            transform: scale(1.1);
            background: rgba(0,0,0,0.7);
        }
        .favorite-btn .fa-heart {
            font-size: 1.2rem;
            color: #9ca3af; 
            transition: all 0.2s ease;
            transform: translateZ(0); 
        }
        /* MODIFIED: Changed color from red to amber */
        .favorite-btn.is-favorite .fa-heart {
            color: #f59e0b; /* Was #ef4444 */
            text-shadow: 0 0 8px rgba(245, 158, 11, 0.7); /* Was rgba(239, 68, 68, 0.7) */
        }

        #favorites-list-container .favorite-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            background: rgba(245, 158, 11, 0.05);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #favorites-list-container .favorite-item:hover {
            background: rgba(245, 158, 11, 0.15);
        }
        
        .drink-card.is-unavailable { opacity: 0.4; pointer-events: none; }
        .drink-card-title {
            font-size: 2rem; 
            line-height: 1.2; color: #f59e0b; text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 10px rgba(245, 158, 11, 0.5);
            padding-bottom: 0.25rem; 
        }
        .drink-card[data-is-barcode="true"] .drink-card-title {
            font-family: 'Cinzel', serif;
            font-size: 1.75rem;
        }

        .drink-card[data-is-barcode="true"] .card-footer {
            background: transparent;
            border: none;
            font-style: normal;
            color: #2dd4bf; 
            text-shadow: 0 0 6px rgba(45, 212, 191, 0.6);
            font-family: 'Cinzel', serif;
            /* ADDED: Ensure no extra margin is pushing this content up */
            margin-bottom: 0;
        }
        

        .modal { transition: opacity 0.3s ease-in-out; }
        
        /* --- Filters & Pills --- */
        .filter-separator {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.1);
            margin: 1.5rem 0;
        }
        .filter-pill {
            background-color: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }
        .filter-pill:hover {
            background-color: rgba(45, 212, 191, 0.15); 
            border-color: rgba(45, 212, 191, 0.3);
        }
        .filter-pill.is-active {
            background-color: #2dd4bf; 
            color: #0f172a; 
            border-color: #2dd4bf;
            font-weight: 600;
            box-shadow: 0 0 10px rgba(45, 212, 191, 0.5); 
        }
        
        /* REMOVED: These rules are no longer used by any element */
        /* #filter-bar-favs.is-active { ... } */
        /* #filter-bar-favs:hover:not(.is-active) { ... } */

        .ingredient-btn {
            background-color: rgba(255, 255, 255, 0.07) !important;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease-in-out;
            border-radius: 0.5rem !important;
        }
        .ingredient-btn:hover {
            background-color: rgba(255, 255, 255, 0.15) !important;
            border-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.03);
        }

        /* ADDED: Rule to remove bottom margin from prev/next icons */
        #scroll-prev-btn i,
        #scroll-next-btn i {
            margin-bottom: 0;
        }

        /* --- Modal Styles --- */
        .modal-panel {
            background-image: radial-gradient(circle at top, rgba(41, 37, 36, 0.4), rgba(28, 25, 23, 0.7)), url('https://www.transparenttextures.com/patterns/leather.png');
            border: 2px solid #f59e0b;
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.3), inset 0 0 20px rgba(245, 158, 11, 0.15);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }
        .modal-header {
            border-bottom: 1px solid rgba(245, 158, 11, 0.4);
        }
        .modal-header h2 {
            text-shadow: 0 0 12px rgba(245, 158, 11, 0.8);
        }
        /* UPDATED: Added flex-grow and min-height to bar stock content for scrolling */
        #bar-stock-content {
            flex-grow: 1; /* Allow content to grow */
            min-height: 0; /* Allow content to shrink */
            overflow-y: auto; /* Enable scrolling */
        }
        #bar-stock-content .ingredient-btn {
            background-color: rgba(245, 158, 11, 0.1) !important;
            border: 1px solid rgba(245, 158, 11, 0.3) !important;
            color: #e2e8f0; 
        }
        #bar-stock-content .ingredient-btn:hover {
            background-color: rgba(245, 158, 11, 0.25) !important;
            border-color: rgba(245, 158, 11, 0.6) !important;
            color: #fff;
        }

        #reset-filters-btn {
            background-color: transparent;
            border-color: #6b7280;
        }
         #reset-filters-btn:hover {
            background-color: #374151;
            border-color: #9ca3af;
         }
         #apply-filters-btn {
            background-color: #0d9488; 
            border: 1px solid transparent;
            color: #fff; 
         }
        #apply-filters-btn:hover {
            background-color: #14b8a6; 
        }

        /* Barcode Card */
        .drink-card[data-is-barcode="true"] .drink-card-inner {
            background-color: #111;
            border: 3px double #525252;
            box-shadow: 0 8px 20px rgba(0,0,0,0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            /* MODIFIED: Changed from space-around to space-between for tighter fit */
            justify-content: space-between; 
            padding: 1rem;
        }
        .drink-card[data-is-barcode="true"] img {
            width: 100%;
            border-radius: 0.5rem;
            object-fit: contain;
            max-height: 65%;
        }

        
        /* --- New Footer Button Styles (Base) --- */
        .footer-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            /* MODIFIED: iOS-style neutral gray */
            color: #8e8e93; 
            /* MODIFIED: Reduced vertical padding to 0, horizontal padding to 0.25rem */
            padding: 0 0.25rem; 
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            /* MODIFIED: Reduced font size from 0.75rem to 0.65rem (approx 10px) */
            font-size: 0.65rem; 
            width: 60px; /* Give them a consistent width */
            line-height: 1.2;
        }
        .footer-btn i {
            /* MODIFIED: Made icons smaller (was 1.1rem) */
            font-size: 1.0rem; /* Icon size */
            /* MODIFIED: Reduced margin-bottom (was 0.25rem) */
            margin-bottom: 0.1rem;
            /* MODIFIED: iOS-style neutral gray */
            color: #8e8e93; 
        }
        .footer-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Special style for middle button (in footer) */
        #app-footer .footer-btn-middle {
            color: #f59e0b; /* Amber */
            transform: scale(1.1); /* Make it slightly larger */
        }
        #app-footer .footer-btn-middle i {
            /* MODIFIED: Made middle icon smaller (was 1.5rem) */
            font-size: 1.3rem; /* Larger icon */
            /* Color is set by specific classes below */
        }
        
        /* REMOVED: Old .footer-btn.is-active-filter and #footer-favorites-btn.is-active */
        /* These are now handled by the #action-bar overrides */


        #toggle-view-btn-main .icon-recipe { display: none; }
        #toggle-view-btn-main .icon-stories { 
            display: inline-block; 
            /* MODIFIED: Set default icon to amber */
            color: #f59e0b;
        }

        /* ADDED: Styles for the new text labels */
        #toggle-view-btn-main .label-recipe { display: none; }
        #toggle-view-btn-main .label-stories { 
            display: inline-block; 
            /* Inherits amber color from .footer-btn-middle */
        }


        #toggle-view-btn-main.is-story-view {
            /* MODIFIED: Change text color when active */
            color: #2dd4bf; 
        }
        #toggle-view-btn-main.is-story-view .icon-recipe { 
            display: inline-block; 
            /* MODIFIED: Set active icon to teal */
            color: #2dd4bf;
        }
        #toggle-view-btn-main.is-story-view .icon-stories { display: none; }
        
        /* ADDED: Styles to toggle the text labels */
        #toggle-view-btn-main.is-story-view .label-recipe { display: inline-block; }
        #toggle-view-btn-main.is-story-view .label-stories { display: none; }
        

        /* --- Footer --- */
        #app-footer {
            /* MODIFIED: Reduced top padding (was 0.25rem) */
            padding: 0 0;
            /* MODIFIED: Reduced bottom padding, now ONLY safe area */
            padding-bottom: env(safe-area-inset-bottom);
            
            /* --- UPDATED: Transparent Footer --- */
            background-color: transparent; 
            border-top: none; 
            
            /* REMOVED: Blur and shadow for full transparency */
            backdrop-filter: none; 
            -webkit-backdrop-filter: none; 
            box-shadow: none; 
            /* --- End Footer Update --- */
            
            display: flex;
            justify-content: space-evenly; /* MODIFIED: Evenly space all buttons */
            align-items: center;
            
            /* MODIFIED: Changed from in-flow to fixed positioning */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%; 
            
            z-index: 10;
            /* UPDATED: Removed background image */
            background-image: none;
        }
        
        /* --- Splash Screen --- */
        #splash-screen {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background-color: #000;
            background-image: url('https://github.com/aarmax8/Nomads/blob/ac96a3e89384bc4f8a4feefe4af617c47d901a0e/splash.jpg?raw=true');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 15vh;
            cursor: pointer;
            transition: opacity 0.7s ease-out;
        }
        #splash-screen.is-hidden {
            opacity: 0;
            pointer-events: none;
        }
        .splash-text {
            font-family: 'Cinzel', serif;
            font-size: 1.25rem;
            color: #e5e7eb;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.7), 0 0 5px rgba(0, 0, 0, 1);
            background-color: rgba(0,0,0,0.5);
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: 1px solid rgba(255,255,255,0.3);
            animation: pulse-text 2.5s infinite;
        }
        @keyframes pulse-text {
            0%, 100% {
                transform: scale(1);
                opacity: 0.9;
            }
            50% {
                transform: scale(1.03);
                opacity: 1;
            }
        }

    </style>
</head>
<body class="antialiased text-gray-300">

    <!-- Splash screen to prompt user to tap -->
    <div id="splash-screen">
        <div class="splash-text">Tap to Enter</div>
    </div>

    <div id="app" class="app-container">
        <header class="text-center">
            <div id="header-logo-container" class="w-full flex items-center justify-center">
                <img src="https://github.com/aarmax8/Nomads/blob/dc5ee5946a1f36d3a1883cbec868080471acdfbf/ai%20nomads%20title1.png?raw=true" id="header-logo-image" alt="Nomad's Logo">
            </div>
        </header>
        
        <main>
            <!-- NEW: Action bar for filters, faves, etc. -->
            <div id="action-bar" class="w-full flex-shrink-0 flex justify-evenly items-center py-2 px-4">
                <button id="action-random-btn" class="footer-btn" title="Pick a Random Drink">
                    <i class="fas fa-dice"></i>
                    <span class="text-xs">Random</span>
                </button>
                
                <button id="action-favorites-btn" class="footer-btn" title="Favorites">
                    <i class="fas fa-heart"></i>
                    <span class="text-xs">Faves</span>
                </button>
                
                <button id="action-stock-btn" class="footer-btn" title="Bar Stock">
                    <i class="fas fa-wine-bottle"></i>
                    <span class="text-xs">Stock</span>
                </button>
                
                <button id="action-filters-btn" class="footer-btn" title="Filters">
                    <i class="fas fa-martini-glass-citrus"></i>
                    <span class="text-xs">Filters</span>
                </button>
            </div>
            
            <!-- Grid for drink cards -->
            <div id="menu-grid"></div>
        </main>

        
        <!-- Main application footer (Now for navigation only) -->
        <div id="app-footer">
            <button id="scroll-prev-btn" class="footer-btn" title="Scroll Left">
                <i class="fas fa-angles-left"></i>
                <!-- REMOVED: <span class="text-xs">Prev</span> -->
            </button>
            
            <button id="toggle-view-btn-main" class="footer-btn footer-btn-middle" title="Toggle Recipe/Story">
                <i class="fas fa-book-open icon-stories"></i>
                <i class="fas fa-scroll icon-recipe"></i>
                <!-- Text will be hidden by icons, but good for accessibility -->
                <!-- UPDATED: Replaced sr-only span with dynamic labels -->
                <span class="text-xs label-stories">Story</span>
                <span class="text-xs label-recipe">Recipe</span>
            </button>

            <button id="scroll-next-btn" class="footer-btn" title="Scroll Right">
                <i class="fas fa-angles-right"></i>
                <!-- REMOVED: <span class="text-xs">Next</span> -->
            </button>
        </div>
    </div>

    
    <!-- Favorites Modal -->
    <div id="favorites-modal" class="modal fixed inset-0 bg-black/60 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="modal-panel rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="modal-header p-6 flex-shrink-0">
                <div class="flex justify-between items-center">
                    <h2 class="text-3xl text-amber-400 font-cinzel tracking-wider">Favorites</h2>
                    <button id="close-favorites-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                </div>
            </div>
            <div id="favorites-list-container" class="p-6 text-gray-300 overflow-y-auto">
                <!-- Favorite items will be rendered here by JS -->
            </div>
        </div>
    </div>

    <!-- Bar Stock Modal -->
    <div id="bar-stock-modal" class="modal fixed inset-0 bg-black/60 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="modal-panel rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="modal-header p-6 flex justify-between items-center flex-shrink-0">
                <h2 class="text-3xl text-amber-400 font-cinzel tracking-wider">Bar Stock</h2>
                <button id="close-stock-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="bar-stock-content" class="p-6 text-gray-300 flex-grow min-h-0 overflow-y-auto">
                <!-- Content is rendered here, overflow handled by CSS -->
            </div>
        </div>
    </div>
    
    <!-- Filter Modal -->
    <div id="filter-modal" class="modal fixed inset-0 bg-black/60 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="modal-panel rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="modal-header p-6 flex-shrink-0">
                <div class="flex justify-between items-center">
                    <h2 class="text-3xl text-amber-400 font-cinzel tracking-wider">Browse The Deck</h2>
                    <button id="close-filter-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                </div>
                <p class="text-gray-400 mt-2" id="filter-modal-subtitle">Select filters to find your drink.</p>
            </div>
            <div id="filter-modal-content" class="p-6 text-gray-300 overflow-y-auto"></div>
             <div class="p-4 border-t border-white/10 flex justify-end gap-4">
                <button id="reset-filters-btn" class="py-2 px-6 rounded-lg bg-transparent border border-gray-500 hover:bg-gray-700 text-white font-bold transition-colors">Reset</button>
                <button id="apply-filters-btn" class="py-2 px-6 rounded-lg bg-amber-600 hover:bg-amber-500 text-black font-bold transition-colors">Show Drinks</button>
            </div>
        </div>
    </div>
 
    <script>
        // --- Data ---
        let cocktails = []; // This will be populated by the setup function
        let favoriteDrinks = [];
        
        function setupCocktailData() {
            const initialCocktails = [
                // Replaced tarotMeaning with story
                { name: "Redheaded Trouble", flavorProfile: "A rebellious blend where dark, herbal notes meet sweet peach, finished with a bright citrus kick.", recipe: ["1 oz Jägermeister", "1 oz Peach Schnapps", "Fill a tall glass with Cranberry Juice"], story: "This is named in honor of the bar fight started by a guy who told our baldest member he liked his 'fiery red hair.' Turns out it was a wig he was sensitive about. The ensuing chaos was beautiful.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_8296.jpg", cardHook: "Some ghosts just want to party." },
                { name: "Caramel Apple Cruiser", flavorProfile: "Sweet butterscotch collides with the sharp tang of green apple, balanced by a whisper of spice.", recipe: ["1.5 oz Butterscotch Schnapps", "1.5 oz Apple Pucker", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "Our prospect, Pip, tried to make 'fancy autumn cocktails.' He tripped, dumped a bag of apples and a bottle of butterscotch into a vat of ginger ale. We were about to kick him out, but then we tasted it.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_8004.jpg", cardHook: "The taste of a glorious failure." },
                { name: "Alchemist's Brew", flavorProfile: "A complex, intellectual blend of herbal Jägermeister and floral St-Germain.", recipe: ["1.5 oz Jägermeister", "0.5 oz St-Germain", "Fill with Tonic Water"], story: "Doc, our mechanic, tried to distill moonshine using his bike's radiator and a bucket. This was the only batch that didn't make us go blind. We call that a success.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_7994.jpg", cardHook: "For the genius hiding in the garage." },
                { name: "Malibu Sunset", flavorProfile: "A bright and sweet tropical mix of coconut rum and orange juice.", recipe: ["1.5 oz Malibu Rum", "Fill with Orange Juice", "Splash of Grenadine"], story: "Duke came back from Florida bragging about the ' priceless sunstone' he'd stolen. It was a 25-cent gumball machine ring. He traded it for a bottle of Malibu and we've never let him forget he got the better end of that deal.", image: "https://github.com/aarmax8/Nomads/blob/69a35589c101275d31daad141695ea193fcde226/aamalibusunset.jpg?raw=true", cardHook: "Some treasures are found at the bottom of a glass." },
                { name: "Bourbon and Coke", flavorProfile: "A bold, uncompromising, and classic mix of bourbon, cola, and bitters.", recipe: ["2 oz Maker's Mark", "Fill with Cola", "2 dashes Angostura Bitters"], story: "'Iron' Joe claimed his bike could run on anything. To prove it, he emptied his flask of bourbon and a can of cola into the tank. The bike did not survive. This drink is its memorial.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_8220.jpg", cardHook: "Some legends are harder to stomach than others." },
                { name: "Old Fashioned", flavorProfile: "The timeless, bold flavor of bourbon, mellowed by sweet sugar and aromatic bitters.", recipe: ["2 oz Bulleit Bourbon", "0.5 oz Simple Syrup", "2 dashes Orange Bitters", "Cherry Garnish", "Top with Club Soda in a tall glass"], story: "This is the only drink the Club President knows how to make. Therefore, it is the 'greatest drink ever made.' You will agree with him. It is in your best interest to agree with him.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_8005.jpg", cardHook: "A drink worth lying about." },
                { name: "Sex on the Beach", flavorProfile: "A classic, juicy blend of vodka, sweet peach, and tart cranberry and orange.", recipe: ["2 oz Ketel One Vodka", "1 oz Peach Schnapps", "2 oz Orange Juice", "2 oz Cranberry Juice", "Splash of Lemon Juice"], story: "This one's a classic for a reason. We 'appropriated' the recipe from a spring break bar in Florida after our prospect 'accidentally' knocked over their sign. Tastes like sunshine and bad decisions.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_8294.jpg", cardHook: "The beach, but with more booze." },
                { name: "Junk Drawer", flavorProfile: "An unapologetically sweet concoction of raspberry, butterscotch, and classic root beer.", recipe: ["0.75 oz Raspberry Schnapps", "0.75 oz Butterscotch Schnapps", "0.75 oz Root Beer Schnapps", "Fill a tall glass with Club Soda"], story: "We told the new guy to make a drink with 'whatever's in the junk drawer.' He took us literally. Found these three dusty bottles behind some old spark plugs. We're as surprised as you are that it's drinkable.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/08030c3d25616df982816261406e2c08.png", cardHook: "Sometimes, genius comes from just mixing stuff." },
                { name: "Blue Lagoon's Ghost", flavorProfile: "Tropical orange and sweet cherry flavors ride on a clean rum backbone.", recipe: ["1.5 oz Bacardi Rum", "0.5 oz Blue Curacao", "0.5 oz Maraschino Liqueur", "Splash Lime Juice", "Top with Club Soda"], story: "A rival biker fell into the quarry. All they found was his floating, pristine blue helmet. We drink this to honor the helmet. Not the guy, the helmet was cool.", 
                  image: "https://github.com/aarmax8/Nomads/blob/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/b6ad8116d3e685043026ef0113bcc81d--david-mann-motorcycle-posters.jpg?raw=true", 
                  cardHook: "To the losers go the spoils." },
                { name: "Two Kings", flavorProfile: "A regal and straightforward pairing of two distinct, smooth whiskeys.", recipe: ["1 oz Knob Creek", "1 oz Crown Royal", "2 dashes Angostura Bitters", "Top with Club Soda in a tall glass"], story: "Two chapter presidents showed up wearing the same 'one-of-a-kind' leather jacket. They settled the dispute by drinking until one passed out and the other stole his jacket. This is what they drank.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/0ac5da1e71c995f58d75335fffabd844.jpg", cardHook: "The official drink of stubborn arguments." },
                { name: "Brandy Crusta", flavorProfile: "A sophisticated classic where strong brandy is brightened by citrus, with sweet hints of cherry and spice.", recipe: ["2 oz E&J Brandy", "0.25 oz Blue Curacao", "0.5 oz Lemon Juice", "0.5 oz Simple Syrup", "1 teaspoon Maraschino Liqueur", "1 dash Angostura Bitters"], story: "This one's fancy. 'Crusta' means 'crust,' like the sugar rim it's supposed to have. We skip that part. We call it the Crusta because 'Crusty,' our oldest member, is the only one who orders it. It's old-school, complicated, and surprisingly strong... just like him.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/4ef937229693734b1be907cc24f322eb.jpg", cardHook: "A classic with a complex twist." },
                { name: "Blacktop Sunset", flavorProfile: "Smooth Irish whiskey and sweet Southern Comfort are brightened by lime and spiced ginger.", recipe: ["1 oz Jameson Irish Whiskey", "1 oz Southern Comfort", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "This is the color of the bruise our prospect got after he mistook a puddle for a pothole and tried to 'bunny hop' it. The sunset that evening was almost as beautiful as his failure.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/1f512d08cccf12ad8dc389d42f5fcceb.jpg", cardHook: "To the potholes you can't see." },
                { name: "Elderflower Nomad", flavorProfile: "Delicate elderflower and botanical gin meet a hint of lavender and rosemary.", recipe: ["1.5 oz Tanqueray Gin", "0.75 oz St-Germain", "0.5 oz Lime Juice", "2 dashes Rosemary Lavender Bitters", "Top with Club Soda in a tall glass"], story: "We sent 'Tiny' to get gin. He came back with this flowery stuff and said it would 'expand our horizons.' We expanded his list of chores instead. Turns out, the joke's on us. This stuff is good. Don't tell him.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/64c7af61b8476938a0b6bc9e8462ef3f--motorcycle-posters-motorcycle-art.jpg", cardHook: "Even a nomad can be sophisticated." },
                { name: "Garibaldi", flavorProfile: "A bold, bittersweet clash of Italian Campari, bright orange, and a hint of sweetness. Deceptively simple.", recipe: ["1.5 oz Campari", "0.25 oz Simple Syrup", "Fill a tall glass with Orange Juice"], story: "Named after an old-world revolutionary. We drink it to honor 'Knuckles,' who tried to start a 'revolution' to get a new pool table. He failed, but his passion... and his bar tab... were revolutionary. This is his drink.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/4ef937229693734b1be907cc24f322eb.jpg", cardHook: "A classic with a complex twist." },
                { name: "Apparition", flavorProfile: "Clean vodka and floral St-Germain are lifted by the bright spice of ginger.", recipe: ["2 oz Ketel One Vodka", "0.75 oz St-Germain", "0.5 oz Lime Juice", "Fill a tall glass with Ginger Soda"], story: "Gus drinks three of these and claims he can see through walls. All he's ever seen is the inside of the men's room, which is punishment enough for the rest of us who have to hear about it.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/206S17.jpg", cardHook: "To the spirits that haunt the bar." },
                { name: "Rusty Nail", flavorProfile: "A timeless and potent blend of smoky Scotch whisky sweetened by the honeyed, herbal spice of Drambuie.", recipe: ["2 oz Johnnie Walker Red Label", "1 oz Drambuie", "Serve on the rocks", "Lemon Twist Garnish"], story: "This is what you drink when you've made a deal you know you'll regret. Like trading your bike for a 'guaranteed' winning lottery ticket. Ask Jimmy how that went. Actually, don't. He's still sensitive about it.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_7993.jpg", cardHook: "Every deal has its price." },
                { name: "Mechanic", flavorProfile: "A sharp, herbal Jäger base brightened by tart apple and a spicy, citrus kick from ginger and lime.", recipe: ["1.5 oz Jägermeister", "0.5 oz Apple Pucker", "Fill a tall glass with Ginger Soda", "Splash of Lime Juice"], story: "Sal, our mechanic, calls this 'motivation.' He says the color reminds him of brand new antifreeze, which is the only thing that gets him excited. We're worried about Sal.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/39cd9a9b372af2c86cb7189c2f929463.png", cardHook: "Tastes better than degreaser. Probably." },
                { name: "Redline Riot", flavorProfile: "Sweet cherry and sharp sour mix create a vibrant, rebellious flavor.", recipe: ["1.5 oz Ketel One Vodka", "1 oz Cherry Schnapps", "Fill a tall glass with Sour Mix", "Splash of Lime Juice"], story: "A tribute to the time we tried to see if a cherry-red '78 Sportster could actually hit the redline in first gear without exploding. It could not. This drink is less expensive to clean up.", image: "https://github.com/aarmax8/Nomads/blob/main/thumbnail_IMG_8306.jpg?raw=true", cardHook: "Here's to things we can't talk about." },
                { name: "Spiced Rum Buck", flavorProfile: "Warm spiced rum gets a sharp, clean kick from lime and ginger.", recipe: ["2 oz Captain Morgan Spiced Rum", "0.5 oz Lime Juice", "Fill a tall glass with Ginger Soda"], story: "This drink has all the stages of trying to kickstart a stubborn old Panhead: spicy anger, a sharp kick of frustration, and sweet relief when it roars to life. All that, without the risk of a torn ACL.", image: "https://github.com/aarmax8/Nomads/blob/0dcbab77d90f59f2298642338dfee691353ce70a/frontend/USq6nI.jpg?raw=true", cardHook: "A more reliable way to get started." },
                { name: "Shirley Temple", flavorProfile: "The classic sweet and spicy ginger soda, kissed with a touch of cherry.", recipe: ["Fill a tall glass with Ginger Soda", "Splash of Grenadine", "Cherry Garnish"], story: "Our biggest, meanest member, Crusher, orders this. Not for his kid. For himself. He says it 'calms his inner rage.' You WILL NOT make fun of him. You WILL tell him it's a very manly drink. Your safety depends on it.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_7989.jpg", cardHook: "The toughest drink in the bar." }, 
                { name: "Dark 'n' Stormy", flavorProfile: "Deep, dark spiced rum with a bite of lime and a spicy ginger finish.", recipe: ["2 oz Kraken Black Spiced Rum", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "We dared our prospect to ride through a tornado warning. He came back an hour later, clothes torn, hair standing on end, and holding a bottle of Kraken he 'found.' This drink is our best guess as to what happened.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/19071808632f94b0b81d595f74f700f0.jpg", cardHook: "To making bad weather worse." },
                { name: "Kraken's Grip", flavorProfile: "Dark rum and sweet almond create a rich, cola-based concoction.", recipe: ["1.5 oz Kraken Black Spiced Rum", "1 oz Amaretto", "Fill a tall glass with Cola"], story: "After two of these, you'll have a death grip on the bar and the questionable belief that you can arm-wrestle a sea monster. You can't. Ask Fingers, he's got the scars to prove it.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/555331b7961b7c0880f3b2842529bcd8.jpg", cardHook: "It'll get a hold on you." },
                { name: "Statesman", flavorProfile: "A sophisticated and strong blend of bold bourbon, sweet apricot, and sharp lemon.", recipe: ["2 oz Bulleit Bourbon", "0.75 oz Apricot Brandy", "0.5 oz Lemon Juice"], story: "This one's for the old-timers. The guys who sit in the back, don't say much, but have seen it all. It's strong, it's classic, and it doesn't need to shout to be heard. Like a true statesman, it commands respect just by being there.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/d715cf5bec09d118e51d505a225e449d.jpg", cardHook: "Respect your elders." },
                { name: "Island Hopper", flavorProfile: "A sweet, tropical escape with creamy coconut and bright pineapple.", recipe: ["1 oz Malibu Rum", "1 oz Bacardi Rum", "Fill with Pineapple Juice", "Splash of Lime Juice"], story: "This is for the guy who wears a Hawaiian shirt under his leather cut. He talks about riding to the keys, but we all know he's just going to the tourist trap on the pier. We humor him.", image: "https://github.com/aarmax8/Nomads/blob/69a35589c101275d31daad141695ea193fcde226/aajimbeamblackcherrybomb.jpg?raw=true", // NEW WORKING IMAGE
                  cardHook: "A vacation in a glass." },
                { name: "Gin Rickey", flavorProfile: "A clean and bracing mix of botanical gin and sharp lime, mellowed by club soda.", recipe: ["2 oz Tanqueray Gin", "1 oz Lime Juice", "Fill a tall glass with Club Soda"], story: "Tastes like taking a mountain switchback too fast. It's sharp, it makes your stomach turn, and you feel a moment of pure, blinding panic. Then it's over and you feel like a hero. A stupid, stupid hero.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/5fdd2d485722e.jpg", cardHook: "For roads that go back and forth." },
                { name: "Long Haul", flavorProfile: "Crisp gin and tonic gets a complex, herbal twist from rosemary and lavender.", recipe: ["2 oz Tanqueray Gin", "0.5 oz Lime Juice", "Top with Tonic Water in a tall glass", "2 dashes Rosemary Lavender Bitters"], story: "This drink is like a 10-hour ride through Nebraska. It starts out fine, then it gets weirdly complex, then it's just... a lot. By the end, you're not sure if you like it, but you respect its commitment.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/608bdca2cf73d693c4e80d1723cd59b8.jpg", cardHook: "For when you're in it for the long haul." },
                { name: "Whiskey Highball", flavorProfile: "A classic, clean taste of smooth whiskey balanced with a touch of sweetness and a bubbly finish.", recipe: ["2 oz Travellers Whiskey", "0.75 oz Simple Syrup", "Top with Club Soda"], story: "We call it the Country and Western because after three of them, everyone thinks they can sing both parts of a Johnny Cash and June Carter duet. They can't. And it's always sad.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/62a04e5b236c0659fec18c5f76651953.jpg", cardHook: "Simple, honest, and a little bit sad." },
                { name: "Rattlesnake", flavorProfile: "Earthy tequila gets a surprising bite from sweet cherry and sharp lime.", recipe: ["2 oz El Mayor Tequila", "0.5 oz Cherry Schnapps", "0.5 oz Lime Juice", "Top with Club Soda in a tall glass"], story: "Looks harmless, right? Sweet, even. That's what the rattlesnake we found in the ice machine thought. This drink has a bite that sneaks up on you, just like he did. We check the ice more carefully now.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/6418051b93b83a2239400213863d22a1.jpg", cardHook: "Sweet, with a venomous bite." },
                { name: "Paradise", flavorProfile: "A tropical and tangy blend where botanical gin and sweet apricot meet bright citrus.", recipe: ["1.5 oz Tanqueray Gin", "0.75 oz Apricot Brandy", "Fill a tall glass with Orange Juice", "0.5 oz Lemon Juice", "Cherry Garnish"], story: "We call this Paradise because it's what 'Wrench' drinks when he's dreaming of retiring to a beach somewhere. One sip and he's gone... still in the garage, but mentally he's on a beach. We let him have it.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/1bf52dfc1aad553db68333418c40d848.jpg", cardHook: "Your own personal oasis." },
                { name: "Tequila Sunrise", flavorProfile: "Sweet and vibrant, this is a classic tequila sunrise with an extra bitter orange kick.", recipe: ["2 oz El Mayor Tequila", "Fill a tall glass with Orange Juice", "2 dashes Orange Bitters", "0.5 oz Grenadine"], story: "The only time you should see a desert sunrise is because you've been riding all night. This drink lets you skip the riding part and get straight to the 'seeing pretty colors while your brain feels like sand' part. It's more efficient.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/672ca23068e35c6481458f0911d99ceb.jpg", cardHook: "All the beauty, none of the early morning." },
                { name: "Gilded Serpent", flavorProfile: "A luxurious mix of floral elderflower, bright pineapple, and smooth tequila.", recipe: ["1.5 oz El Mayor Tequila", "0.75 oz St-Germain", "1 oz Pineapple Juice", "0.5 oz Lime Juice"], story: "Looks fancy. Tastes fancy. But it's still tequila. It's like putting a tuxedo on a snake. It might look respectable for a minute, but you know it's gonna bite you eventually.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/67bab4c8460e76ee5bd5fe757150ef26--bike-art-motorcycle-art.jpg", cardHook: "Fancy on the outside, dangerous on the inside." },
                { name: "Drambuie & Ginger", flavorProfile: "The sweet, herbal notes of Drambuie are lifted by the crisp, spicy kick of ginger soda, creating a refreshing and enduring companion for any journey.", recipe: ["2 oz Drambuie", "Fill a tall glass with Ginger Soda", "Lime Wedge Garnish"], story: "You know that last mile before you get home? When your back aches, your ears are ringing, and you'd sell a kidney for a hot shower? This is that feeling in a glass. Pure, unadulterated relief.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/69070319cd6333061bdbb34ed7dee0c1.jpg", cardHook: "For the last mile of a heavy journey." },
                { name: "Switchblade", flavorProfile: "Intensely sour lemon is balanced by a clean vodka finish.", recipe: ["2 oz Stolichnaya Citros Vodka", "1 oz Lemon Juice", "0.75 oz Simple Syrup"], story: "It's small, sharp, and will end your night if you're not careful. Named in honor of our shortest member, 'Stubbs,' who is all of those things. He thinks it's a compliment.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/6a73cec9f46d798d4ba58ec29f5623f2.jpg", cardHook: "Respect the lemon." },
                { name: "Buckeye Cider", flavorProfile: "Sweet and spicy Southern Comfort with a classic bitter backbone, lifted by a crisp soda finish.", recipe: ["2oz Southern Comfort", "2 dashes Angostura Bitters", "Top with Club Soda in a tall glass"], story: "This recipe comes from a long ride through the Hocking Hills. We met a rival club out of Columbus, and instead of the usual staredown, we ended up sharing a fire and a few drinks. Their president, a guy they called 'Buckeye,' made this. It's smooth, strong, and a little unexpected, just like finding friends in rival territory. We stole the recipe, but we left a bottle of our own stuff as a trade. We're not savages.", image: "https://github.com/aarmax8/Nomads/blob/1e1c514fd7e07a421ae95d827c230b7fea504fa7/aabuckeyecider.jpg?raw=true", cardHook: "To the rivals who ain't so bad." },
                { name: "Sidecar", flavorProfile: "A powerful and classic combination of strong brandy and bright, citrusy orange.", recipe: ["2 oz E&J Brandy", "1 oz Triple Sec", "0.75 oz Lemon Juice"], story: "Our mechanic, 'Wrench,' says this drink has the three essential food groups: strong, sour, and sugar. He also thinks rust is a 'nice patina.' His judgment is questionable, but his drink is solid.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/724b49e9a385815706ed2dbc9d7ca6f3.jpg", cardHook: "Strong enough to strip rust." },
                { name: "Nicky Finn", flavorProfile: "A complex, citrus-forward drink with a sharp anise bite.", recipe: ["1 oz E&J Brandy", "1 oz Cointreau", "1 oz Lemon Juice", "1 dash Pernod"], story: "Named after a guy who swore his drink was 'spiked.' Turns out, he'd just never had Pernod before. He spent all night accusing the bartender of trying to 'slip him a mickey.' We call it a Nicky Finn to remind him of his 'wild' night.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/7645bbca2888163b21bf0d193ad3fb21.jpg", cardHook: "It's got a secret." },
                { name: "Alabama Slammer", flavorProfile: "A famously smooth and fruity classic, blending amaretto, sloe gin, and Southern Comfort with bright orange.", recipe: ["0.75 oz Southern Comfort", "0.75 oz Sloe Gin", "0.75 oz Amaretto", "Fill a tall glass with Orange Juice"], story: "This one's a classic for a reason. It's sweet, fruity, and hits you like a freight train. We call it the 'Slammer' because our Sergeant-at-Arms, 'Slam,' drank five of them and then tried to 'slam' dunk a pool ball into a pint glass. He missed. Badly.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/7f8779686c19c3de763ad13c03fee127.jpg", cardHook: "Sweet, nutty, and dangerous." },
                { name: "White Liner", flavorProfile: "A sophisticated ride of bright floral notes, sharp citrus, and a clean, bubbly finish.", recipe: ["1.5 oz Tanqueray Gin", "0.75 oz St-Germain", "0.75 oz Lemon Juice", "2 dashes Orange Bitters", "Top with Club Soda in a tall glass"], story: "This is for the guy who follows the rules. The one who actually signals, stays under the speed limit, and calls his mother. We don't understand him, but we make him this drink out of pity.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/95ae7009ba144fc3dd9fc68d14b5f929.jpg", cardHook: "For when you follow the rules too closely." },
                { name: "Apricot Ambush", flavorProfile: "Sweet apricot brandy gets a tart lemon kick, smoothed out with a bubbly finish.", recipe: ["1.5 oz E&J Brandy", "0.75 oz Apricot Brandy", "0.5 oz Lemon Juice", "Top with Club Soda"], story: "We were ambushed by a rival club. They were terrible at it. They dropped a case of this stuff while retreating. We drank it to celebrate their incompetence. The tastiest victory we never had to fight for.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/83c048414249b2ffaf2cef7f5cdc5590.jpg", cardHook: "The tastiest ambush you'll ever face." },
                { name: "Crimson Guard", flavorProfile: "A sharp and fruity blend of sloe gin and lime with a clean soda finish.", recipe: ["1.5 oz Sloe Gin", "0.5 oz Tanqueray Gin", "Fill a tall glass with Club Soda", "Splash of Lime Juice"], story: "We call it the Crimson Guard because after a few of these, you'll feel invincible enough to guard a gate to hell. You're not. And the resulting hangover will feel like you've been there.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/CuHwaf.jpg", cardHook: "Safer than Dead Man's Curve." },
                { name: "Road Rash", flavorProfile: "Sweet and sour collide in this blend of fruity sloe gin and smooth Southern Comfort.", recipe: ["1 oz Sloe Gin", "1 oz Southern Comfort", "0.5 oz Lemon Juice", "Fill a tall glass with Club Soda"], story: "It's red, it stings, and it's a story you'll tell for years. The drink, not the injury. The injury just gets you a lame scar and a lecture from Doc.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/David-Mann-Art-2.jpg", cardHook: "Much better than the real thing." },
                { name: "Ruby Rider", flavorProfile: "Deep, rich sloe gin is perfectly complemented by the spicy kick of ginger soda.", recipe: ["2 oz Sloe Gin", "Fill a tall glass with Ginger Soda"], story: "We keep making this, hoping the legendary Ruby Rider will show up. So far, all we've summoned is her angry ex-boyfriend, three cops, and a very confused pizza delivery guy. Our patience is wearing thin.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/PcZieI.jpg", cardHook: "To the ghosts we haven't met yet." },
                /* --- FIX: Corrected image path typo --- */
                { name: "Cowboy's Hard Root Beer", flavorProfile: "A creamy and bold mix of classic root beer and smooth Irish whiskey.", recipe: ["1.5 oz Jameson Irish Whiskey", "1 oz Root Beer Schnapps", "0.5 oz Simple Syrup", "Top with Ginger Soda in a tall glass"], story: "A cowboy bet us we couldn't make a drink that tasted like 'a rodeo in a bottle.' We made this. It's got the sweet taste of victory and the kick of a pissed-off bull. He paid up.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/il_fullxfull.1315813799_ayvc.webp", cardHook: "This drink has spurs." },
                { name: "Knob Creek Kentucky Smash", flavorProfile: "A powerful, sour punch of strong bourbon and fresh lemon, with a hint of orange.", recipe: ["2 oz Knob Creek", "1 oz Lemon Juice", "0.75 oz Simple Syrup", "2 dashes Orange Bitters", "Top with Club Soda in a tall glass"], story: "This is what happens when you let our Kentucky chapter president make drinks. It's less of a recipe and more of a threat. It hits you hard and leaves you wondering why you let a man named 'Brawler' be your bartender.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/USq6nI.jpg", cardHook: "As subtle as a thunderstorm." },
                { name: "Godfather Highball", flavorProfile: "Rich Canadian whiskey and nutty amaretto create a smooth, sophisticated flavor.", recipe: ["1.A 5 oz Crown Royal", "0.5 oz Amaretto", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "For the guy who traded his handlebars for a keyboard. It's the taste of a steady paycheck, a 401k, and the soul-crushing despair of rush hour traffic. Welcome to the cage, pal.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/YDZaH0.jpg", cardHook: "The taste of selling out." },
                { name: "Bulleit Frontier Punch", flavorProfile: "A bold and fruity mix of bourbon, orange, and lemon, with a sweet grenadine finish.", recipe: ["2 oz Bulleit Bourbon", "2 oz Orange Juice", "0.5 oz Lemon Juice", "Splash of Grenadine", "Top with Club Soda in a tall glass"], story: "This is what happens when you try to make 'Jungle Juice' with actual bourbon. It's dangerously drinkable. A frontier of bad decisions awaits.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/a401737bafe60d0edc1c1ea7ddb18508.jpg", cardHook: "History, but with more sugar." },
                /* --- FIX: Corrected image path typo --- */
                { name: "Seagram's 7 Sour", flavorProfile: "A classic, balanced sour with smooth whiskey, tart lemon, and a hint of bitters.", recipe: ["2 oz Seagram's 7", "1 oz Lemon Juice", "0.5 oz Simple Syrup", "2 dashes Peychaud's Bitters", "Top with Club Soda in a tall glass"], story: "Named in honor of our Treasurer's heart. He's as cold as stone and perpetually sour about the bar tab. We drink this to annoy him. It works.", image: "https://github.com/aarmax8/Nomads/blob/0dcbab77d90f59f2298642338dfee691353ce70a/frontend/b6ad8116d3e685043026ef0113bcc81d--david-mann-motorcycle-posters.jpg?raw=true", cardHook: "Better than the memories." },
                { name: "Jim Beam Black Cherry Bomb", flavorProfile: "Bold bourbon meets its match with sweet black cherry and classic cola.", recipe: ["2 oz Jim Beam Bourbon", "0.5 oz Cherry Schnapps", "Fill a tall glass with Cola"], story: "This isn't a drink, it's an escalation. It starts with bourbon, adds some cherry, and ends with you-thinking it's a good idea to see if your bike can do a burnout on the bar. It can't.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/5a6b0379f72b6c8fb2751409d48ac8fa.jpg", cardHook: "Tastes like minor property damage." },
                { name: "Southern Crossroads", flavorProfile: "Sweet Southern Comfort is paired with the fruity, tart flavor of sloe gin and orange.", recipe: ["1.5 oz Southern Comfort", "0.5 oz Sloe Gin", "Fill a tall glass with Orange Juice"], story: "This is the drink for when you have two bad options. It's sweet enough to make you forget you're making a choice, and strong enough to make you not care about the consequences. Good luck.", image: "https://github.com/aarmax8/Nomads/blob/69a35589c101275d31daad141695ea193fcde226/aasoutherncrossroads.jpg?raw=true", cardHook: "For making the wrong choices." },
                { name: "Mamie Taylor", flavorProfile: "A smoky and sharp blend of scotch, lime, and spicy ginger.", recipe: ["2 oz Johnnie Walker Red Label", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "Named for our founder, 'Red,' not because he liked scotch, but because this is the color his face got when a prospect called his prized chopper 'cute.' It's a drink of respect and fear. Mostly fear.", image: "https://github.com/aarmax8/Nomads/blob/bc62d5aebb9a232818104ce036e8325a73533520/frontend/206S17.jpg?raw=true", cardHook: "To the legends in the club." },
                { name: "Brandy Thunder", flavorProfile: "A powerful clap of strong brandy and bright citrus, softened by a bubbly finish.", recipe: ["2 oz E&J Brandy", "1 oz Triple Sec", "0.75 oz Lemon Juice", "0.25 oz Simple Syrup", "Top with Club Soda"], story: "Named for the sound 'Wrench' made when he dropped a transmission on the shop floor after drinking two of these. It's bright, it's loud, and it'll shake the garage. A perfectly balanced storm in a glass.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/bd0bc33e2c84ea33e265900701fa8331.jpg", cardHook: "Bring the thunder." },
                { name: "Irish Russian", flavorProfile: "Rich coffee and smooth cream, with a clean vodka backbone and a hint of bubbly lift.", recipe: ["2 oz Grey Goose Vodka", "1 oz Kahlúa", "1 oz Baileys Irish Cream", "0.25 oz Simple Syrup", "Fill a tall glass with Club Soda"], story: "This is what happens when our most stubborn members, an Irishman and a Russian, argue over whose drink is better. It's a creamy, boozy mess that solves nothing, but at least it shuts them up for a while.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/bd2c7d94ce4111f6235a52c8cf70e89e.jpg", cardHook: "The taste of a weird truce." },
                { name: "Margarita", flavorProfile: "The perfect balance of salty, sour, and sweet, with a tequila kick.", recipe: ["2 oz Jose Cuervo Silver Tequila", "1 oz Cointreau", "1 oz Lime Juice", "2 dashes Orange Bitters", "Top with Club Soda in a tall glass"], story: "We don't know who Rita is. We don't care. All we know is that this combination of tequila and lime is the reason for half the bad tattoos in this club. Drink with caution. And a designated tattoo artist.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/3a506b28b91e0e5d031cedbeca489a14.jpg", cardHook: "¡Vámonos!" },
                { name: "Moscow Mule", flavorProfile: "A crisp and spicy classic, with clean vodka, sharp lime, and fiery ginger.", recipe: ["2 oz Ketel One Vodka", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Ginger Soda"], story: "It's crisp, it's spicy, and it kicks you right in the teeth when you're not expecting it. Just like our club's lawyer. We prefer the drink.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/c143359dbf62f9ce9349aa42e3bfe8aa.jpg", cardHook: "It's got a kick." },
                { name: "Killer Cocktail", flavorProfile: "A complex and deadly mix where sweet amaretto and tropical passion fruit battle bitter Campari and sharp gin.", recipe: ["1 oz Amaretto", "1 oz Tanqueray Gin", "0.5 oz Campari", "0.5 oz Passion Fruit Syrup", "0.5 oz Lemon Juice"], story: "This one's called the Killer Cocktail because the first guy who tried it, 'Pops,' claimed it was so good it 'killed' his craving for anything else. He then proceeded to drink four of them and 'killed' a jukebox with a pool cue. The name stuck.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/5638f66d00401c933df787eb50253fc8.jpg", cardHook: "As complex as your last bad decision." },
                /* --- FIX: Removed 's' from 'httpss' --- */
                { name: "Screwdriver", flavorProfile: "A straightforward and bright classic, with clean vodka and sweet orange juice.", recipe: ["2 oz Stolichnaya Citros Vodka", "2 dashes Orange Bitters", "Fill a tall glass with Orange Juice"], story: "Our mechanic insists this is a legitimate cocktail. We're pretty sure it's just what he drinks when he runs out of clean glasses and has to mix it in a hubcap. We serve it in a glass. You're welcome.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/cfff51feaf6082d29a37912a44bfedc3.jpg", cardHook: "The second-best use for a screwdriver." },
                { name: "Rusty Blade", flavorProfile: "Bold bourbon gets a sophisticated edge from honeyed, herbal Drambuie, sharpened with a dash of bitters.", recipe: ["2 oz Bulleit Bourbon", "0.75 oz Drambuie", "2 dashes Angostura Bitters", "Serve on the rocks"], story: "A Rusty Nail is for old men in smoking jackets. A Rusty Blade is what you drink after you've just won a knife fight over a parking spot. It's sharper, meaner, and has a better story.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/d715cf5bec09d118e51d505a225e449d.jpg", cardHook: "The sharpest blade is a sharp mind." },
                
                { name: "Whiskey Sour", flavorProfile: "A perfect balance of bold whiskey, tart lemon, and sweet sugar.", recipe: ["2 oz Jim Beam Bourbon", "1 oz Lemon Juice", "0.5 oz Simple Syrup", "2 dashes Angostura Bitters", "Top with Club Soda in a tall glass"], story: "Named for 'Sour' Sam, our Sergeant-at-Arms. He has two moods: sour and asleep. This drink is a tribute to his sunny disposition. He hates it. We love it.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_7995.jpg", cardHook: "To 'Sour' Sam. He'd hate this." },
                { name: "Cuba Libre", flavorProfile: "A classic combination of smooth rum, sweet cola, and a sharp lime kick.", recipe: ["2 oz Bacardi Rum", "0.5 oz Lime Juice", "2 dashes Angostura Bitters", "Fill a tall glass with Cola"], story: "Means 'Free Cuba.' We drank it to celebrate freeing our club mascot, a grumpy bulldog named Che, from the local dog catcher. It was a whole thing. The dog was not grateful.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/d9a9ffbd510d7ea900f31195d5e857f6.jpg", cardHook: "Tastes like a good road trip." },
                { name: "Godfather", flavorProfile: "A simple, powerful duo of bold bourbon and sweet, nutty amaretto.", recipe: ["2 oz Bulleit Bourbon", "0.75 oz Amaretto", "Serve on the rocks"], story: "This is what you drink right before you make a very serious, legally questionable promise to a group of men you probably shouldn't trust. It's strong, sweet, and tastes like brotherhood and future bad decisions.", image: "https://github.com/aarmax8/Nomads/blob/3cdd71f09194cbf21b99337a4fc180c7d71380e5/frontend/yWMhLC.jpg?raw=true", cardHook: "To promises you'll try to keep." },
                { name: "White Russian", flavorProfile: "A rich and creamy classic with vodka and coffee liqueur.", recipe: ["2 oz Grey Goose Vodka", "1 oz Kahlúa", "1 oz Bailea-s Irish Cream"], story: "This drink is for when you just don't want to deal with anything. It's a creamy, alcoholic blanket for your problems. It doesn't solve them, but it makes them quieter.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/e5a7f5bfc3b2c200266b6df05a132e17.jpg", cardHook: "It really ties the room together." },
                /* --- FIX: Removed 's' from 'httpss' --- */
                { name: "Long Island Iced Tea", flavorProfile: "A potent and deceptive blend of five different spirits with a sour, cola finish.", recipe: ["0.5 oz Grey Goose Vodka", "0.5 oz Tanqueray Gin", "0.5 oz Bacardi Rum", "0.5 oz Jose Cuervo Silver Tequila", "0.5 oz Triple Sec", "1 oz Lemon Juice", "Fill a tall glass with Cola"], story: "This isn't a drink, it's a dare. It's a mix of everything that will get you into trouble, served in a glass. The only 'tea' involved is the 'T-rouble' you'll be in tomorrow.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/ed9d1453cc5561fb3049f8f6d3a7e145.jpg", cardHook: "A beautiful, delicious lie." },
                { name: "Sazerac", flavorProfile: "A potent, licorice-forward cocktail with the sweetness of Southern Comfort and a classic bitter finish.", recipe: ["2 oz Southern Comfort", "1 teaspoon Pernod", "0.5 oz Simple Syrup", "2 dashes Peychaud's Bitters"], story: "Our president spent a week in New Orleans and came back with a 'spiritual awakening' and this recipe. The awakening wore off, but the Sazerac stuck around. It's complex, a little dangerous, and demands respect.", image: "https://github.com/aarmax8/Nomads/blob/3cdd71f09194cbf21b99337a4fc180c7d71380e5/thumbnail_IMG_8298.jpg?raw=true", cardHook: "Respect the Big Easy." },
                /* --- FIX: Removed 's' from 'httpss' --- */
                { name: "Phantom Shift", flavorProfile: "Sharp anise and botanical gin create a crisp, clean flavor with a bitter, tonic finish.", recipe: ["1oz Pernod", "1 oz Tanqueray Gin", "0.5 oz Lime Juice", "Top with Tonic Water in a tall glass"], story: "Tastes like licorice and regret. Named for the 'phantom' expenses that keep appearing on the club's credit card. We know who's doing it. And their time is short.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/f2a6114d2d00087a3f9192fc5cc74614.jpg", cardHook: "For the gears that aren't there." },
                /* --- FIX: Removed 'S' from 'httpsS' --- */
                { name: "Morning Haze", flavorProfile: "A bright and sharp mix of botanical gin and tropical pineapple juice.", recipe: ["2 oz Tanqueray Gin", "Fill with Pineapple Juice", "Splash of Lime Juice"], story: "For when you wake up and the world is a blurry, confusing mess. This drink is also a blurry, confusing mess, but it's a delicious one. It helps you ease into your hangover.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/il_fullxfull.1268185178_a000.webp", cardHook: "A helpful lie for a hazy morning." },
                /* --- FIX: Removed 's' from 'httpss' --- */
                { name: "Nightcap", flavorProfile: "A rich, smooth, and simple pairing of creamy Baileys and nutty amaretto.", recipe: ["2 oz Baileys Irish Cream", "1 oz Amaretto", "Serve on the rocks"], story: "Don't let the name fool you. This is not a 'one and done' drink. It's a 'one and then you decide it's a good idea to call your ex' drink. You have been warned.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ECaf84a18fc47b/frontend/R.jpg", cardHook: "The perfect end to the day." },
                /* --- FIX: Removed 's' from 'httpss' --- */
                { name: "Spiced Rum & Coke", flavorProfile: "A sweet and spicy mix of spiced rum, cola, and a hint of orange.", recipe: ["2 oz Captain Morgan Spiced Rum", "Fill with Cola", "2 dashes Orange Bitters"], story: "The sound of a missed gear is horrifying. The taste of this drink is not. It's what you drink to forget the crime you just committed against your motorcycle. The bike remembers, though. It always remembers.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/il_fullxfull.850190414_gb43.webp", cardHook: "An apology to our transmissions." },
                { name: "Catalyst", flavorProfile: "An energetic and tart blend of vodka, sour mix, and lime.", recipe: ["1.5 oz Grey Goose Vodka", "Fill with Sour Mix", "Splash of Lime Juice"], story: "This drink doesn't cause problems. It's just... present when they happen. It's the catalyst for bar fights, terrible ideas, and waking up with a new tattoo. It's an agent of chaos.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_7999.jpg", cardHook: "The start of a great story." },
                /* --- FIX: Removed 's' from 'httpss' --- */
                { name: "Finn's Orchard Kick", flavorProfile: "Smooth Irish whiskey gets a sharp kick from tart apple and a spicy ginger finish.", recipe: ["2 oz Jameson Irish Whiskey", "1 oz Apple Pucker", "2 dashes Angostura Bitters", "Top with Ginger Soda in a tall glass"], story: "Finn, our resident genius, tried to make 'artisanal applejack' in the clubhouse radiator. The radiator exploded. This drink, made with store-bought ingredients, is a much safer tribute to his ambition.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/il_fullxfull.1315813799_ayvc.webp", cardHook: "A tribute to spectacular failures." },
                { name: "Crossroads Deal", flavorProfile: "A smoky and sweet deal between scotch, amaretto, and cola.", recipe: ["2 oz Johnnie Walker Red Label", "1 oz Amaretto", "Fill with Cola"], story: "At the crossroads, you can sell your soul for talent. Or, if you're like Mike, you can accidentally trade it for a half-empty bottle of amaretto and some stale chips. This drink commemorates his poor negotiating skills.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_7992.jpg", cardHook: "To making good deals." },
                { name: "Purple Hooter", flavorProfile: "Bright, sweet raspberry balanced by a floral bitterness and a sharp citrus finish.", recipe: ["1oz Ketel One Vodka", "1 oz Raspberry Schnapps", "2 dashes Peychaud's Bitters", "Splash Lime Juice", "Fill a tall glass with Club Soda"], story: "We're not legally allowed to say why it's called this. Just know that it involves our least-favorite rival club, a gallon of purple paint, and a very surprised mascot. This drink is our trophy.", image: "https://github.com/aarmax8/Nomads/blob/b53f3ec4d921fabea10c455c27ae09cee7e30d79/aaalchemistsbrew.jpg?raw=true", cardHook: "To our drunk owl." },
                { name: "High Noon", flavorProfile: "A sharp and ready blend of tequila, lime, and bitter tonic.", recipe: ["2 oz El Mayor Tequila", "Fill with Tonic Water", "Splash of Lime Juice"], story: "This is what you drink when you're about to do something stupid, but you want to do it with confidence. It's the official beverage of 'Hold my beer and watch this.'", image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/271d97ccf4324f5c3e3d7ec301c4fcc8.jpg", cardHook: "The drink of champions. And losers." },
                { name: "Mudslide", flavorProfile: "A rich, creamy, and decadent dessert drink with vodka, coffee, and Irish cream.", recipe: ["1oz Ketel One Vodka", "1 oz Kahlúa", "1 oz Baileys Irish Cream"], story: "We tried to ride through a mudslide. It was a bad idea. This drink is a much better, and cleaner, version of that experience. It's still a bad idea to have five of them, though.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_7997.jpg", cardHook: "To the shortcuts that weren't." },
                { name: "Desert Wind", flavorProfile: "A dry and spiced mix of whiskey, ginger soda, and-orange bitters.", recipe: ["2 oz Four Roses Whiskey", "Fill with Ginger Soda", "2 dashes Orange Bitters"], story: "Named for our club secretary, who can talk for three hours without taking a breath. The drink is dry, spicy, and will leave you speechless. We wish he would try one.", image: "https://github.com/aarmax8/Nomads/blob/5915ae46af9d547d456ba87aa624286b7aeb729a/aadesertwind.jpg?raw=true", cardHook: "For stories that go on too long." },
                { name: "Oracle's Kiss", flavorProfile: "A sweet and floral blend of citrus vodka, elderflower, and cranberry.", recipe: ["1.5 oz Stolichnaya Citros Vodka", "0.5 oz St-Germain", "Fill with Cranberry Juice"], story: "Some lady at a carnival gave our treasurer a 'kiss for good luck.' He woke up three hours later with his wallet gone and a lingering taste of cranberry. We made this to commemorate his gullibility.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_8297.jpg", cardHook: "The future is sweet and flowery." }, 
                
                { name: "Twin Spar", flavorProfile: "A simple and strong pairing of smooth Canadian whiskey and spicy ginger soda.", recipe: ["2 oz Crown Royal", "Fill with Ginger Soda"], story: "Named for the only two brain cells our prospect has left. They work together, they're surprisingly strong, and they're usually fueled by whiskey. Just like this drink.", image: "https://raw.githubusercontent.com/aarmax8/Nomads/90ba0d71f42b567f7e9a417fbd74cedfc805201e/thumbnail_IMG_7998.jpg", cardHook: "Simple, strong, and smooth." },
                
                { name: "Blue Lagoon", flavorProfile: "A vibrant and refreshing citrus cocktail with a stunning blue hue.", recipe: ["1oz Stolichnaya Citros Vodka", "1 oz Blue Curacao", "Top with Sweet and Sour Mix"], story: "We saw this in a fancy magazine and decided to make it our own. Our version is stronger, more questionable, and is best consumed in a garage, not a poolside cabana. It's about authenticity.", 
                  image: "https://raw.githubusercontent.com/aarmax8/Nomads/146cb26058c450290759bf6a90ecaf84a18fc47b/frontend/09df49098aac18eadeeb826a6e5a1f2d.jpg", 
                  cardHook: "Find your oasis." }
            ];

            const processedCocktails = initialCocktails.map((cocktail) => {
                const categories = new Set();
                const recipeString = cocktail.recipe.join(' ').toLowerCase();
                
                if (recipeString.includes('juice') || recipeString.includes('sour mix')) categories.add('Brunch');
                if (recipeString.includes('club soda') || recipeString.includes('tonic water')) categories.add('Lunch');
                if (recipeString.includes('cola') || recipeString.includes('ginger soda')) categories.add('Dinner');
                if (recipeString.includes('baileys irish cream') || recipeString.includes('kahlúa')) categories.add('Desert');
                
                const hasOnlyLemonLime = (recipeString.includes('lemon juice') || recipeString.includes('lime juice')) && !recipeString.includes('orange juice') && !recipeString.includes('pineapple juice') && !recipeString.includes('cranberry juice') && !recipeString.includes('sour mix');
                const hasAnySoda = recipeString.includes('club soda') || recipeString.includes('tonic water') || recipeString.includes('cola') || recipeString.includes('ginger soda');

                if (categories.has('Brunch') && hasOnlyLemonLime && hasAnySoda) categories.delete('Brunch');
                if (categories.size === 0) categories.add('Lunch'); 

                let titleColor = '#f59e0b';
                const spiritOrder = ['Whiskey & Bourbon', 'Vodka', 'Gin', 'Rum', 'Tequila', 'Brandy'];
                const liqueurOrder = ['Fruit', 'Herbal & Spiced', 'Cream, Nut & Coffee', 'Other Schnapps'];
                let mainIngredient = null;

                for (const spiritType of spiritOrder) {
                    const spirits = ingredientCategories.Spirits[spiritType];
                    const foundSpirit = cocktail.recipe.map(parseIngredientName).find(ing => ing && spirits.includes(ing));
                    if (foundSpirit) { mainIngredient = foundSpirit; break; }
                }
                if (!mainIngredient) {
                    for (const liqueurType of liqueurOrder) {
                        const liqueurs = ingredientCategories['Liqueurs & Schnapps'][liqueurType]; 
                        const foundLiqueur = cocktail.recipe.map(parseIngredientName).find(ing => ing && liqueurs.includes(ing));
                        if (foundLiqueur) { mainIngredient = foundLiqueur; break; }
                    }
                }
                if (!mainIngredient && cocktail.recipe.length > 0) {
                     mainIngredient = parseIngredientName(cocktail.recipe[0]);
                }

                if (mainIngredient) titleColor = getIngredientInfo(mainIngredient).colorHex;

                return { ...cocktail, category: Array.from(categories), titleColor };
            });

            cocktails = processedCocktails;
            cocktails.sort((a, b) => a.name.localeCompare(b.name));

            const barcodeCard = {
                name: "Scan to Connect",
                isBarcode: true,
                image: 'https://raw.githubusercontent.com/aarmax8/Nomads/e4ef12fb2bff260fe0d7de78741a3ec2307e381d/3dbarcode.JPG?raw=true',
                recipe: [],
                flavorProfile: "A gateway to the digital road.",
                cardHook: "Point your camera here.",
                category: [],
                titleColor: '#f59e0b'
            };
            cocktails.unshift(barcodeCard);
        }

        // --- Config & Global State ---
        let barStock = {};
        const STOCK_STORAGE_KEY = 'nomads_bar_stock_v2';
        const DRINKS_FAVORITES_KEY = 'nomads_favorite_drinks_v1';
        let activeFilters = {
            category: 'all',
            spirit: null,
            ingredient: null,
            showFavoritesOnly: false
        };
        /* MODIFIED: Set to false to show recipe/drink side first */
        let isGlobalTarotView = false;
        const titleFonts = ['Rye', 'Cinzel', 'IM Fell DW Pica', 'Black Ops One'];
        const ingredientCategories = {
            'Spirits': {
                'Whiskey & Bourbon': ['Bulleit Bourbon', 'Crown Royal', 'Four Roses Whiskey', 'Jameson Irish Whiskey', 'Jim Beam Bourbon', 'Johnnie Walker Red Label', 'Knob Creek', 'Maker\'s Mark', 'Seagram\'s 7', 'Southern Comfort', 'Travellers Whiskey'],
                'Vodka': ['Grey Goose Vodka', 'Ketel One Vodka', 'Stolichnaya Citros Vodka'], 'Gin': ['Tanqueray Gin', 'Sloe Gin'],
                'Rum': ['Bacardi Rum', 'Captain Morgan Spiced Rum', 'Kraken Black Spiced Rum', 'Malibu Rum'],
                'Tequila': ['El Mayor Tequila', 'Jose Cuervo Silver Tequila'], 'Brandy': ['E&J Brandy', 'Apricot Brandy'],
            },
            'Liqueurs & Schnapps': {
                'Fruit': ['Apple Pucker', 'Blue Curacao', 'Cherry Schnapps', 'Cointreau', 'Maraschino Liqueur', 'Peach Schnapps', 'Raspberry Schnapps', 'Triple Sec'],
                'Herbal & Spiced': ['Campari', 'Drambuie', 'Jägermeister', 'Pernod', 'St-Germain'],
                'Cream, Nut & Coffee': ['Amaretto', 'Baileys Irish Cream', 'Kahlúa'],
                'Other Schnapps': ['Butterscotch Schnapps', 'Root Beer Schnapps']
            },
                'Mixers & Bitters': {
                    'Sodas & Juices': ['Club Soda', 'Cola', 'Cranberry Juice', 'Ginger Soda', 'Lemon Juice', 'Lime Juice', 'Orange Juice', 'Pineapple Juice', 'Sour Mix', 'Tonic Water', 'Sweet and Sour Mix'],
                    'Bitters': ['Angostura Bitters', 'Orange Bitters', 'Peychaud\'s Bitters', 'Rosemary Lavender Bitters'],
                    'Syrups': ['Grenadine', 'Simple Syrup', 'Passion Fruit Syrup'],
                },
                'Other': { 'Garnish & Rims': ['Cherry Garnish', 'Lemon Twist Garnish', 'Lime Wedge Garnish', '1 teaspoon Maraschino Liqueur'] }
            };
 
        // --- DOM Elements ---
        const menuGrid = document.getElementById('menu-grid');
        const barStockModal = document.getElementById('bar-stock-modal');
        const filterModal = document.getElementById('filter-modal');
        const favoritesModal = document.getElementById('favorites-modal');
        
        /* UPDATED: Get new action bar button */
        const randomDrinkBtn = document.getElementById('action-random-btn');


        // --- Helper Functions ---
        
        function throttle(func, limit) {
         let lastFunc;
         let lastRan;
         return function(...args) {
           const context = this;
           if (!lastRan) {
             func.apply(context, args);
             lastRan = Date.now();
           } else {
             clearTimeout(lastFunc);
             lastFunc = setTimeout(function() {
               if ((Date.now() - lastRan) >= limit) {
                 func.apply(context, args);
                 lastRan = Date.now();
               }
             }, limit - (Date.now() - lastRan));
           }
         }
       }

        function parseIngredientName(ingStr) {
            let name = ingStr.replace(/^[\d./\s-]+(oz|dashes|dash|garnish)\s*/i, '');
            const instructionalPhrases = [ 'Fill a tall glass with ', 'Fill with ', 'Top with ', 'Splash of ', 'Splash ', '1 teaspoon '];
            for (const phrase of instructionalPhrases) {
                if (name.toLowerCase().startsWith(phrase.toLowerCase())) {
                    name = name.substring(phrase.length);
                    const inIndex = name.toLowerCase().indexOf(' in a');
                    if (inIndex > -1) name = name.substring(0, inIndex);
                    break;
                }
            }
            const pureInstructions = ['serve on the rocks'];
            if(pureInstructions.includes(name.toLowerCase().trim())) return null;
            return name.trim();
        }
        
        function getIngredientInfo(ingredientName) {
            if (!ingredientName) {
                return { icon: 'fa-cube', colorClass: 'text-gray-400', colorHex: '#9ca3af' };
            }
            const lowerIng = ingredientName.toLowerCase();
            const defaultInfo = { icon: 'fa-cube', colorClass: 'text-gray-400', colorHex: '#9ca3af' };

            if (['whiskey', 'bourbon', 'southern comfort', 'maker\'s mark', 'seagram\'s 7', 'knob creek', 'crown royal', 'bulleit', 'jim beam', 'johnnie walker', 'four roses', 'travellers whiskey'].some(s => lowerIng.includes(s))) return { icon: 'fa-whiskey-glass', colorClass: 'text-orange-400', colorHex: '#fb923c' };
            if (['vodka'].some(s => lowerIng.includes(s))) return { icon: 'fa-skull-crossbones', colorClass: 'text-blue-300', colorHex: '#93c5fd' };
            if (['gin'].some(s => lowerIng.includes(s))) return { icon: 'fa-leaf', colorClass: 'text-green-400', colorHex: '#4ade80' };
            if (['rum', 'malibu'].some(s => lowerIng.includes(s))) return { icon: 'fa-anchor', colorClass: 'text-amber-500', colorHex: '#f59e0b' };
            if (['tequila'].some(s => lowerIng.includes(s))) return { icon: 'fa-hat-cowboy-side', colorClass: 'text-amber-400', colorHex: '#fbbf24' };
            if (['brandy'].some(s => lowerIng.includes(s))) return { icon: 'fa-solid fa-wine-glass', colorClass: 'text-purple-400', colorHex: '#d8b4fe' };
            if (['schnapps', 'pucker', 'drambuie', 'jägermeister', 'liqueur', 'baileys', 'pernod', 'kahlúa', 'st-germain', 'cointreau', 'amaretto', 'campari', 'blue curacao'].some(l => lowerIng.includes(l))) return { icon: 'fa-mortar-pestle', colorClass: 'text-purple-400', colorHex: '#c084fc' };
            if (lowerIng.includes('bitters')) return { icon: 'fa-eye-dropper', colorClass: 'text-red-500', colorHex: '#ef4444' };
            if (['juice', 'sour mix'].some(j => lowerIng.includes(j))) return { icon: 'fa-lemon', colorClass: 'text-yellow-400', colorHex: '#facc15' };
            if (['soda', 'tonic', 'cola'].some(m => lowerIng.includes(m))) return { icon: 'fa-faucet-drip', colorClass: 'text-gray-400', colorHex: '#9ca3af' };
            if (['syrup', 'grenadine'].some(s => lowerIng.includes(s))) return { icon: 'fa-prescription-bottle', colorClass: 'text-pink-400', colorHex: '#f472b6' };
            if (lowerIng.includes('cherry garnish')) return { icon: 'fa-solid fa-circle', colorClass: 'text-red-500', colorHex: '#ef4444' };
            if (lowerIng.includes('rim')) return { icon: 'fa-solid fa-circle-notch', colorClass: 'text-gray-300', colorHex: '#d1d5db' };
            if (lowerIng.includes('garnish')) return { icon: 'fa-solid fa-star', colorClass: 'text-yellow-300', colorHex: '#fde047' };
            
            return defaultInfo;
        }
        
        function renderMenu(itemsToRender) {
            menuGrid.innerHTML = '';
            if (itemsToRender.length === 0) {
                menuGrid.innerHTML = `<div class="text-center w-full p-10"><h3 class="text-2xl font-cinzel text-amber-400">No Matching Drinks</h3><p class="text-gray-400 mt-2">Try adjusting your filters in the Browse panel.</p></div>`;
                return;
            }
            itemsToRender.forEach((item, index) => {
                if (item.isBarcode) {
                    const cardHtml = `
                        <div class="drink-card" data-is-barcode="true">
                            <div class="drink-card-inner">
                                <img src="${item.image}" alt="3D Barcode">
                                <div class="text-center mt-2">
                                     <h3 class="drink-card-title" style="color: ${item.titleColor};">${item.name}</h3>
                                     <div class="card-footer text-xs">
                                         <p class="mb-2">${item.cardHook}</p>
                                         <p class="font-normal not-italic leading-tight text-gray-400"><strong class="text-gray-300">To Install for Full Screen:</strong><br><i class="fab fa-apple"></i> iOS: Tap Share then 'Add to Home Screen'.<br><i class="fab fa-android"></i> Android: Tap Menu then 'Install App'.</p>
                                     </div>
                                </div>
                            </div>
                        </div>`;
                    menuGrid.insertAdjacentHTML('beforeend', cardHtml);
                    return; 
                }
                
                const isUnavailable = !isDrinkMakeable(item);
                const titleFont = titleFonts[index % titleFonts.length];
                const drinkFavoriteClass = favoriteDrinks.includes(item.name) ? 'is-favorite' : '';

                const cardHtml = `
                    <div class="drink-card ${isUnavailable ? 'is-unavailable' : ''}" data-name="${item.name}">
                        <div class="drink-card-inner">
                            <div class="drink-card-front">
                                 <div class="card-header-front">
                                    <h3 class="drink-card-title" style="font-family: '${titleFont}', cursive; line-height: 1.1; color: ${item.titleColor};">${item.name}</h3>
                                    <button class="favorite-btn ${drinkFavoriteClass}" data-type="drink"><i class="fas fa-heart"></i></button>
                                </div>
                                <!-- MODIFIED: Reduced padding (pt-3) and font size (text-base) -->
                                <div class="px-6 pt-3 text-center flex-shrink-0">
                                    <p class="text-base mb-2 font-cinzel text-gray-300">${item.flavorProfile}</p>
                                </div>
                                <div class="recipe-content">
                                    <ul class="recipe-list-front">${item.recipe.map(r => { const ingName = parseIngredientName(r) || r; const ingInfo = getIngredientInfo(ingName); return `<li><i class="fas ${ingInfo.icon} ${ingInfo.colorClass}"></i><span>${r}</span></li>`; }).join('')}</ul>
                                </div>
                                <div class="card-hook-tagline">${item.cardHook}</div>
                                <div class="card-footer"></div>
                            </div>
                            <div class="drink-card-back lazy-bg ${!item.image ? 'no-image' : ''}" ${item.image ? `data-bg="url('${item.image}')"` : ''}>
                               <div class="card-back-content">
                                    <p class="story-text">${item.story}</p>
                               </div>
                                <div class="card-footer-back">The Story of ${item.name}</div>
                            </div>
                        </div>
                    </div>`;
                menuGrid.insertAdjacentHTML('beforeend', cardHtml);
            });
        }
        
        function setupLazyLoading() {
            const lazyCards = document.querySelectorAll('.drink-card:not([data-is-barcode="true"])');
            
            if ("IntersectionObserver" in window) {
                const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const card = entry.target; 
                        const imageContainer = card.querySelector('.lazy-bg'); 
                        
                        if (imageContainer) {
                            const imageUrl = imageContainer.dataset.bg;
                            if (imageUrl) {
                                imageContainer.style.setProperty('--bg-image', imageUrl);
                            }
                        }
                        imageObserver.unobserve(card);
                    }
                });
                }, { 
                    root: menuGrid, 
                    rootMargin: "200px" 
                }); 
                
                lazyCards.forEach(card => imageObserver.observe(card));

            } else {
                // Fallback
                document.querySelectorAll('.lazy-bg').forEach(img => {
                    const imageUrl = img.dataset.bg;
                    if (imageUrl) {
                        setTimeout(() => {
                            img.style.setProperty('--bg-image', imageUrl);
                        }, 100);
                    }
                });
            }
        }

        function setCardView(isStoryView) {
            const cards = document.querySelectorAll('#menu-grid .drink-card');
            const toggleBtn = document.getElementById('toggle-view-btn-main'); 
            
            isGlobalTarotView = isStoryView; 

            if (toggleBtn) { 
                if (isGlobalTarotView) {
                    toggleBtn.classList.add('is-story-view');
                } else {
                    toggleBtn.classList.remove('is-story-view');
                }
            }

            if (isGlobalTarotView) {
                cards.forEach(card => {
                    if (card.dataset && !card.dataset.isBarcode) {
                        card.classList.add('is-flipped');
                    }
                });
            } else {
                cards.forEach(card => {
                    card.classList.remove('is-flipped');
                });
            }
        }

        function applyAndRenderFilters() {
            const barcodeCard = cocktails.find(c => c.isBarcode);
            let drinkableCocktails = cocktails.filter(c => !c.isBarcode);

            if (activeFilters.category && activeFilters.category !== 'all') {
                drinkableCocktails = drinkableCocktails.filter(item => item.category.includes(activeFilters.category));
            }

            if (activeFilters.spirit) {
                const spiritsInFamily = ingredientCategories.Spirits[activeFilters.spirit] || [];
                drinkableCocktails = drinkableCocktails.filter(drink =>
                    drink.recipe.some(recipeLine => {
                        const ingredientName = parseIngredientName(recipeLine);
                        return ingredientName && spiritsInFamily.includes(ingredientName);
                    })
                );
            }

            if (activeFilters.ingredient) {
                 drinkableCocktails = drinkableCocktails.filter(drink =>
                    drink.recipe.some(recipeLine => {
                        const ingredientName = parseIngredientName(recipeLine);
                        return ingredientName === activeFilters.ingredient;
                    })
                );
            }
            
            if (activeFilters.showFavoritesOnly) {
                drinkableCocktails = drinkableCocktails.filter(drink => favoriteDrinks.includes(drink.name));
            }

            const itemsToRender = barcodeCard ? [barcodeCard, ...drinkableCocktails] : drinkableCocktails;

            renderMenu(itemsToRender);
            setupLazyLoading(); 
            setCardView(isGlobalTarotView); 
            
            setTimeout(updateActiveCard, 100); 
            updateFilterMenuButtonState(); 
        }
 
        function initializeFavorites() {
            const savedDrinkFavs = localStorage.getItem(DRINKS_FAVORITES_KEY);
            if (savedDrinkFavs) favoriteDrinks = JSON.parse(savedDrinkFavs);
        }

        function toggleFavorite(cardName, type, starButton) {
            let favoritesList = favoriteDrinks;
            const storageKey = DRINKS_FAVORITES_KEY;
            
            const index = favoritesList.indexOf(cardName);
            if (index > -1) {
                favoritesList.splice(index, 1); 
                starButton.classList.remove('is-favorite');
            } else {
                favoritesList.push(cardName); 
                starButton.classList.add('is-favorite');
            }
            localStorage.setItem(storageKey, JSON.stringify(favoritesList));
            
            // ADDED: Update footer button state
            updateFilterMenuButtonState();
        }
        
        function renderFavoritesModal() {
            const container = document.getElementById('favorites-list-container');
            const favoritesList = favoriteDrinks; 
            
            if (favoritesList.length === 0) {
                container.innerHTML = `<p class="text-gray-400 italic text-center">You haven't selected any favorite recipes yet. Tap the heart icon on a card to add it here.</p>`;
                return;
            }

            const itemsHtml = favoritesList.map(name => {
                const cardData = cocktails.find(c => c.name === name);
                if (!cardData) return '';
                const iconInfo = getIngredientInfo(parseIngredientName(cardData.recipe[0] || ''));
                return `
                    <div class="favorite-item" data-name="${cardData.name}" data-view="drink">
                        <i class="fas ${iconInfo.icon} text-xl w-10 text-center ${iconInfo.colorClass}"></i>
                        <div class="ml-4">
                            <h4 class="font-bold text-lg text-white">${cardData.name}</h4>
                            <p class="text-sm text-gray-400">${cardData.flavorProfile.substring(0, 40) + '...'}</p>
                        </div>
                    </div>`;
            }).join('<div class="h-3"></div>');

            container.innerHTML = itemsHtml;
        }


        function updateActiveCard() {
            const containerRect = menuGrid.getBoundingClientRect();
            const containerCenter = containerRect.left + containerRect.width / 2;
            let closestCard = null;
            let minDistance = Infinity;

            menuGrid.querySelectorAll('.drink-card').forEach(card => {
                const cardRect = card.getBoundingClientRect();
                const cardCenter = cardRect.left + cardRect.width / 2;
                const distance = Math.abs(containerCenter - cardCenter);

                if (distance < minDistance) {
                    minDistance = distance;
                    closestCard = card;
                }
            });
            
            if (closestCard) {
                menuGrid.querySelectorAll('.drink-card.is-active').forEach(c => c.classList.remove('is-active'));
                closestCard.classList.add('is-active');
            }
        }
 
        function initializeBarStock() {
            const savedStockJSON = localStorage.getItem(STOCK_STORAGE_KEY);
            const allIngredients = Object.values(ingredientCategories)
                .flatMap(mainCat => Object.values(mainCat).flat());
            
            let savedStock = {};
            if (savedStockJSON) {
                try {
                    savedStock = JSON.parse(savedStockJSON);
                } catch (e) {
                    console.error("Failed to parse bar stock, resetting.", e);
                    savedStock = {};
                }
            }

            const newStock = {};
            allIngredients.forEach(ing => {
                if (savedStock.hasOwnProperty(ing)) {
                    newStock[ing] = savedStock[ing]; // Keep user's setting
                } else {
                    newStock[ing] = true; // Default new ingredient to IN STOCK
                }
            });
            
            barStock = newStock; // Set the global state
            localStorage.setItem(STOCK_STORAGE_KEY, JSON.stringify(barStock)); // Save back to persist new items
        }

        function renderBarStockModal() {
            const contentContainer = document.getElementById('bar-stock-content');
            contentContainer.innerHTML = ''; // Clear previous content
            const renderButtonsForStatus = (status) => {
                let html = `<h3 class="text-xl ${status ? 'text-green-400' : 'text-red-400'} mb-4 font-black-ops">${status ? 'IN STOCK' : 'OUT OF STOCK'}</h3>`;
                let hasAnyContent = false;
                Object.keys(ingredientCategories).forEach(mainCategoryName => {
                    let mainCategoryHtml = ''; let hasContentInMainCategory = false;
                    Object.keys(ingredientCategories[mainCategoryName]).forEach(subCategoryName => {
                        const subCategoryIngredients = ingredientCategories[mainCategoryName][subCategoryName]
                            .filter(ing => barStock[ing] === status) // Filter based on status
                            .map(ing => `<button data-ingredient="${ing}" class="ingredient-btn text-sm text-white py-1 px-4 transition-colors">${ing}</button>`)
                            .join('');
                        
                        if (subCategoryIngredients.length > 0) {
                            hasContentInMainCategory = true;
                            hasAnyContent = true;
                            mainCategoryHtml += `<div class="mb-3"><h5 class="text-md font-bold text-gray-400 mb-2">${subCategoryName}</h5><div class="flex flex-wrap gap-2">${subCategoryIngredients}</div></div>`;
                        }
                    });
                    if (hasContentInMainCategory) {
                         html += `<div class="mb-6"><h4 class="text-xl font-rye text-amber-500 mb-3 border-b-2 border-gray-600 pb-2">${mainCategoryName}</h4>${mainCategoryHtml}</div>`;
                    }
                });
                 if (!hasAnyContent) { html += `<p class="text-gray-500 italic">Nothing to show here.</p>`; }
                return html;
            };
            // Render both sections
            contentContainer.innerHTML = renderButtonsForStatus(true) + '<div class="border-t-2 border-dashed border-gray-600 my-6"></div>' + renderButtonsForStatus(false);
            
            // Re-attach event listeners after rendering
            contentContainer.querySelectorAll('.ingredient-btn').forEach(btn => {
                btn.addEventListener('click', () => toggleStock(btn.dataset.ingredient));
            });
        }
        
        function isDrinkMakeable(drink) {
            return drink.recipe.every(ingStr => {
                const ingName = parseIngredientName(ingStr);
                return ingName === null || barStock[ingName] !== false;
            });
        }

        function toggleStock(ingredient) {
            // Ensure ingredient exists in barStock before toggling
            if (barStock.hasOwnProperty(ingredient)) {
                 barStock[ingredient] = !barStock[ingredient];
            } else {
                 // If somehow it doesn't exist, assume it was out and now it's in
                 barStock[ingredient] = true;
            }
            localStorage.setItem(STOCK_STORAGE_KEY, JSON.stringify(barStock));
            renderBarStockModal(); // Re-render the modal content
            applyAndRenderFilters(); // Update main menu availability
        }
        
        function initializeFilterModal() {
            const filterModalContent = document.getElementById('filter-modal-content');
            
            const favoritesFilter = `
                <div class="flex items-center justify-between bg-black/20 p-3 rounded-lg">
                    <h3 class="text-lg text-amber-500 font-rye tracking-wider">Show Favorites Only</h3>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="favorites-filter-toggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-600 rounded-full peer peer-focus:ring-2 peer-focus:ring-amber-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-amber-600"></div>
                    </label>
                </div>
            `;

             const categoryFilters = `
                <div>
                    <h3 class="text-lg text-amber-500 mb-2 font-rye tracking-wider">Food Pairing</h3>
                    <div id="filter-group-category" class="flex flex-wrap gap-3">
                        <button data-category="all" class="filter-pill">The Full Deck</button>
                        <button data-category="Brunch" class="filter-pill">Brunch</button>
                        <button data-category="Lunch" class="filter-pill">Lunch</button>
                        <button data-category="Dinner" class="filter-pill">Dinner</button>
                        <button data-category="Desert" class="filter-pill">Desert</button>
                    </div>
                </div>`;
            
            const spiritCategories = Object.keys(ingredientCategories.Spirits);
            const spiritFilters = `
                <div>
                    <h3 class="text-lg text-amber-500 mb-2 font-rye tracking-wider">Spirit</h3>
                    <div id="filter-group-spirit" class="flex flex-wrap gap-3">
                        ${spiritCategories.map(spirit => `<button data-spirit="${spirit}" class="filter-pill">${spirit}</button>`).join('')}
                    </div>
                </div>`;

            const allIngredients = Object.values(ingredientCategories)
                .flatMap(mainCat => Object.values(mainCat).flat())
                .sort();
            
            const ingredientFilter = `
                <div>
                    <h3 class="text-lg text-amber-500 mb-2 font-rye tracking-wider">Contains Ingredient</h3>
                     <select id="ingredient-filter-select" class="w-full bg-gray-800 border border-gray-600 rounded-lg p-2 text-white focus:outline-none focus:ring-2 focus:ring-amber-500">
                         <option value="">Any Ingredient</option>
                         ${allIngredients.map(ing => `<option value="${ing}">${ing}</option>`).join('')}
                    </select>
                </div>
            `;

            filterModalContent.innerHTML = `
                <div class="space-y-4">
                    ${favoritesFilter}
                    <div class="filter-separator"></div>
                    ${categoryFilters}
                    ${spiritFilters}
                    ${ingredientFilter}
                </div>`;
            
            updatePillsFromState();
        }

        function updatePillsFromState() {
            document.querySelectorAll('#filter-modal .filter-pill').forEach(p => p.classList.remove('is-active'));
            document.querySelector(`#filter-group-category .filter-pill[data-category="${activeFilters.category}"]`)?.classList.add('is-active');
            if(activeFilters.spirit) {
                document.querySelector(`#filter-group-spirit .filter-pill[data-spirit="${activeFilters.spirit}"]`)?.classList.add('is-active');
            }
            const ingredientSelect = document.getElementById('ingredient-filter-select');
            if (ingredientSelect) {
                ingredientSelect.value = activeFilters.ingredient || '';
            }
            const favToggle = document.getElementById('favorites-filter-toggle');
            if (favToggle) {
                favToggle.checked = activeFilters.showFavoritesOnly;
            }
        }
 
        function highlightAndScrollToCard(card) {
            card.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            document.querySelectorAll('.is-highlighted').forEach(c => c.classList.remove('is-highlighted'));
            card.classList.add('is-highlighted');
            setTimeout(() => card.classList.remove('is-highlighted'), 2500);
        }
        
        function updateFilterMenuButtonState() {
            /* UPDATED: Target new action bar button */
            const filtersBtn = document.getElementById('action-filters-btn');
            if (!filtersBtn) return;

            const isFilterActive = activeFilters.category !== 'all' || 
                                   activeFilters.spirit !== null || 
                                   activeFilters.ingredient !== null || 
                                   activeFilters.showFavoritesOnly;
                                   
            if (isFilterActive) {
                filtersBtn.classList.add('is-active-filter');
            } else {
                filtersBtn.classList.remove('is-active-filter');
            }
            
            /* UPDATED: Target new action bar button */
            const favoritesBtn = document.getElementById('action-favorites-btn');
            if (favoritesBtn) {
                if (favoriteDrinks.length > 0) {
                    favoritesBtn.classList.add('is-active');
                } else {
                    favoritesBtn.classList.remove('is-active');
                }
            }
        }

        // --- END HELPER FUNCTIONS ---
 
        document.addEventListener('DOMContentLoaded', () => {
            // --- START: Critical setup wrapped in try/catch ---
            try {
                setupCocktailData();
                initializeFavorites();
                initializeBarStock();
                initializeFilterModal(); 
                applyAndRenderFilters(); 
                updateFilterMenuButtonState(); 
            } catch (error) {
                console.error("Critical Setup Error:", error);
                // Fallback rendering in case data setup fails
                menuGrid.innerHTML = `<div class="text-center w-full p-10"><h3 class="text-2xl font-cinzel text-red-400">Application Error</h3><p class="text-gray-400 mt-2">Could not load the menu data. Please check the console for details.</p></div>`;
            }
            // --- END: Critical setup wrapped in try/catch ---
            
            // --- Splash Screen ---
            const splashScreen = document.getElementById('splash-screen');
            const splashSeenKey = 'nomads_splash_seen_v1';
            
            if (splashScreen) {
                if (sessionStorage.getItem(splashSeenKey) === 'true') {
                    splashScreen.style.transition = 'none'; 
                    splashScreen.classList.add('is-hidden');
                } else {
                    splashScreen.addEventListener('click', () => {
                        splashScreen.classList.add('is-hidden');
                        sessionStorage.setItem(splashSeenKey, 'true');
                    }, { once: true }); 
                }
            }

            // --- Menu Grid Events ---
            menuGrid.addEventListener('click', e => {
                const favoriteButton = e.target.closest('.favorite-btn');
                if (favoriteButton) {
                    e.stopPropagation(); 
                    const cardName = e.target.closest('.drink-card').dataset.name;
                    toggleFavorite(cardName, favoriteButton.dataset.type, favoriteButton);
                    return;
                }

                const cardInner = e.target.closest('.drink-card-inner');
                 if (cardInner) {
                      const card = cardInner.closest('.drink-card');
                      if(card && !card.dataset.isBarcode) {
                         card.classList.toggle('is-flipped');
                      }
                 }
            });

            // --- Active Card on Scroll ---
            let scrollTimeout;
            menuGrid.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(updateActiveCard, 150);
            });
        
 
            // --- Modals ---
            function closeModal(modalElement) {
                if (!modalElement) return;
                modalElement.classList.add('opacity-0');
                setTimeout(() => {
                    modalElement.classList.add('hidden');
                }, 300); 
            }

            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal);
                    }
                });
            });

            // Favorites Modal Close & Item Click
            document.getElementById('close-favorites-btn')?.addEventListener('click', () => closeModal(favoritesModal));
            document.getElementById('favorites-list-container').addEventListener('click', (e) => {
                 const favoriteItem = e.target.closest('.favorite-item');
                 if (favoriteItem) {
                     const cardName = favoriteItem.dataset.name;
                     const cardEl = document.querySelector(`.drink-card[data-name="${cardName}"]`);
                     if (cardEl) {
                         if (favoriteItem.dataset.view === 'drink') {
                             cardEl.classList.remove('is-flipped');
                         }
                         highlightAndScrollToCard(cardEl);
                     }
                     closeModal(favoritesModal);
                 }
            });

            // Bar Stock Modal Close
            document.getElementById('close-stock-btn')?.addEventListener('click', () => closeModal(barStockModal));

            // Filter Modal Close & Actions
            document.getElementById('close-filter-btn')?.addEventListener('click', () => closeModal(filterModal));
            document.getElementById('apply-filters-btn')?.addEventListener('click', () => {
                applyAndRenderFilters();
                closeModal(filterModal);
            });
            document.getElementById('reset-filters-btn')?.addEventListener('click', () => {
                activeFilters = { category: 'all', spirit: null, ingredient: null, showFavoritesOnly: false };
                updatePillsFromState();
                applyAndRenderFilters();
            });
            
            // Filter Modal Content Interactions
            document.getElementById('filter-modal-content').addEventListener('click', (e) => {
                const pill = e.target.closest('.filter-pill');
                if (!pill) return;
                const categoryGroup = e.target.closest('#filter-group-category');
                const spiritGroup = e.target.closest('#filter-group-spirit');
                if (categoryGroup) {
                    activeFilters.category = pill.dataset.category;
                    categoryGroup.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('is-active'));
                    pill.classList.add('is-active');
                } else if (spiritGroup) {
                    const spirit = pill.dataset.spirit;
                    if (activeFilters.spirit === spirit) {
                        activeFilters.spirit = null;
                        pill.classList.remove('is-active');
                    } else {
                        activeFilters.spirit = spirit;
                        spiritGroup.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('is-active'));
                        pill.classList.add('is-active');
                    }
                }
            });
            document.getElementById('ingredient-filter-select')?.addEventListener('change', (e) => {
                 activeFilters.ingredient = e.target.value || null;
            });
            document.getElementById('favorites-filter-toggle')?.addEventListener('change', (e) => {
                activeFilters.showFavoritesOnly = e.target.checked;
            });


            // --- NEW: Action Bar Button Listeners ---
            document.getElementById('action-filters-btn')?.addEventListener('click', () => {
                updatePillsFromState(); 
                filterModal.classList.remove('hidden');
                setTimeout(() => filterModal.classList.remove('opacity-0'), 10);
            });
            
            document.getElementById('action-favorites-btn')?.addEventListener('click', () => {
                renderFavoritesModal(); 
                favoritesModal.classList.remove('hidden');
                setTimeout(() => favoritesModal.classList.remove('opacity-0'), 10);
            });
            
            document.getElementById('action-stock-btn')?.addEventListener('click', () => {
                renderBarStockModal(); // Render content before showing
                barStockModal.classList.remove('hidden');
                setTimeout(() => barStockModal.classList.remove('opacity-0'), 10);
            });

            // --- Footer Buttons (and remaining action bar) ---
            if (randomDrinkBtn) { // Note: randomDrinkBtn var was updated above
                randomDrinkBtn.addEventListener('click', () => {
                    const allDrinkCards = document.querySelectorAll('.drink-card:not([data-is-barcode="true"])');
                    if (allDrinkCards.length === 0) return; 
                    const randomIndex = Math.floor(Math.random() * allDrinkCards.length);
                    const randomCard = allDrinkCards[randomIndex];
                    randomCard.classList.remove('is-flipped'); 
                    highlightAndScrollToCard(randomCard);
                });
            }
            
            const scrollPrevBtn = document.getElementById('scroll-prev-btn');
            if (scrollPrevBtn) {
                scrollPrevBtn.addEventListener('click', () => {
                    const cards = Array.from(menuGrid.querySelectorAll('.drink-card'));
                    if (cards.length === 0) return;
                    const activeCard = menuGrid.querySelector('.drink-card.is-active') || cards[0];
                    const activeIndex = cards.indexOf(activeCard);
                    const targetIndex = Math.max(0, activeIndex - 8); /* MODIFIED: Was 4, now 8 */
                    if (activeIndex !== targetIndex) {
                        cards[targetIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    }
                });
            }

            const scrollNextBtn = document.getElementById('scroll-next-btn');
            if (scrollNextBtn) {
                scrollNextBtn.addEventListener('click', () => {
                    const cards = Array.from(menuGrid.querySelectorAll('.drink-card'));
                    if (cards.length === 0) return;
                    const activeCard = menuGrid.querySelector('.drink-card.is-active') || cards[0];
                    const activeIndex = cards.indexOf(activeCard);
                    const targetIndex = Math.min(cards.length - 1, activeIndex + 8); /* MODIFIED: Was 4, now 8 */
                    if (activeIndex !== targetIndex) {
                        cards[targetIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    }
                });
            }
            
            const toggleViewBtnMain = document.getElementById('toggle-view-btn-main');
            const throttledToggle = throttle(() => {
                 setCardView(!isGlobalTarotView); 
            }, 300); 
            if (toggleViewBtnMain) {
                toggleViewBtnMain.addEventListener('click', throttledToggle);
            }

        }); // End DOMContentLoaded
 
    </script>
</body>
</html>











