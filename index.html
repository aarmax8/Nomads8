10/10/25 morning


<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Corrected Version: October 10, 2025 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOMADS</title>
    
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Nomads Menu">
    <meta name="application-name" content="Nomads Menu">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/111827/f59e0b?text=N">
    <link rel="icon" sizes="192x192" href="https://placehold.co/192x192/111827/f59e0b?text=N">
    <link rel="icon" sizes="512x512" href="https://placehold.co/512x512/111827/f59e0b?text=N">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto+Condensed:ital,wght@0,700;1,400&family=Roboto:ital,wght@0,400;0,500;1,700&family=Rye&family=Bangers&family=Creepster&family=Metal+Mania&family=Nosifier&family=UnifrakturMaguntia&family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
      
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a110a; /* Dark wood fallback */
            background-image: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.85)), url('https://www.transparenttextures.com/patterns/worn-dots.png');
            background-attachment: fixed;
        }
        
        h2, h3 {
            font-family: 'Black Ops One', cursive;
            text-shadow: 1px 1px 0 #000, 2px 2px 0 #333;
            letter-spacing: 0.05em;
        }
        .drink-card h3, .modal h2, #gemini-drink-output h3 {
            font-family: 'Rye', cursive;
            text-shadow: 2px 2px 0 #000;
            letter-spacing: normal;
        }
        
        .drink-card-logo-area {
            position: relative;
            min-height: 240px;
            background-color: #111827;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-top-left-radius: 0.375rem;
            border-top-right-radius: 0.375rem;
        }
        .drink-card-title-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .title-loader {
            border: 3px solid #4b5563;
            border-top: 3px solid #f59e0b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        .drink-card-logo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .drink-card-title-fallback {
            font-family: 'Rye', cursive;
            text-shadow: 2px 2px 0 #000;
            font-size: 2rem;
            color: white;
            text-align: center;
            padding: 1rem;
        }
        .retry-logo-btn {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.5rem;
            margin-left: 0.5rem;
            transition: all 0.2s ease-in-out;
        }
        .retry-logo-btn:hover {
            color: #f59e0b;
            transform: rotate(90deg);
        }
        
        .card-icon-group {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        .category-icons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .category-icons i {
            font-size: 1.25rem;
            opacity: 0.9;
            text-shadow: 1px 1px 2px #000;
        }

        .font-condensed { font-family: 'Roboto Condensed', sans-serif; }
        .font-rye { font-family: 'Rye', cursive; line-height: 1.6; }
        .font-black-ops { font-family: 'Black Ops One', cursive; }

        .recipe-list { list-style: disc; margin-left: 1.5rem; line-height: 1.4; }
        .modal { transition: opacity 0.3s ease-in-out; }
        
        /* --- STYLES FOR FLIP CARDS & "POP" --- */
        .drink-card {
            perspective: 1000px;
            background-color: transparent;
            min-height: 480px; /* Increased height */
            cursor: pointer;
        }
        .drink-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.7);
            border-radius: 0.375rem; /* rounded-md */
        }
        .drink-card.is-flipped .drink-card-inner {
            transform: rotateY(180deg);
        }
        .drink-card-front, .drink-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.375rem; /* rounded-md */
            background-color: #1f2937;
            border: 1px solid #4b5563;
        }
        .drink-card-front {
            display: flex;
            flex-direction: column;
        }
        .drink-card-back {
            transform: rotateY(180deg);
            padding: 1rem;
            overflow-y: auto;
        }
        .drink-card.is-active-card .drink-card-inner {
             box-shadow: 0 0 15px 4px #f59e0b, 0 10px 20px rgba(0,0,0,0.7); /* amber-500 glow */
        }
        .drink-card-front .recipe-list { list-style: none; padding-left: 0; }
        
        .drink-image-container {
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0,0,0,0.2);
            border-radius: 0.375rem;
        }

        /* --- Scroll Snap for Drink Cards --- */
        #menu-grid {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scroll-padding: 1rem;
            -webkit-overflow-scrolling: touch;
            padding: 1rem;
            scrollbar-width: none; /* Firefox */
        }
        #menu-grid::-webkit-scrollbar { 
            display: none; /* Safari and Chrome */
        }
        
        #menu-grid > .drink-card { flex: 0 0 90%; scroll-snap-align: center; }
        @media (min-width: 768px) { #menu-grid > .drink-card { flex-basis: 45%; } }
        @media (min-width: 1024px) { #menu-grid > .drink-card { flex-basis: 31%; } }

        /* --- Gemini & UI Button Styles --- */
        .choice-btn, .gemini-btn { transition: all 0.2s ease-in-out; }
        .choice-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #4F46E5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes ride { 0%, 100% { transform: translateY(0) rotate(-10deg); } 50% { transform: translateY(-3px) rotate(-5deg); } }
        @keyframes roll { 0% { transform: rotate(0deg) scale(1); } 100% { transform: rotate(360deg) scale(1); } }
        .rolling-die { animation: roll 0.4s linear infinite; }

        /* --- Filter Button Styles --- */
        .filter-btn, .flavor-filter-btn {
            font-family: 'Roboto Condensed', sans-serif; font-weight: 700; text-transform: uppercase; background-color: #1a202c; border: 2px solid #111827;
            border-bottom-color: #4a5568; color: #a0aec0; padding: 0.5rem 1rem; border-radius: 0.375rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.6), 0 1px 1px rgba(255,255,255,0.1); transition: all 0.15s ease-out; flex-shrink: 0;
        }
        .filter-btn:hover, .flavor-filter-btn:hover { background-color: #2d3748; color: #e2e8f0; }
        .filter-btn.active-filter, .flavor-filter-btn.active-filter {
            background-color: #f59e0b; color: #1a202c; border-color: #dd6b20; border-top-color: #f6ad55;
            transform: translateY(1px); box-shadow: inset 0 3px 6px rgba(0,0,0,0.4); text-shadow: 0 1px 1px rgba(255,255,255,0.2);
        }
        .filter-btn.active-filter i, .flavor-filter-btn.active-filter i { color: #1a202c !important; }
        .filter-btn i, .flavor-filter-btn i { transition: color 0.15s ease-out; }

        /* --- Toggle Switch Styles --- */
        .toggle-text { font-family: 'Black Ops One', cursive; font-size: 0.8rem; text-transform: uppercase; color: #a0aec0; letter-spacing: 1px; position: absolute; left: 0; right: 0; text-align: right; padding-right: 12px; pointer-events: none; z-index: 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.7); transition: color 0.2s ease-in-out; }
        .toggle-switch.on .toggle-text { color: #f59e0b; }
        .toggle-switch { width: 160px; height: 44px; background-image: linear-gradient(to top, #1a202c, #2d3748); border-radius: 6px; padding: 4px; cursor: pointer; border: 2px solid #111827; border-bottom-color: #4a5568; box-shadow: inset 0 2px 4px rgba(0,0,0,0.6), 0 1px 1px rgba(255,255,255,0.1); position: relative; display: flex; align-items: center; justify-content: flex-start; }
        .toggle-switch .toggle-nub { width: 32px; height: 32px; border-radius: 4px; background-image: linear-gradient(to top, #6b7280, #e5e7eb, #6b7280); box-shadow: 0 2px 4px rgba(0,0,0,0.5), inset 0 1px 1px rgba(255,255,255,0.2); transition: transform 0.2s cubic-bezier(0.68, -0.55, 0.27, 1.55); display: flex; align-items: center; justify-content: center; position: relative; z-index: 10; }
        .toggle-switch.on .toggle-nub { transform: translateX(120px); }
        .toggle-switch .toggle-nub i { font-size: 1rem; color: #1a202c; text-shadow: 0 1px 0 rgba(255,255,255,0.2); transition: transform 0.2s ease-in-out; }
        #bar-stock-toggle.on .toggle-nub i { animation: ride 0.5s ease-in-out infinite; }
        #suggest-drink-toggle.on .toggle-nub i { animation: roll 0.4s linear; }

        #create-drink-btn { background-image: linear-gradient(to top, #000000, #1f2d37); border: 1px solid #000; text-shadow: 1px 1px 2px rgba(0,0,0,0.6); box-shadow: inset 0 1px 1px rgba(255,255,255,0.15), inset 0 -2px 3px rgba(0,0,0,0.6), 0 2px 4px rgba(0,0,0,0.5); transition: all 0.2s ease-in-out; }
        #create-drink-btn:hover { background-image: linear-gradient(to top, #1f2d37, #4b5563); transform: translateY(-2px); box-shadow: inset 0 1px 1px rgba(255,255,255,0.15), inset 0 -2px 3px rgba(0,0,0,0.6), 0 4px 6px rgba(0,0,0,0.5); }
        
        #show-story-link { font-family: 'Rye', cursive; color: #f59e0b; cursor: pointer; transition: all 0.2s ease-in-out; text-shadow: 1px 1px 2px #000; font-size: 1rem; line-height: 1; }
        #show-story-link:hover { color: #fcd34d; transform: scale(1.05); }

        /* --- UPDATED HEADER PATCH STYLE --- */
        .header-patch {
            background-image: linear-gradient(to top, #111827, #2c3547);
            border-radius: 1rem;
            padding: 1rem;
            margin: 0 auto;
            max-width: 900px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.7), inset 0 0 15px rgba(0,0,0,0.8), inset 0 2px 2px rgba(255,255,255,0.1);
            position: relative;
            border: 2px solid;
            border-image-slice: 1;
            border-image-source: linear-gradient(to bottom, #6b7280, #4b5563);
        }
        
        .sticky-filter-bar { position: sticky; bottom: 0; z-index: 40; background-color: #111827; background-image: linear-gradient(to top, rgba(17, 24, 39, 1) 50%, rgba(17, 24, 39, 0.9)); box-shadow: 0 -10px 20px rgba(0,0,0,0.5); border-top: 2px solid #374151; }
        #category-filter-nav, #flavor-filter-nav { display: flex; overflow-x: auto; -webkit-overflow-scrolling: touch; padding: 0.5rem 1rem; }
        #flavor-filter-nav { border-bottom: 1px solid #374151; padding-top: 0.25rem; padding-bottom: 0.25rem; }
        #category-filter-nav::-webkit-scrollbar, #flavor-filter-nav::-webkit-scrollbar { display: none; }
        #category-filter-nav, #flavor-filter-nav { -ms-overflow-style: none; scrollbar-width: none; }
        footer { padding-bottom: 120px; }

        .ingredient-btn.out-of-stock { opacity: 0.5; background-color: #374151; text-decoration: line-through; }
        .ingredient-btn.out-of-stock:hover { background-color: #4b5563; }

        /* --- STRENGTH METER & FLAVOR ICONS --- */
        .strength-meter, .flavor-icons { display: flex; justify-content: center; gap: 0.5rem; }
        .flavor-icons { height: 20px; }
        .strength-meter i, .flavor-icons i { font-size: 1.25rem; }
        .strength-meter .filled { color: #f59e0b; text-shadow: 0 0 5px #f59e0b; }
        .strength-meter .empty { color: #4b5563; opacity: 0.7; }
        .flavor-icons i { transition: transform 0.2s ease-in-out; }
        .flavor-icons i:hover { transform: scale(1.2); }
        .fa-candy-cane{color:#ffb8c1}.fa-lemon{color:#fde047}.fa-pepper-hot{color:#ef4444}.fa-seedling{color:#84cc16}.fa-cloud{color:#f1f5f9}.fa-mug-hot{color:#854d0e}.fa-coffee{color:#a16207}.fa-fan{color:#a855f7}.fa-star-of-life{color:#7dd3fc}.fa-bolt{color:#facc15}.fa-snowflake{color:#67e8f9}.fa-water{color:#38bdf8}.fa-umbrella-beach{color:#f97316}.fa-apple-whole{color:#dc2626}.fa-fist-raised{color:#b91c1c}.fa-wave-square{color:#60a5fa}.fa-leaf{color:#57534e}.fa-moon{color:#4338ca}.fa-cookie-bite{color:#d4a373}.fa-icicles{color:#e0f2fe}.fa-dumbbell{color:#6b7280}.fa-circle{color:#d1d5db}.fa-cube{color:#3730a3}.fa-wind{color:#9ca3af}.fa-cactus{color:#85a23d}.fa-circle-dot{color:#fed7aa}.fa-mortar-pestle{color:#c084fc}

        /* --- Navigation Arrows --- */
        .nav-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(17, 24, 39, 0.5);
            color: #d1d5db;
            border: 2px solid #4b5563;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 35;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease-in-out;
        }
        .nav-arrow:hover {
            background-color: rgba(245, 158, 11, 0.8);
            color: #111827;
            border-color: #f59e0b;
        }
        #arrow-left { left: 10px; }
        #arrow-right { right: 10px; }
        @media (min-width: 1280px) {
            #arrow-left { left: calc(50vw - 600px); }
            #arrow-right { right: calc(50vw - 600px); }
        }
<style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a110a; /* Dark wood fallback */
            background-image: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.85)), url('https://www.transparenttextures.com/patterns/worn-dots.png');
            background-attachment: fixed;
        }
        
        h2, h3 {
            font-family: 'Black Ops One', cursive;
            text-shadow: 1px 1px 0 #000, 2px 2px 0 #333;
            letter-spacing: 0.05em;
        }
        .drink-card h3, .modal h2, #gemini-drink-output h3 {
            font-family: 'Rye', cursive;
            text-shadow: 2px 2px 0 #000;
            letter-spacing: normal;
        }
        
        .drink-card-logo-area {
            position: relative;
            min-height: 240px;
            background-color: #111827;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-top-left-radius: 0.375rem;
            border-top-right-radius: 0.375rem;
        }
        .drink-card-title-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .title-loader {
            border: 3px solid #4b5563;
            border-top: 3px solid #f59e0b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        .drink-card-logo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .drink-card-title-fallback {
            font-family: 'Rye', cursive;
            text-shadow: 2px 2px 0 #000;
            font-size: 2rem;
            color: white;
            text-align: center;
            padding: 1rem;
        }
        .retry-logo-btn {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.5rem;
            margin-left: 0.5rem;
            transition: all 0.2s ease-in-out;
        }
        .retry-logo-btn:hover {
            color: #f59e0b;
            transform: rotate(90deg);
        }
        
        .card-icon-group {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }
        .category-icons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .category-icons i {
            font-size: 1.25rem;
            opacity: 0.9;
            text-shadow: 1px 1px 2px #000;
        }

        .font-condensed { font-family: 'Roboto Condensed', sans-serif; }
        .font-rye { font-family: 'Rye', cursive; line-height: 1.6; }
        .font-black-ops { font-family: 'Black Ops One', cursive; }

        .recipe-list { list-style: disc; margin-left: 1.5rem; line-height: 1.4; }
        .modal { transition: opacity 0.3s ease-in-out; }
        
        /* --- STYLES FOR FLIP CARDS & "POP" --- */
        .drink-card {
            perspective: 1000px;
            background-color: transparent;
            min-height: 480px; /* Increased height */
            cursor: pointer;
        }
        .drink-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.7);
            border-radius: 0.375rem; /* rounded-md */
        }
        .drink-card.is-flipped .drink-card-inner {
            transform: rotateY(180deg);
        }
        .drink-card-front, .drink-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.375rem; /* rounded-md */
            background-color: #1f2937;
            border: 1px solid #4b5563;
        }
        .drink-card-front {
            display: flex;
            flex-direction: column;
        }
        .drink-card-back {
            transform: rotateY(180deg);
            padding: 1rem;
            overflow-y: auto;
        }
        .drink-card.is-active-card .drink-card-inner {
             box-shadow: 0 0 15px 4px #f59e0b, 0 10px 20px rgba(0,0,0,0.7); /* amber-500 glow */
        }
        .drink-card-front .recipe-list { list-style: none; padding-left: 0; }
        
        .drink-image-container {
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0,0,0,0.2);
            border-radius: 0.375rem;
        }

        /* --- Scroll Snap for Drink Cards --- */
        #menu-grid {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scroll-padding: 1rem;
            -webkit-overflow-scrolling: touch;
            padding: 1rem;
            scrollbar-width: none; /* Firefox */
        }
        #menu-grid::-webkit-scrollbar { 
            display: none; /* Safari and Chrome */
        }
        
        #menu-grid > .drink-card { flex: 0 0 90%; scroll-snap-align: center; }
        @media (min-width: 768px) { #menu-grid > .drink-card { flex-basis: 45%; } }
        @media (min-width: 1024px) { #menu-grid > .drink-card { flex-basis: 31%; } }

        /* --- Gemini & UI Button Styles --- */
        .choice-btn, .gemini-btn { transition: all 0.2s ease-in-out; }
        .choice-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #4F46E5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes ride { 0%, 100% { transform: translateY(0) rotate(-10deg); } 50% { transform: translateY(-3px) rotate(-5deg); } }
        @keyframes roll { 0% { transform: rotate(0deg) scale(1); } 100% { transform: rotate(360deg) scale(1); } }
        .rolling-die { animation: roll 0.4s linear infinite; }

        /* --- Filter Button Styles --- */
        .filter-btn, .flavor-filter-btn {
            font-family: 'Roboto Condensed', sans-serif; font-weight: 700; text-transform: uppercase; background-color: #1a202c; border: 2px solid #111827;
            border-bottom-color: #4a5568; color: #a0aec0; padding: 0.5rem 1rem; border-radius: 0.375rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.6), 0 1px 1px rgba(255,255,255,0.1); transition: all 0.15s ease-out; flex-shrink: 0;
        }
        .filter-btn:hover, .flavor-filter-btn:hover { background-color: #2d3748; color: #e2e8f0; }
        .filter-btn.active-filter, .flavor-filter-btn.active-filter {
            background-color: #f59e0b; color: #1a202c; border-color: #dd6b20; border-top-color: #f6ad55;
            transform: translateY(1px); box-shadow: inset 0 3px 6px rgba(0,0,0,0.4); text-shadow: 0 1px 1px rgba(255,255,255,0.2);
        }
        .filter-btn.active-filter i, .flavor-filter-btn.active-filter i { color: #1a202c !important; }
        .filter-btn i, .flavor-filter-btn i { transition: color 0.15s ease-out; }

        /* --- Toggle Switch Styles --- */
        .toggle-text { font-family: 'Black Ops One', cursive; font-size: 0.8rem; text-transform: uppercase; color: #a0aec0; letter-spacing: 1px; position: absolute; left: 0; right: 0; text-align: right; padding-right: 12px; pointer-events: none; z-index: 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.7); transition: color 0.2s ease-in-out; }
        .toggle-switch.on .toggle-text { color: #f59e0b; }
        .toggle-switch { width: 160px; height: 44px; background-image: linear-gradient(to top, #1a202c, #2d3748); border-radius: 6px; padding: 4px; cursor: pointer; border: 2px solid #111827; border-bottom-color: #4a5568; box-shadow: inset 0 2px 4px rgba(0,0,0,0.6), 0 1px 1px rgba(255,255,255,0.1); position: relative; display: flex; align-items: center; justify-content: flex-start; }
        .toggle-switch .toggle-nub { width: 32px; height: 32px; border-radius: 4px; background-image: linear-gradient(to top, #6b7280, #e5e7eb, #6b7280); box-shadow: 0 2px 4px rgba(0,0,0,0.5), inset 0 1px 1px rgba(255,255,255,0.2); transition: transform 0.2s cubic-bezier(0.68, -0.55, 0.27, 1.55); display: flex; align-items: center; justify-content: center; position: relative; z-index: 10; }
        .toggle-switch.on .toggle-nub { transform: translateX(120px); }
        .toggle-switch .toggle-nub i { font-size: 1rem; color: #1a202c; text-shadow: 0 1px 0 rgba(255,255,255,0.2); transition: transform 0.2s ease-in-out; }
        #bar-stock-toggle.on .toggle-nub i { animation: ride 0.5s ease-in-out infinite; }
        #suggest-drink-toggle.on .toggle-nub i { animation: roll 0.4s linear; }

        #create-drink-btn { background-image: linear-gradient(to top, #000000, #1f2d37); border: 1px solid #000; text-shadow: 1px 1px 2px rgba(0,0,0,0.6); box-shadow: inset 0 1px 1px rgba(255,255,255,0.15), inset 0 -2px 3px rgba(0,0,0,0.6), 0 2px 4px rgba(0,0,0,0.5); transition: all 0.2s ease-in-out; }
        #create-drink-btn:hover { background-image: linear-gradient(to top, #1f2d37, #4b5563); transform: translateY(-2px); box-shadow: inset 0 1px 1px rgba(255,255,255,0.15), inset 0 -2px 3px rgba(0,0,0,0.6), 0 4px 6px rgba(0,0,0,0.5); }
        
        #show-story-link { font-family: 'Rye', cursive; color: #f59e0b; cursor: pointer; transition: all 0.2s ease-in-out; text-shadow: 1px 1px 2px #000; font-size: 1rem; line-height: 1; }
        #show-story-link:hover { color: #fcd34d; transform: scale(1.05); }

        /* --- UPDATED HEADER PATCH STYLE --- */
        .header-patch {
            background-image: linear-gradient(to top, #111827, #2c3547);
            border-radius: 1rem;
            padding: 1rem;
            margin: 0 auto;
            max-width: 900px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.7), inset 0 0 15px rgba(0,0,0,0.8), inset 0 2px 2px rgba(255,255,255,0.1);
            position: relative;
            border: 2px solid;
            border-image-slice: 1;
            border-image-source: linear-gradient(to bottom, #6b7280, #4b5563);
        }
        
        .sticky-filter-bar { position: sticky; bottom: 0; z-index: 40; background-color: #111827; background-image: linear-gradient(to top, rgba(17, 24, 39, 1) 50%, rgba(17, 24, 39, 0.9)); box-shadow: 0 -10px 20px rgba(0,0,0,0.5); border-top: 2px solid #374151; }
        #category-filter-nav, #flavor-filter-nav { display: flex; overflow-x: auto; -webkit-overflow-scrolling: touch; padding: 0.5rem 1rem; }
        #flavor-filter-nav { border-bottom: 1px solid #374151; padding-top: 0.25rem; padding-bottom: 0.25rem; }
        #category-filter-nav::-webkit-scrollbar, #flavor-filter-nav::-webkit-scrollbar { display: none; }
        #category-filter-nav, #flavor-filter-nav { -ms-overflow-style: none; scrollbar-width: none; }
        footer { padding-bottom: 120px; }

        .ingredient-btn.out-of-stock { opacity: 0.5; background-color: #374151; text-decoration: line-through; }
        .ingredient-btn.out-of-stock:hover { background-color: #4b5563; }

        /* --- STRENGTH METER & FLAVOR ICONS --- */
        .strength-meter, .flavor-icons { display: flex; justify-content: center; gap: 0.5rem; }
        .flavor-icons { height: 20px; }
        .strength-meter i, .flavor-icons i { font-size: 1.25rem; }
        .strength-meter .filled { color: #f59e0b; text-shadow: 0 0 5px #f59e0b; }
        .strength-meter .empty { color: #4b5563; opacity: 0.7; }
        .flavor-icons i { transition: transform 0.2s ease-in-out; }
        .flavor-icons i:hover { transform: scale(1.2); }
        .fa-candy-cane{color:#ffb8c1}.fa-lemon{color:#fde047}.fa-pepper-hot{color:#ef4444}.fa-seedling{color:#84cc16}.fa-cloud{color:#f1f5f9}.fa-mug-hot{color:#854d0e}.fa-coffee{color:#a16207}.fa-fan{color:#a855f7}.fa-star-of-life{color:#7dd3fc}.fa-bolt{color:#facc15}.fa-snowflake{color:#67e8f9}.fa-water{color:#38bdf8}.fa-umbrella-beach{color:#f97316}.fa-apple-whole{color:#dc2626}.fa-fist-raised{color:#b91c1c}.fa-wave-square{color:#60a5fa}.fa-leaf{color:#57534e}.fa-moon{color:#4338ca}.fa-cookie-bite{color:#d4a373}.fa-icicles{color:#e0f2fe}.fa-dumbbell{color:#6b7280}.fa-circle{color:#d1d5db}.fa-cube{color:#3730a3}.fa-wind{color:#9ca3af}.fa-cactus{color:#85a23d}.fa-circle-dot{color:#fed7aa}.fa-mortar-pestle{color:#c084fc}

        /* --- Navigation Arrows --- */
        .nav-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(17, 24, 39, 0.5);
            color: #d1d5db;
            border: 2px solid #4b5563;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 35;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease-in-out;
        }
        .nav-arrow:hover {
            background-color: rgba(245, 158, 11, 0.8);
            color: #111827;
            border-color: #f59e0b;
        }
        #arrow-left { left: 10px; }
        #arrow-right { right: 10px; }
        @media (min-width: 1280px) {
            #arrow-left { left: calc(50vw - 600px); }
            #arrow-right { right: calc(50vw - 600px); }
        }

    </style>
    
        html, body {
            height: 100%;
            overflow: hidden; /* Prevent body from scrolling */
        }
        body {
            margin: 0; 
            font-family: 'Roboto', sans-serif;
            background-color: #1a110a; 
            background-image: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.85)), url('https://www.transparenttextures.com/patterns/worn-dots.png');
            background-attachment: fixed;
        }

        #app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh; 
        }

        main {
            flex-grow: 1; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0; 
        }
        
        h2 {
            font-family: 'Black Ops One', cursive;
            text-shadow: 1px 1px 0 #000, 2px 2px 0 #333;
            letter-spacing: 0.05em;
        }
        .drink-card h3, .modal h2 {
            font-family: 'Rye', cursive;
            text-shadow: 2px 2px 0 #000;
            letter-spacing: normal;
        }
         .drink-card-front h3 {
            text-shadow: 1px 1px 0 #000, 0 0 8px currentColor; 
        }
        
        .font-condensed { font-family: 'Roboto Condensed', sans-serif; }
        .font-rye { font-family: 'Rye', cursive; line-height: 1.6; }
        .font-black-ops { font-family: 'Black Ops One', cursive; }
        .font-handwriting { font-family: 'Permanent Marker', cursive; }

        .recipe-list { list-style: none; padding-left: 0; line-height: 1.6; font-family: 'Roboto Condensed', sans-serif; letter-spacing: 0.02em; }
        .modal { transition: opacity 0.3s ease-in-out; }
        
        .drink-card { perspective: 1000px; background-color: transparent; cursor: pointer; }
        .drink-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5), 0 10px 20px rgba(0,0,0,0.7);
            border-radius: 0.5rem; 
        }
        .drink-card.is-flipped .drink-card-inner { transform: rotateY(180deg); }
        .drink-card-front, .drink-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            background-color: #1a202c;
            border: 1px solid #4b5563;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.7);
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            overflow: hidden; 
        }
        .drink-card-back { 
            transform: rotateY(180deg); 
            background-image: linear-gradient(to bottom right, #2d3748, #1a202c), url('https://www.transparenttextures.com/patterns/worn-dots.png');
        }
        .drink-card.is-active-card .drink-card-inner { box-shadow: 0 0 15px 4px #f59e0b, 0 10px 20px rgba(0,0,0,0.7); }

        #menu-grid {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scroll-padding: 1rem;
            -webkit-overflow-scrolling: touch;
            padding: 1rem;
            scrollbar-width: none; 
            flex-grow: 1;
        }
        #menu-grid::-webkit-scrollbar { display: none; }
        #menu-grid.hide-unavailable .is-unavailable { display: none; }
        
        #menu-grid > .drink-card { flex: 0 0 90%; scroll-snap-align: center; }
        @media (min-width: 768px) { #menu-grid > .drink-card { flex-basis: 45%; } }
        @media (min-width: 1024px) { #menu-grid > .drink-card { flex-basis: 31%; } }

        .filter-btn, .flavor-filter-btn {
            font-family: 'Roboto Condensed', sans-serif; font-weight: 700; text-transform: uppercase; background-color: #1a202c; border: 2px solid #111827;
            border-bottom-color: #4a5568; color: #a0aec0; padding: 0.25rem 0.75rem; border-radius: 0.375rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.6), 0 1px 1px rgba(255,255,255,0.1); transition: all 0.15s ease-out; flex-shrink: 0;
            font-size: 0.75rem;
        }
        .filter-btn:hover, .flavor-filter-btn:hover { background-color: #2d3748; color: #e2e8f0; }
        .filter-btn.active-filter, .flavor-filter-btn.active-filter {
            background-color: #f59e0b; color: #1a202c; border-color: #dd6b20; border-top-color: #f6ad55;
            transform: translateY(1px); box-shadow: inset 0 3px 6px rgba(0,0,0,0.4); text-shadow: 0 1px 1px rgba(255,255,255,0.2);
        }
        .filter-btn.active-filter i, .flavor-filter-btn.active-filter i { color: #1a202c !important; }
        .filter-btn i, .flavor-filter-btn i { transition: color 0.15s ease-out; }
        
        .sticky-filter-bar { 
            background-color: #111827; 
            background-image: linear-gradient(to top, rgba(17, 24, 39, 1) 50%, rgba(17, 24, 39, 0.9)); 
            position: relative;
            z-index: 40; 
            box-shadow: 0 -10px 20px rgba(0,0,0,0.5); 
            border-top: 2px solid #374151; 
            flex-shrink: 0;
        }
        
        #category-filter-nav, #flavor-filter-nav { 
            display: flex; overflow-x: auto; -webkit-overflow-scrolling: touch; 
            padding: 0.25rem 1rem; align-items: center; height: 45px; 
            flex-shrink: 0; box-sizing: border-box; 
        }
        #flavor-filter-nav { border-bottom: 1px solid #374151; }
        #category-filter-nav::-webkit-scrollbar, #flavor-filter-nav::-webkit-scrollbar { display: none; }
        #category-filter-nav, #flavor-filter-nav { -ms-overflow-style: none; scrollbar-width: none; }

        .drink-card.is-unavailable {
            opacity: 0.4; filter: grayscale(80%); pointer-events: none; position: relative;
        }
        .drink-card.is-unavailable::before {
            content: 'UNAVAILABLE'; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg); background-color: rgba(185, 28, 28, 0.8);
            color: white; padding: 0.5rem 1.5rem; border-radius: 0.25rem;
            font-family: 'Black Ops One', cursive; font-size: 1.5rem; z-index: 10;
            border: 2px solid white; text-shadow: 2px 2px 4px #000;
        }
        
        .nav-arrow {
            position: fixed; top: 50%; transform: translateY(-50%);
            background-color: rgba(17, 24, 39, 0.5); color: #d1d5db;
            border: 2px solid #4b5563; border-radius: 50%;
            width: 40px; height: 40px; font-size: 1.25rem; cursor: pointer;
            z-index: 35; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease-in-out;
        }
        .nav-arrow:hover { background-color: rgba(245, 158, 11, 0.8); color: #111827; border-color: #f59e0b; }
        #arrow-left { left: 5px; }
        #arrow-right { right: 5px; }
        @media (min-width: 1280px) {
            #arrow-left { left: calc(50vw - 620px); }
            #arrow-right { right: calc(50vw - 620px); }
        }
        
        #header-logo-container {
            position: relative;
            background-image: url('https://scontent-iad3-1.xx.fbcdn.net/v/t39.30808-6/560249362_1334414134750721_6442249990351217830_n.jpg?stp=cp6_dst-jpg_tt6&_nc_cat=101&ccb=1-7&_nc_sid=833d8c&_nc_ohc=CM3uAcZwDy0Q7kNvwH9N7J1&_nc_oc=Adm6pra2I-wIN54zlYEGN-q1sFOLdiKIZ7soVqhrp2gPTB4Mju67Q2FgLk0jjRLpvlg&_nc_zt=23&_nc_ht=scontent-iad3-1.xx&_nc_gid=DjeS81jUBoCZUFrHpc9egw&oh=00_Afcu7dpsQ4ErpnKzS14njbcjQ0neAcvcnI0k3pCVDbdJQg&oe=68EBA766');
            background-size: cover; background-position: left top; background-repeat: no-repeat;
            border-radius: 0.5rem; box-shadow: 0 8px 16px rgba(0,0,0,0.8);
            overflow: hidden; 
        }
        #header-logo-container::before {
            content: ''; position: absolute; inset: 0;
            background-color: rgba(0, 0, 0, 0.5); 
            box-shadow: inset 0 0 20px rgba(0,0,0,0.9);
            border: 2px solid #4b5563; border-radius: 0.5rem;
            outline: 2px solid rgba(245, 158, 11, 0.2); 
            outline-offset: -5px; 
            filter: drop-shadow(0 0 5px rgba(245, 158, 11, 0.3)); 
        }
        #header-logo-container h1 {
            position: relative; font-family: 'Black Ops One', cursive;
            font-size: 2.5rem; color: #f59e0b; 
            text-shadow: 4px 4px 8px rgba(0,0,0,0.9), 0 0 15px #f59e0b;
            letter-spacing: 0.1em; z-index: 10; line-height: 1; 
        }
        @media (max-width: 480px) { #header-logo-container h1 { font-size: 2rem; } }

        .review-quote {
            background-color: rgba(0,0,0,0.2); border-left: 4px solid #f59e0b;
            padding: 0.75rem; border-radius: 0 0.25rem 0.25rem 0; margin-bottom: 0.75rem;
        }
        
        /* Drink Finder Styles */
        #drink-finder-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 0.75rem;
        }
        .drink-finder-item {
            background-color: #2d3748; /* bg-gray-700 */
            border: 1px solid #4a5568; /* border-gray-600 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.75rem; /* p-3 */
            text-align: left;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .drink-finder-item:hover {
            background-color: #4a5568; /* bg-gray-600 */
            border-color: #f59e0b; /* border-amber-500 */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        .drink-finder-item-title {
            font-family: 'Roboto Condensed', sans-serif;
            font-weight: 700;
            color: #f59e0b; /* text-amber-500 */
            margin-bottom: 0.5rem; /* mb-2 */
            font-size: 0.875rem;
            line-height: 1.2;
        }
        .drink-finder-item-ingredients {
            list-style: none;
            padding-left: 0;
        }
        .drink-finder-item-ingredients li {
            margin-top: 0.375rem;
        }
        
        /* Bar Stock Interaction Styles */
        .stock-button {
            position: relative;
            padding-right: 2.25rem !important; /* pr-9 */
        }
        .stock-button .search-icon {
            position: absolute;
            right: 0.5rem; /* pr-2 */
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af; /* gray-400 */
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
            padding: 4px; /* for easier clicking */
        }
        .stock-button .search-icon:hover {
            color: #f59e0b; /* amber-500 */
            transform: translateY(-50%) scale(1.2);
        }

    </style>
</head>
<body class="text-gray-300">

<div id="app-container">
    <header class="container mx-auto px-4 pt-4 max-w-7xl flex-shrink-0">
        <div class="text-center z-40 bg-transparent">
            <div id="header-logo-container" class="h-24 md:h-28 w-full max-w-3xl mx-auto flex items-center justify-center">
                 <h1 class="drop-shadow-lg">NOMADS</h1>
            </div>
        </div>
        <div id="filter-status" class="text-center my-2"></div>
    </header>

    <main class="container mx-auto px-4 max-w-7xl relative">
        <div id="menu-grid" class="gap-4"></div>
    </main>
    
    <button id="arrow-left" class="nav-arrow"><i class="fas fa-chevron-left"></i></button>
    <button id="arrow-right" class="nav-arrow"><i class="fas fa-chevron-right"></i></button>
    
    <div class="sticky-filter-bar">
        <nav id="flavor-filter-nav" class="gap-2"></nav>
        <nav id="category-filter-nav" class="gap-2">
            <p class="font-rye text-sm text-gray-400 mr-4 flex-shrink-0">Bikers Welcome</p>
            <button id="bar-stock-btn" class="filter-btn"><i class="fas fa-motorcycle mr-2 text-gray-400"></i>Bar Stock</button>
            <div class="h-6 border-l border-gray-600 mx-2 flex-shrink-0"></div>
            <div class="flex items-center space-x-2 flex-shrink-0" title="Toggle visibility of out-of-stock drinks">
                <label for="hide-unavailable-toggle" class="text-xs font-condensed uppercase text-gray-400">HIDE OOS</label>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="hide-unavailable-toggle" class="sr-only peer">
                    <div class="w-9 h-5 bg-gray-600 rounded-full peer peer-focus:ring-2 peer-focus:ring-amber-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-amber-600"></div>
                </label>
            </div>
            <button id="clear-filters-btn" class="filter-btn" title="Clear all category and flavor filters"><i class="fas fa-times-circle mr-2 text-gray-400"></i>Clear</button>
            <div class="h-6 border-l border-gray-600 mx-2 flex-shrink-0"></div>
            <button data-category="all" class="filter-btn active-filter">All</button>
            <button data-category="signature" class="filter-btn"><i class="fas fa-skull mr-2 text-amber-400"></i>Signature</button>
            <button data-category="classics" class="filter-btn"><i class="fas fa-trophy mr-2 text-yellow-500"></i>Classics</button>
            <button data-category="whiskey" class="filter-btn"><i class="fas fa-whiskey-glass mr-2 text-orange-400"></i>Whiskey</button>
            <button data-category="vodka" class="filter-btn"><i class="fas fa-skull-crossbones mr-2 text-blue-300"></i>Vodka</button>
            <button data-category="gin" class="filter-btn"><i class="fas fa-leaf mr-2 text-green-400"></i>Gin</button>
            <button data-category="rum" class="filter-btn"><i class="fas fa-anchor mr-2 text-yellow-800"></i>Rum</button>
            <button data-category="dogs" class="filter-btn"><i class="fas fa-dog mr-2 text-stone-500"></i>Dogs</button>
            <button data-category="tequila" class="filter-btn"><i class="fas fa-hat-cowboy-side mr-2 text-yellow-600"></i>Tequila</button>
            <button data-category="schnapps" class="filter-btn"><i class="fas fa-mortar-pestle mr-2 text-purple-400"></i>Liqueurs</button>
        </nav>
    </div>
</div>

    
<div id="bar-stock-modal" class="modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden opacity-0 z-50">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[95vh] flex flex-col border border-gray-600">
            <div class="p-6 border-b border-gray-600">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-white">Bar Stock</h2>
                    <div class="flex items-center gap-4">
                        <button id="reset-stock-btn" class="text-sm text-amber-500 hover:text-amber-300 transition-colors">Reset Stock</button>
                        <button class="close-modal-btn text-gray-400 hover:text-white text-3xl">&times;</button>
                    </div>
                </div>
            </div>
            <div id="bar-stock-content" class="p-6 text-gray-300 overflow-y-auto">
                <div id="drink-finder-section" class="mb-6">
                    <h2 class="text-xl text-amber-400 mb-2">Drink Finder</h2>
                    <p class="text-sm text-gray-400 mb-3">Based on your current stock, you can make these. Search by name or ingredient.</p>
                    <input type="text" id="drink-finder-input" placeholder="Search makeable drinks..." class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-amber-500">
                    <div id="drink-finder-results" class="mt-3 max-h-60 overflow-y-auto space-y-1 p-1"></div>
                </div>
                <div class="border-t-2 border-dashed border-gray-600 my-6"></div>
                <div><h2 class="text-xl text-green-400 mb-4">IN STOCK</h2><div id="in-stock-lists"></div></div>
                <div class="border-t-2 border-dashed border-gray-600 my-6"></div>
        <div id="out-of-stock-lists"></div>
            </div>
        </div>
    </div>

    <script>
        const cocktails = [
            // Signature Drinks
            { name: "Redheaded Trouble", category: ["signature", "schnapps"], flavorProfile: "Herbal & Peach", recipe: [{ name: "Jägermeister", amount: "1.5 oz" }, { name: "Peach Schnapps", amount: "1 oz" }, { name: "Orange Juice", amount: "Top Off" }], story: "A redhead named Roxy used to ride a custom Triumph. She'd order three of these at a time: one for her, one for 'the road,' and one for 'the trouble she was about to cause.' Last we saw her, she was out-running a sheriff on a gravel road, laughing the whole damn way.", reviews: [{reviewer: "Roxy 'The Rebel' Malone", text: "This drink is as fiery as its namesake. A perfect start to a wild night."}, {reviewer: "Road Dog Ricky", text: "Smooth, sweet, but with that herbal kick that sneaks up on you. Just like Roxy did."}] },
            { name: "Caramel Apple Cruiser", category: ["signature", "schnapps"], flavorProfile: "Sweet, Tart & Spicy", recipe: [{ name: "Butterscotch Schnapps", amount: "1.5 oz" }, { name: "Apple Pucker", amount: "1.5 oz" }, { name: "Angostura Bitters", amount: "2 Dashes" }, { name: "Ginger Ale", amount: "Top Off" }], story: "This is for the guy on the candy-apple red cruiser that looks all show, no go. Then he takes it to the drag strip and leaves everyone in his dust. This drink is the same - looks innocent, but that spicy kick from the bitters will get you from zero to sixty before you know it.", reviews: [{reviewer: "Dragstrip Dale", text: "Thought this was gonna be some candy drink. That spicy finish straightened me right out. Respect."}, {reviewer: "Greaser Gus", text: "Tastes like winning a bet you were supposed to lose. Deceptively good."}] },
            { name: "Irish Russian", category: ["signature", "vodka", "schnapps"], flavorProfile: "Creamy & Rich Coffee", recipe: [{ name: "Ketel One Vodka", amount: "1.5 oz" }, { name: "Kahlúa", amount: "1 oz" }, { name: "Baileys Irish Cream", amount: "1 oz" }, { name: "Simple Syrup", amount: "0.75 oz" }, { name: "Club Soda", amount: "Top Off" }], story: "We invented this for a biker from Boston who couldn't decide between his two heritages. He'd slam one down and say it was for 'the fightin' Irish and the cold-hearted Russian' in him. Said it was the only way to get them to agree on anything.", reviews: [{reviewer: "Boston Mike", text: "This one's got the punch of a bare-knuckle boxer and the smoothness of a brand new highway. Perfect."}, {reviewer: "Hammerin' Helen", text: "It's like a shot of coffee and a shot of courage all in one. Gets you ready for the long haul."}] },
            { name: "Purple Hooter", category: ["signature", "vodka", "schnapps"], flavorProfile: "Sweet & Raspberry & Floral", recipe: [{ name: "Ketel One Vodka", amount: "2 oz" }, { name: "Raspberry Schnapps", amount: "1.25 oz" }, { name: "Peychaud's Bitters", amount: "2 Dashes" }, { name: "Lime Juice", amount: "1 oz" }, { name: "Club Soda", amount: "Top Off" }], story: "We only serve this after we've taken your keys. A group of riders came through once, had a few of these, and tried to pay with a live armadillo. They seemed to think it was a good idea at the time. The armadillo, and the sheriff, disagreed. The bitters are a reminder of that bitter regret.", reviews: [{reviewer: "Whiskey Wanda", text: "Don't let the color fool you, this ain't no sissy drink. It'll have you telling stories for years."}, {reviewer: "Wild Bill", text: "Tastes like a good time that you might not remember tomorrow. Worth it."}] },
            { name: "The Ghost Rider", category: ["signature", "tequila", "schnapps"], flavorProfile: "Herbal Anise & Sharp", recipe: [{ name: "Pernod", amount: "1.25 oz" }, { name: "Jose Cuervo Silver Tequila", amount: "2 oz" }, { name: "Lime Juice", amount: "1 oz" }, { name: "Club Soda", amount: "Top Off" }], story: "Named for a mysterious rider on a flaming bike who only ever ordered one thing. It's sharp, herbal, and leaves an otherworldly impression, just like him.", reviews: [{reviewer: "Shadow Sam", text: "This drink has a kick like a shovelhead on a cold morning. Not for the faint of heart."}, {reviewer: "Mystic Mae", text: "Tastes like lightning in a glass. Woke me up better than a straight pipe exhaust."}] },
            { name: "The Phantom Shift", category: ["signature", "gin", "schnapps"], flavorProfile: "Herbal Anise & Crisp", recipe: [{ name: "Pernod", amount: "1.25 oz" }, { name: "Tanqueray Gin", amount: "2 oz" }, { name: "Lime Juice", amount: "1 oz" }, { name: "Tonic Water", amount: "Top Off" }], story: "They say if you're on a lonely road at midnight, you can sometimes feel a bike shift gears right next to you, even when no one's there. This drink is for that feeling—anise-forward, sharp, and gone before you can place it. It's the taste of a legend riding alongside you.", reviews: [{reviewer: "Road Ghost Riley", text: "Clean, sharp, and unforgettable. It's the taste of a mystery you don't want to solve."}, {reviewer: "Midnight Mark", text: "Had one of these and swore I could hear my old panhead whispering to me. Good stuff."}] },
            { name: "The White Liner", category: ["signature", "gin", "schnapps"], flavorProfile: "Clean, Crisp & Floral", recipe: [{ name: "Tanqueray Gin", amount: "2 oz" }, { name: "St-Germain", amount: "1.25 oz" }, { name: "Lemon Juice", amount: "1 oz" }, { name: "Orange Bitters", amount: "2 Dashes" }, { name: "Club Soda", amount: "Top Off" }], story: "For the rider who stays true to their path. This drink is just as clean and direct—a crisp, floral shot of gin and elderflower that keeps you on the straight and narrow. No detours, no distractions, just the pure taste of the open road ahead.", reviews: [{reviewer: "Straight-Edge Steve", text: "Smooth, straight, and no B.S. Just like the line on the highway. My new go-to."}, {reviewer: "Navigator Nancy", text: "A damn fine drink. Crisp as a fall morning ride through the mountains."}] },
            { name: "The Blacktop Sunset", category: ["signature", "whiskey"], flavorProfile: "Sweet & Spicy", recipe: [{ name: "Jameson Irish Whiskey", amount: "1.5 oz" }, { name: "Southern Comfort", amount: "1.5 oz" }, { name: "Lime Juice", amount: "1 oz" }, { name: "Angostura Bitters", amount: "2 Dashes" }, { name: "Ginger Ale", amount: "Top Off" }], story: "For that moment the sun dips below the horizon and paints the blacktop gold. It's the taste of a successful haul—smooth whiskey, the sweet memory of the day, and a spicy kick to remind you that tomorrow's another ride.", reviews: [{reviewer: "Sunset Sally", text: "The perfect drink to end a long day's ride. Got the right amount of sweetness and a kick to keep you honest."}, {reviewer: "Asphalt Andy", text: "This tastes like freedom. Nothing better after putting the kickstand down."}] },
            { name: "Storm Rider", category: ["signature", "rum"], flavorProfile: "Dark, Spiced & Strong", recipe: [{ name: "Kraken Black Spiced Rum", amount: "2 oz" }, { name: "Lime Juice", amount: "1.25 oz" }, { name: "Angostura Bitters", amount: "2 Dashes" }, { name: "Ginger Ale", amount: "Top Off" }], story: "This one's for the riders who don't pull over when the sky turns black. They lean into the wind and chase the storm. It’s dark, spicy, and has a kick that’ll rattle your bones.", reviews: [{reviewer: "Thunderbolt Ted", text: "Dark and mean, just like the storm clouds it's named after. This'll put hair on your chest."}, {reviewer: "Rainmaker Rita", text: "Had one of these during a downpour. Felt like I could ride through anything. A true rider's drink."}] },
            // Dogs
            { name: "The Bulldog", category: ["dogs", "whiskey"], flavorProfile: "Bold & Citrus", recipe: [{ name: "Maker's Mark", amount: "2 oz" }, { name: "Simple Syrup", amount: "0.5 oz" }, { name: "Angostura Bitters", amount: "2 Dashes" }, { name: "Orange Juice", amount: "1 oz" }], story: "Sturdy, dependable, and packs a surprising punch. This drink is for the old-timer in the corner with a bike that's more rust than chrome, but you know it'll start on the first kick, every single time. It's a classic, loyal companion.", reviews: [{reviewer: "Ol' Reliable Ron", text: "This is a proper drink. Strong, straightforward, with a bit of a bite. Just like my old panhead."}, {reviewer: "Sarge", text: "Reminds me of my first bike. Not flashy, but it never let me down. Solid."}] },
            { name: "The Greyhound", category: ["dogs", "vodka"], flavorProfile: "Crisp & Lime", recipe: [{ name: "Ketel One Vodka", amount: "2 oz" }, { name: "Lime Juice", amount: "1 oz" }, { name: "Ginger Ale", amount: "Top Off" }], story: "For the rider on the sleek sport bike that vanishes down the highway before you can even get a good look. It's fast, sharp, and clean. One minute it's there, the next it's just a memory and the lingering taste of lime.", reviews: [{reviewer: "Speed Demon Sally", text: "Clean, fast, and refreshing. The perfect drink when you want to feel the wind in your hair."}, {reviewer: "Needlepoint Nick", text: "This thing is dangerously smooth. It'll get you up to speed in no time."}] },
            { name: "The Junkyard Dog", category: ["dogs", "schnapps"], flavorProfile: "Herbal & Sweet", recipe: [{ name: "Jägermeister", amount: "1 oz" }, { name: "Southern Comfort", amount: "1 oz" }, { name: "Lime Juice", amount: "0.5 oz" }], story: "This drink is like a bike built from spare parts—it doesn't look like it should work, but somehow it runs like a beast. A little bit of this, a little bit of that, and a whole lot of attitude. It's surprisingly good, and it'll bite you if you don't respect it.", reviews: [{reviewer: "Scrapmetal Steve", text: "I didn't think these things went together, but damn if it ain't good. It's got character."}, {reviewer: "Grease Monkey Gina", text: "A perfect mix of mean and sweet. My new favorite for when I'm cleaning parts."}] },
            // Classics
            { name: "Old Fashioned", category: ["classics", "whiskey"], flavorProfile: "Bold, Sweet & Bitter", recipe: [{ name: "Maker's Mark", amount: "2 oz" }, { name: "Simple Syrup", amount: "0.75 oz" }, { name: "Orange Bitters", amount: "2 Dashes" }, { name: "Cherry Garnish", amount: "Garnish" }, { name: "Club Soda", amount: "Splash" }], story: "Old Man Hemlock only drinks this. He says, 'You don't need a thousand new parts to make a bike run true, and you don't need a thousand ingredients for a real drink.' It’s a testament to doing things the right way.", reviews: [{reviewer: "Old Man Hemlock", text: "They don't make 'em like they used to, but they still make this. Thank God. A true classic."}, {reviewer: "Wise Wanda", text: "This is what a real drink tastes like. No frills, all business. Just like my ride."}] },
            { name: "Moscow Mule", category: ["classics", "vodka"], flavorProfile: "Spicy Ginger & Lime", recipe: [{ name: "Ketel One Vodka", amount: "2 oz" }, { name: "Lime Juice", amount: "1 oz" }, { name: "Angostura Bitters", amount: "2 Dashes" }, { name: "Ginger Ale", amount: "Top Off" }], story: "A prospect once complained his bike was kicking back on him. The club president handed him one of these and said, 'Now you've got something that kicks back even harder. One of 'em you'll learn to handle.' The kid learned to respect both.", reviews: [{reviewer: "Kickstart Kenny", text: "That ginger kick is no joke. Wakes you up and gets you ready to ride."}, {reviewer: "Road Queen Ruby", text: "Refreshing as hell after a hot day on the asphalt. The only kickback I actually enjoy."}] },
            { name: "Long Island Iced Tea", category: ["classics", "vodka", "gin", "rum", "tequila", "schnapps"], flavorProfile: "Strong, Sweet & Sour", recipe: [{ name: "Ketel One Vodka", amount: "0.75 oz" }, { name: "Tanqueray Gin", amount: "0.75 oz" }, { name: "Rum", amount: "0.75 oz" }, { name: "Jose Cuervo Silver Tequila", amount: "0.75 oz" }, { name: "Triple Sec", amount: "0.75 oz" }, { name: "Lemon Juice", amount: "1 oz" }, { name: "Cola", amount: "Top Off" }], story: "A guy once bet he could build an engine after drinking three of these. He didn't build an engine, but he did try to use a jukebox as a telephone and offered to trade his leather jacket for a half-eaten plate of nachos. This drink has a way of rewriting your priorities.", reviews: [{reviewer: "Party Animal Pete", text: "This ain't a drink, it's a destination. One of these and you're feeling no pain."}, {reviewer: "Loose Lips Lucy", text: "Rides smooth, hits hard. Handle with care, or you'll end up trading your jacket for nachos too."}] },
            { name: "Margarita", category: ["classics", "tequila"], flavorProfile: "Tart & Lime & Salty", recipe: [{ name: "Jose Cuervo Silver Tequila", amount: "2 oz"}, { name: "Triple Sec", amount: "1 oz"}, { name: "Lime Juice", amount: "1 oz"}, { name: "Salt Rim", amount: "Garnish"}], story: "For when the road gets hot and dusty. This drink is a sharp, cool relief. It's the taste of crossing the border after a long, hard ride. Freedom in a glass.", reviews: [{reviewer: "El Zorro", text: "The only thing better than the wind in your face is the salt on the rim of this glass. ¡Salud!"}, {reviewer: "Dusty Boots", text: "Cuts through the dust of the road like nothing else. A perfect end to a desert run."}] },
            { name: "Dark 'n' Stormy", category: ["rum", "classics"], flavorProfile: "Spicy Ginger & Lime", recipe: [{ name: "Kraken Black Spiced Rum", amount: "2 oz"}, { name: "Ginger Ale", amount: "4 oz"}, { name: "Lime Juice", amount: "0.5 oz"}], story: "Named for a sky that every rider knows. It's dark, moody, and it's got a kick of lightning from the ginger. This is what you drink when you can hear the thunder rolling in.", reviews: [{reviewer: "Thunder", text: "Tastes like the calm before the storm. And the storm itself. Perfect."}, {reviewer: "Lightning", text: "That ginger spice is electric. My new favorite."}] }
        ];

  const menuGrid = document.getElementById('menu-grid');
        const allModals = document.querySelectorAll('.modal');
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        const imageApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

        let activeFilters = { categories: new Set(), flavors: new Set() };
        const generatedLogosCache = {};
        const generatedDrinkImagesCache = {};

        const logoGenerationQueue = [];
        let activeLogoGenerations = 0;
        const MAX_CONCURRENT_LOGOS = 4;

        ];
        cocktails.forEach((cocktail, index) => {
            cocktail.image = drinkImages[index % drinkImages.length];
        });

        const menuGrid = document.getElementById('menu-grid');
        const allModals = document.querySelectorAll('.modal');
        let activeFilters = { category: 'all', flavor: null }; 
        let hideUnavailable = false;
        const HIDE_UNAVAILABLE_KEY = 'nomads_hide_unavailable_v1';

        const titleFonts = ['Rye', 'Bangers', 'Creepster', 'Metal Mania', 'Nosifier', 'UnifrakturMaguntia'];
        const categoryIconMap={"signature":{class:"fa-skull",color:"text-amber-400"},"classics":{class:"fa-trophy",color:"text-yellow-500"},"whiskey":{class:"fa-whiskey-glass",color:"text-orange-400"},"vodka":{class:"fa-skull-crossbones",color:"text-blue-300"},"gin":{class:"fa-leaf",color:"text-green-400"},"rum":{class:"fa-anchor",color:"text-yellow-800"},"dogs":{class:"fa-dog",color:"text-stone-500"},"tequila":{class:"fa-hat-cowboy-side",color:"text-yellow-600"},"schnapps":{class:"fa-mortar-pestle",color:"text-purple-400"}};
        const flavorInfoMap = { "Sweet": { icon: "fa-candy-cane", color: "text-pink-300" }, "Tart": { icon: "fa-lemon", color: "text-yellow-300" }, "Spicy": { icon: "fa-pepper-hot", color: "text-red-500" }, "Herbal": { icon: "fa-seedling", color: "text-lime-400" }, "Creamy": { icon: "fa-cloud", color: "text-slate-200" }, "Rich": { icon: "fa-mug-hot", color: "text-amber-800" }, "Coffee": { icon: "fa-coffee", color: "text-yellow-900" }, "Floral": { icon: "fa-fan", color: "text-purple-400" }, "Anise": { icon: "fa-star-of-life", color: "text-sky-300" }, "Sharp": { icon: "fa-bolt", color: "text-yellow-400" }, "Crisp": { icon: "fa-snowflake", color: "text-cyan-300" }, "Clean": { icon: "fa-water", color: "text-blue-400" }, "Bold": { icon: "fa-fist-raised", color: "text-red-700" }, "Bitter": { icon: "fa-leaf", color: "text-stone-500" }, "Dark": { icon: "fa-moon", color: "text-indigo-400" }, "Salty": { icon: "fa-icicles", color: "text-sky-200" }, "Sour": { icon: "fa-lemon", color: "text-lime-300" }, "Strong": { icon: "fa-dumbbell", color: "text-gray-500" }, "Spiced": { icon: "fa-pepper-hot", color: "text-orange-500" }, "Lime": { icon: "fa-lemon", color: "text-lime-400" }, "Ginger": { icon: "fa-mortar-pestle", color: "text-fuchsia-400" }, "Peach": { icon: "fa-apple-whole", color: "text-orange-400" }, "Raspberry": { icon: "fa-circle", color: "text-rose-500" }, "Cranberry": { icon: "fa-circle", color: "text-red-600" }, "Fruity": { icon: "fa-apple-whole", color: "text-red-400"}, "Citrus": { icon: "fa-lemon", color: "text-yellow-400"}, "Nutty": { icon: "fa-cookie-bite", color: "text-yellow-800"}, "Bubbly": { icon: "fa-wine-glass", color: "text-purple-300"}, "Berry": { icon: "fa-leaf", color: "text-red-500"}, "Grapefruit": { icon: "fa-lemon", color: "text-pink-400"}, "Mint": { icon: "fa-leaf", color: "text-green-500"} };
        
        function getIngredientInfo(ingredientName) {
            const lowerIng = ingredientName.toLowerCase();
            if (lowerIng.includes('vodka')) return { icon: 'fas fa-skull-crossbones', color: 'text-blue-300' };
            if (['whiskey', 'bourbon', 'comfort', 'cognac'].some(s => lowerIng.includes(s))) return { icon: 'fas fa-whiskey-glass', color: 'text-orange-400' };
            if (lowerIng.includes('gin')) return { icon: 'fas fa-leaf', color: 'text-green-400' };
            if (lowerIng.includes('rum')) return { icon: 'fas fa-anchor', color: 'text-yellow-800' };
            if (lowerIng.includes('tequila')) return { icon: 'fas fa-hat-cowboy-side', color: 'text-yellow-600' };
            if (['schnapps', 'pucker', 'jäger', 'liqueur', 'irish cream', 'pernod', 'kahlúa', 'st-germain', 'triple sec', 'amaretto', 'campari', 'chambord'].some(l => lowerIng.includes(l))) return { icon: 'fas fa-mortar-pestle', color: 'text-purple-400' };
            if (lowerIng.includes('bitters')) return { icon: 'fas fa-tint', color: 'text-red-500' };
            if (lowerIng.includes('orange')) return { icon: 'fas fa-lemon', color: 'text-orange-500' };
            if (['lime', 'lemon'].some(l => lowerIng.includes(l))) return { icon: 'fas fa-lemon', color: 'text-yellow-300' };
            if (lowerIng.includes('cranberry')) return { icon: 'fas fa-lemon', color: 'text-red-400' };
            if (['soda', 'tonic', 'ale', 'cola', 'champagne', 'vermouth'].some(m => lowerIng.includes(m))) return { icon: 'fas fa-faucet', color: 'text-gray-400' };
            return { icon: 'fas fa-circle-question', color: 'text-gray-400' };
        }
        
        function displayMenuItems(items) {
            items.sort((a, b) => a.name.localeCompare(b.name));
            menuGrid.innerHTML = items.length === 0 ? `<div class="text-center text-gray-400 italic w-full self-center">No drinks match the current filters.</div>` : items.map((item, index) => {
                const titleFont = titleFonts[index % titleFonts.length];

                const recipeHtml = item.recipe.map(ing => {
                    const ingInfo = getIngredientInfo(ing.name);
                    return `<li class="flex items-center text-sm justify-between">
                                <div class="flex items-center">
                                    <i class="${ingInfo.icon} ${ingInfo.color} w-6 text-center mr-2"></i>
                                    <span>${ing.name}</span>
                                </div>
                                <span class="font-bold text-gray-400">${ing.amount}</span>
                            </li>`;
                }).join('');
                
                const reviewsHtml = item.reviews.map(review => `
                    <div class="review-quote">
                        <p class="font-handwriting text-lg text-gray-300 mb-1 leading-tight">"${review.text}"</p>
                        <p class="text-right font-handwriting text-base text-gray-400 opacity-80">- ${review.reviewer}</p>
                    </div>`).join('');
                
                const isAvailable = isCocktailMakeable(item);
                const unavailableClass = isAvailable ? '' : 'is-unavailable';
                
                const nameColorClass = getIngredientInfo(item.recipe[0].name).color;
                const backTitleHtml = `<h3 class="text-2xl ${nameColorClass} text-center" style="font-family: 'Rye', cursive; line-height: 1.2; text-shadow: 1px 1px 0 #000;">${item.name}</h3>`;


                return `
                    <div data-name="${item.name}" class="drink-card ${unavailableClass}">
                        <div class="drink-card-inner">
                            <div class="drink-card-front p-4" style="background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.6), rgba(0,0,0,0.8)), url('${item.image}'); background-size: cover; background-position: center;">
                                <div class="flex-shrink-0 text-center mb-2">
                                     <h3 class="text-3xl text-white" style="font-family: '${titleFont}', cursive; line-height: 1.2; text-shadow: 2px 2px 0px rgba(0,0,0,0.7), 0 0 15px rgba(0,0,0,1);">${item.name}</h3>
                                </div>
                                <div class="flex-grow overflow-y-auto min-h-0 bg-black/40 p-3 rounded-lg border border-gray-700/50">
                                    <h4 class="font-black-ops text-amber-500 font-bold mb-2 text-sm uppercase tracking-wider">Recipe Specs:</h4>
                                    <ul class="recipe-list text-gray-200 space-y-2">${recipeHtml}</ul>
                                </div>
                                <div class="flex-shrink-0 text-center text-xs text-gray-400 mt-2 font-rye">
                                    Click for Story & Notes
                                </div>
                            </div>
                            <div class="drink-card-back">
                                <div class="overflow-y-auto h-full p-4">
                                     <div class="mb-4">${backTitleHtml}</div>
                                    <div class="bg-black/20 p-3 rounded-md border border-gray-700 mb-4">
                                        <h4 class="font-black-ops text-amber-500 font-bold mb-2 text-sm uppercase tracking-wider">Logbook Entry:</h4>
                                        <p class="font-handwriting text-lg text-gray-300 leading-tight">"${item.story}"</p>
                                    </div>
                                    <h4 class="font-black-ops text-amber-500 font-bold mb-2 mt-4 text-sm uppercase tracking-wider">Field Notes:</h4>
                                    ${reviewsHtml}
                                </div>
                            </div>
                        </div>
                    </div>`;
            }).join('');
            setupCardGlowObserver();
        }

        function openModal(modal) { modal.classList.remove('hidden'); setTimeout(() => modal.classList.remove('opacity-0'), 10); renderDrinkFinderResults(); }
        function closeModal(modal) { modal.classList.add('opacity-0'); setTimeout(() => modal.classList.add('hidden'), 300); }
        
        function clearAllFilters() {
            activeFilters = { category: 'all', flavor: null };
            document.querySelectorAll('#category-filter-nav .filter-btn').forEach(btn => btn.classList.remove('active-filter'));
            document.querySelector('#category-filter-nav .filter-btn[data-category="all"]').classList.add('active-filter');
            document.querySelectorAll('#flavor-filter-nav .flavor-filter-btn').forEach(btn => btn.classList.remove('active-filter'));
            applyAllFilters();
        }

        function applyAllFilters() {
            let filtered = [...cocktails];
            if (activeFilters.category !== 'all') {
                filtered = filtered.filter(item => item.category.includes(activeFilters.category));
            }
            if (activeFilters.flavor) {
                filtered = filtered.filter(item => item.flavorProfile.split(/&|,/).map(f => f.trim()).includes(activeFilters.flavor));
            }
            displayMenuItems(filtered);
            updateFilterStatus();
        }

        function updateFilterStatus() {
            const filterStatus = document.getElementById('filter-status');
            const filtersApplied = [];
            if(activeFilters.category !== 'all') filtersApplied.push(`Category: <strong>${activeFilters.category}</strong>`);
            if(activeFilters.flavor) filtersApplied.push(`Flavor: <strong>${activeFilters.flavor}</strong>`);
            filterStatus.innerHTML = filtersApplied.length > 0 ? `<div class="inline-block bg-gray-900/50 border border-amber-600 rounded-lg px-3 py-1 text-xs">Filtering by: ${filtersApplied.join(' & ')}</div>` : '';
        }
        
        let cardObserver;
        function setupCardGlowObserver() {
            if (cardObserver) cardObserver.disconnect();
            cardObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !entry.target.classList.contains('is-unavailable')) {
                        document.querySelectorAll('.is-active-card').forEach(c => c.classList.remove('is-active-card'));
                        entry.target.classList.add('is-active-card');
                    }
                });
            }, { root: menuGrid, rootMargin: '0px', threshold: 0.6 });
            document.querySelectorAll('#menu-grid .drink-card').forEach(card => cardObserver.observe(card));
        }
        
        function initializeApp() {
            initializeBarStock(); 
            displayMenuItems(cocktails);
            const allFlavors = new Set(cocktails.flatMap(c => c.flavorProfile.split(/&|,/).map(f => f.trim())));
            const flavorFilterNav = document.getElementById('flavor-filter-nav');
            [...allFlavors].sort().forEach(flavor => {
                const btn = document.createElement('button');
                btn.className = 'flavor-filter-btn';
                btn.dataset.flavor = flavor;
                const info = flavorInfoMap[flavor] || { icon: 'fa-question-circle' };
                btn.innerHTML = `<i class="fas ${info.icon} mr-2"></i>${flavor}`;
                flavorFilterNav.appendChild(btn);
            });
        
            document.getElementById('category-filter-nav').addEventListener('click', (e) => {
                const target = e.target.closest('.filter-btn');
                if (!target || !target.dataset.category) return;
                activeFilters.category = (activeFilters.category === target.dataset.category && target.dataset.category !== 'all') ? 'all' : target.dataset.category;
                document.querySelectorAll('#category-filter-nav .filter-btn').forEach(btn => btn.classList.toggle('active-filter', btn.dataset.category === activeFilters.category));
                applyAllFilters();
            });

            document.getElementById('flavor-filter-nav').addEventListener('click', e => {
                const target = e.target.closest('.flavor-filter-btn');
                if (!target || !target.dataset.flavor) return;
                if (activeFilters.flavor === target.dataset.flavor) {
                    activeFilters.flavor = null;
                    target.classList.remove('active-filter');
                } else {
                    document.querySelectorAll('#flavor-filter-nav .flavor-filter-btn').forEach(btn => btn.classList.remove('active-filter'));
                    target.classList.add('active-filter');
                    activeFilters.flavor = target.dataset.flavor;
                }
                applyAllFilters();
            });

            menuGrid.addEventListener('click', e => {
                const card = e.target.closest('.drink-card');
                if (card) {
                    card.querySelectorAll('.overflow-y-auto').forEach(el => el.scrollTop = 0);
                    card.classList.toggle('is-flipped');
                }
            });

            document.getElementById('arrow-right').addEventListener('click', () => menuGrid.scrollBy({ left: (menuGrid.querySelector('.drink-card')?.offsetWidth || 300) + 16, behavior: 'smooth' }));
            document.getElementById('arrow-left').addEventListener('click', () => menuGrid.scrollBy({ left: -((menuGrid.querySelector('.drink-card')?.offsetWidth || 300) + 16), behavior: 'smooth' }));
            document.getElementById('bar-stock-btn').addEventListener('click', () => openModal(document.getElementById('bar-stock-modal')));
            document.getElementById('reset-stock-btn').addEventListener('click', resetBarStock);
            allModals.forEach(modal => modal.addEventListener('click', e => { if (e.target === modal || e.target.closest('.close-modal-btn')) closeModal(modal); }));

            document.getElementById('clear-filters-btn').addEventListener('click', clearAllFilters);

            const hideUnavailableToggle = document.getElementById('hide-unavailable-toggle');
            if (storageAvailable) {
                const savedPref = localStorage.getItem(HIDE_UNAVAILABLE_KEY);
                hideUnavailable = savedPref === 'true';
                hideUnavailableToggle.checked = hideUnavailable;
                if (hideUnavailable) menuGrid.classList.add('hide-unavailable');
            }
            hideUnavailableToggle.addEventListener('change', () => {
                hideUnavailable = hideUnavailableToggle.checked;
                menuGrid.classList.toggle('hide-unavailable', hideUnavailable);
                if (storageAvailable) localStorage.setItem(HIDE_UNAVAILABLE_KEY, hideUnavailable);
            });
        }

        // --- ROBUST BAR STOCK LOGIC ---
        let barStock = {};
        const STOCK_STORAGE_KEY = 'nomads_bar_stock_v3';
        function isLocalStorageAvailable() { try { const x = '__storage_test__'; localStorage.setItem(x, x); localStorage.removeItem(x); return true; } catch(e) { return false; } }
        const storageAvailable = isLocalStorageAvailable();
        function saveStock(stockData) { if (storageAvailable) try { localStorage.setItem(STOCK_STORAGE_KEY, JSON.stringify(stockData)); } catch (e) { console.error("Failed to save stock", e); } }
        function loadStock() { if (!storageAvailable) return {}; try { const rawData = localStorage.getItem(STOCK_STORAGE_KEY); if (rawData) { const parsed = JSON.parse(rawData); if (typeof parsed === 'object' && parsed !== null) return parsed; } } catch (e) { if(storageAvailable) try { localStorage.removeItem(STOCK_STORAGE_KEY); } catch(r_e) {} } return {}; }
        
        function initializeBarStock() {
            barStock = loadStock();
            const allIngredients = new Set(cocktails.flatMap(c => c.recipe.map(ing => ing.name)));
            let hasChanged = false;
            allIngredients.forEach(ingName => { if (barStock[ingName] === undefined) { barStock[ingName] = true; hasChanged = true; } });
            if (hasChanged) saveStock(barStock);
            renderBarStockModal();
        }

        function categorizeIngredient(ing) { const l = ing.toLowerCase(); if (['vodka','gin','whiskey','rum','tequila', 'cognac'].some(s=>l.includes(s))) return 'Spirits'; if (['schnapps','liqueur','kahlúa','pernod','st-germain', 'amaretto', 'campari', 'chambord'].some(s=>l.includes(s))) return 'Liqueurs'; if (['juice','soda','tonic','ale','cola','syrup', 'champagne', 'vermouth'].some(s=>l.includes(s))) return 'Mixers'; return 'Other'; }
        
        function renderBarStockModal() {
            const inStockEl = document.getElementById('in-stock-lists');
            const outOfStockEl = document.getElementById('out-of-stock-lists');
            inStockEl.innerHTML = ''; outOfStockEl.innerHTML = '';
            const categorized = {};
            for (const ing in barStock) { const cat = categorizeIngredient(ing); if (!categorized[cat]) categorized[cat] = []; categorized[cat].push(ing); }
            const renderCategory = (container, catName, ings) => {
                if (ings.length === 0) return;
                const btnHTML = ings.sort().map(ing => `
                    <button data-ingredient="${ing}" class="stock-button text-xs bg-gray-700 hover:bg-gray-600 text-white py-1 px-3 rounded-full transition-colors">
                        ${ing}
                        <i class="fas fa-search search-icon" title="Find drinks with ${ing}"></i>
                    </button>
                `).join('');
                container.innerHTML += `<div class="mb-4"><h3 class="text-lg font-condensed text-amber-500 border-b border-gray-600 mb-2 pb-1">${catName}</h3><div class="flex flex-wrap gap-2">${btnHTML}</div></div>`;
            };
            Object.keys(categorized).sort().forEach(cat => { renderCategory(inStockEl, cat, categorized[cat].filter(i => barStock[i])); renderCategory(outOfStockEl, cat, categorized[cat].filter(i => !barStock[i])); });
        }
        function toggleStockStatus(ingredient) { if(!ingredient) return; barStock[ingredient] = !barStock[ingredient]; saveStock(barStock); renderBarStockModal(); applyAllFilters(); }
        function resetBarStock() { Object.keys(barStock).forEach(ing => barStock[ing] = true); saveStock(barStock); renderBarStockModal(); applyAllFilters(); const btn = document.getElementById('reset-stock-btn'); btn.textContent = 'Stock Reset!'; btn.classList.add('text-green-400'); setTimeout(() => { btn.textContent = 'Reset Stock'; btn.classList.remove('text-green-400'); }, 1500); }
        function isCocktailMakeable(cocktail) { return cocktail.recipe.every(ing => barStock[ing.name]); }
        
        // --- DRINK FINDER LOGIC ---
        function renderDrinkFinderResults() {
            const resultsContainer = document.getElementById('drink-finder-results');
            const searchInput = document.getElementById('drink-finder-input');
            const searchTerm = searchInput.value.toLowerCase();

            const makeableDrinks = cocktails.filter(isCocktailMakeable);
            const filteredDrinks = makeableDrinks.filter(drink => {
                if (searchTerm === '') return true;
                const nameMatch = drink.name.toLowerCase().includes(searchTerm);
                const ingredientMatch = drink.recipe.some(ing => ing.name.toLowerCase().includes(searchTerm));
                return nameMatch || ingredientMatch;
            });
            
            if (filteredDrinks.length === 0) {
                resultsContainer.innerHTML = `<p class="text-gray-500 italic text-sm text-center py-2">No makeable drinks match your search.</p>`;
                return;
            }

            resultsContainer.innerHTML = filteredDrinks
                .map(drink => {
                    const ingredientsHtml = drink.recipe.map(ing => {
                        const ingInfo = getIngredientInfo(ing.name);
                        return `<li class="flex items-center text-xs text-gray-400"><i class="${ingInfo.icon} ${ingInfo.color} w-4 text-center mr-1.5"></i> ${ing.name}</li>`;
                    }).join('');

                    return `
                    <button data-drink-name="${drink.name}" class="drink-finder-item">
                        <h4 class="drink-finder-item-title">${drink.name}</h4>
                        <ul class="drink-finder-item-ingredients">
                            ${ingredientsHtml}
                        </ul>
                    </button>`;
                })
                .join('');
        }
        
        function goToDrink(drinkName) {
            closeModal(document.getElementById('bar-stock-modal'));
            activeFilters = { category: 'all', flavor: null };
            document.querySelectorAll('#category-filter-nav .filter-btn, #flavor-filter-nav .flavor-filter-btn').forEach(btn => btn.classList.remove('active-filter'));
            document.querySelector('#category-filter-nav .filter-btn[data-category="all"]').classList.add('active-filter');
            applyAllFilters();

            setTimeout(() => {
                const card = menuGrid.querySelector(`.drink-card[data-name="${drinkName}"]`);
                if (card) {
                    card.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    setTimeout(() => card.classList.add('is-active-card'), 500); 
                }
            }, 100);
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            document.getElementById('drink-finder-input').addEventListener('input', renderDrinkFinderResults);
            
            document.getElementById('drink-finder-results').addEventListener('click', e => {
                const target = e.target.closest('.drink-finder-item');
                if (target && target.dataset.drinkName) {
                    goToDrink(target.dataset.drinkName);
                }
            });

            document.getElementById('bar-stock-content').addEventListener('click', e => {
                const searchIcon = e.target.closest('.search-icon');
                const stockButton = e.target.closest('.stock-button');

                if (searchIcon) {
                    e.stopPropagation(); // Prevent the button's toggle action from firing
                    const ingredient = stockButton.dataset.ingredient;
                    const searchInput = document.getElementById('drink-finder-input');
                    searchInput.value = ingredient;
                    searchInput.dispatchEvent(new Event('input', { bubbles: true }));
                    document.getElementById('drink-finder-section').scrollIntoView({ behavior: 'smooth' });
                } else if (stockButton) {
                    const ingredient = stockButton.dataset.ingredient;
                    toggleStockStatus(ingredient);
                }
            });
        });

    </script>
</body>
</html>


